<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Lich::GameBase::Game
  
    &mdash; Lich 5 Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::GameBase::Game";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (G)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../GameBase.html" title="Lich::GameBase (module)">GameBase</a></span></span>
     &raquo; 
    <span class="title">Game</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Lich::GameBase::Game
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Lich::GameBase::Game</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>documented/games.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Main game class for managing game state and interactions This class handles the overall game logic and state management.</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="../DragonRealms/Game.html" title="Lich::DragonRealms::Game (class)">DragonRealms::Game</a></span>, <span class='object_link'><a href="../Gemstone/Game.html" title="Lich::Gemstone::Game (class)">Lich::Gemstone::Game</a></span></p>
</div>




  <h2>Class Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#_buffer-class_method" title="_buffer (class method)">.<strong>_buffer</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute _buffer.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#buffer-class_method" title="buffer (class method)">.<strong>buffer</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute buffer.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#game_instance-class_method" title="game_instance (class method)">.<strong>game_instance</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute game_instance.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#thread-class_method" title="thread (class method)">.<strong>thread</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute thread.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_gets-class_method" title="_gets (class method)">.<strong>_gets</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_puts-class_method" title="_puts (class method)">.<strong>_puts</strong>(str)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-class_method" title="close (class method)">.<strong>close</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Closes the socket connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#closed%3F-class_method" title="closed? (class method)">.<strong>closed?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if the socket is closed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#display_ruby_warning-class_method" title="display_ruby_warning (class method)">.<strong>display_ruby_warning</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Displays a warning if the Ruby version is below the recommended version.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gets-class_method" title="gets (class method)">.<strong>gets</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Receives a string from the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_autostart-class_method" title="handle_autostart (class method)">.<strong>handle_autostart</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Handles the autostart process for the game.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_thread_error-class_method" title="handle_thread_error (class method)">.<strong>handle_thread_error</strong>(error)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_xml_error-class_method" title="handle_xml_error (class method)">.<strong>handle_xml_error</strong>(server_string, error)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Handles XML errors during processing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_buffers-class_method" title="initialize_buffers (class method)">.<strong>initialize_buffers</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes the buffers for the game Sets up necessary buffers for socket communication and game state.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#log_error-class_method" title="log_error (class method)">.<strong>log_error</strong>(message, error)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-class_method" title="open (class method)">.<strong>open</strong>(host, port)  &#x21d2; TCPSocket </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Opens a socket connection to the specified host and port.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_downstream_hooks-class_method" title="process_downstream_hooks (class method)">.<strong>process_downstream_hooks</strong>(server_string)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Processes downstream hooks for the server string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_room_information-class_method" title="process_room_information (class method)">.<strong>process_room_information</strong>(alt_string)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_server_string-class_method" title="process_server_string (class method)">.<strong>process_server_string</strong>(server_string)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Processes the server string received from the socket.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_xml_data-class_method" title="process_xml_data (class method)">.<strong>process_xml_data</strong>(server_string)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Processes XML data from the server string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#puts-class_method" title="puts (class method)">.<strong>puts</strong>(str)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends a string to the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_to_client-class_method" title="send_to_client (class method)">.<strong>send_to_client</strong>(alt_string)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_game_instance-class_method" title="set_game_instance (class method)">.<strong>set_game_instance</strong>(game_type)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the game instance based on the game type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_cli_scripts-class_method" title="start_cli_scripts (class method)">.<strong>start_cli_scripts</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Starts CLI scripts based on command line arguments.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_main_thread-class_method" title="start_main_thread (class method)">.<strong>start_main_thread</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Starts the main thread for handling server communication.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_wrap_thread-class_method" title="start_wrap_thread (class method)">.<strong>start_wrap_thread</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  <div id="class_attr_details" class="attr_details">
    <h2>Class Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="_buffer-class_method">
  
    .<strong>_buffer</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute _buffer.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid__buffer'>_buffer</span>
  <span class='ivar'>@_buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="buffer-class_method">
  
    .<strong>buffer</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute buffer.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_buffer'>buffer</span>
  <span class='ivar'>@buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="game_instance-class_method">
  
    .<strong>game_instance</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute game_instance.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_game_instance'>game_instance</span>
  <span class='ivar'>@game_instance</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="thread-class_method">
  
    .<strong>thread</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute thread.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_thread'>thread</span>
  <span class='ivar'>@thread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="_gets-class_method">
  
    .<strong>_gets</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


370
371
372</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 370</span>

<span class='kw'>def</span> <span class='id identifier rubyid__gets'>_gets</span>
  <span class='ivar'>@_buffer</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_puts-class_method">
  
    .<strong>_puts</strong>(str)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


334
335
336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 334</span>

<span class='kw'>def</span> <span class='id identifier rubyid__puts'>_puts</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='ivar'>@mutex</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close-class_method">
  
    .<strong>close</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Closes the socket connection</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


327
328
329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 327</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='kw'>if</span> <span class='ivar'>@socket</span>
    <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
    <span class='ivar'>@thread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="closed?-class_method">
  
    .<strong>closed?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if the socket is closed</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='kw'>if</span> <span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Socket is closed</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>True if the socket is closed, false otherwise</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 319</span>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="display_ruby_warning-class_method">
  
    .<strong>display_ruby_warning</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Displays a warning if the Ruby version is below the recommended version</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_ruby_warning'>display_ruby_warning</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 523</span>

<span class='kw'>def</span> <span class='id identifier rubyid_display_ruby_warning'>display_ruby_warning</span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span> <span class='op'>=</span> <span class='const'>Terminal</span><span class='op'>::</span><span class='const'>Table</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby Recommended Version Warning</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please update your Ruby installation.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re currently running Ruby v</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>RUBY_VERSION</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>It&#39;s recommended to run Ruby v</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#RECOMMENDED_RUBY-constant" title="RECOMMENDED_RUBY (constant)">RECOMMENDED_RUBY</a></span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> or higher!</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Future Lich5 releases will soon require this newer version.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Visit the following link for info on updating:</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='comment'># Use instance to get the appropriate documentation URL
</span>  <span class='kw'>if</span> <span class='ivar'>@game_instance</span>
    <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='ivar'>@game_instance</span><span class='period'>.</span><span class='id identifier rubyid_get_documentation_url'>get_documentation_url</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown game type detected.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_add_row'>add_row</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsure of proper documentation, please seek assistance via discord!</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ruby_warning'>ruby_warning</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_monsterbold'><span class='object_link'><a href="../Messaging.html#monsterbold-class_method" title="Lich::Messaging.monsterbold (method)">monsterbold</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gets-class_method">
  
    .<strong>gets</strong>  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Receives a string from the server</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The received string</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


366
367
368</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 366</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gets'>gets</span>
  <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle_autostart-class_method">
  
    .<strong>handle_autostart</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Handles the autostart process for the game</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_handle_autostart'>handle_autostart</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


504
505
506
507
508
509
510
511
512
513
514
515
516
517</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 504</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_autostart'>handle_autostart</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#LICH_VERSION-constant" title="LICH_VERSION (constant)">LICH_VERSION</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_core_updated_with_lich_version'><span class='object_link'><a href="../../Lich.html#core_updated_with_lich_version-class_method" title="Lich.core_updated_with_lich_version (method)">core_updated_with_lich_version</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
     <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#LICH_VERSION-constant" title="LICH_VERSION (constant)">LICH_VERSION</a></span></span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_core_updated_with_lich_version'><span class='object_link'><a href="../../Lich.html#core_updated_with_lich_version-class_method" title="Lich.core_updated_with_lich_version (method)">core_updated_with_lich_version</a></span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_monsterbold'><span class='object_link'><a href="../Messaging.html#monsterbold-class_method" title="Lich::Messaging.monsterbold (method)">monsterbold</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>New installation or updated version of Lich5 detected!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_monsterbold'><span class='object_link'><a href="../Messaging.html#monsterbold-class_method" title="Lich::Messaging.monsterbold (method)">monsterbold</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Installing newest core scripts available to ensure you&#39;re up-to-date!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Messaging.html" title="Lich::Messaging (module)">Messaging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_mono'><span class='object_link'><a href="../Messaging.html#mono-class_method" title="Lich::Messaging.mono (method)">mono</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Util.html" title="Lich::Util (module)">Util</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Util/Update.html" title="Lich::Util::Update (module)">Update</a></span></span><span class='period'>.</span><span class='id identifier rubyid_update_core_data_and_scripts'><span class='object_link'><a href="../Util/Update.html#update_core_data_and_scripts-class_method" title="Lich::Util::Update.update_core_data_and_scripts (method)">update_core_data_and_scripts</a></span></span>
  <span class='kw'>end</span>

  <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>autostart</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Script</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:exists?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>autostart</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@autostarted</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_display_ruby_warning'>display_ruby_warning</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#RECOMMENDED_RUBY-constant" title="RECOMMENDED_RUBY (constant)">RECOMMENDED_RUBY</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>RUBY_VERSION</span><span class='rparen'>)</span> <span class='op'>&lt;</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#RECOMMENDED_RUBY-constant" title="RECOMMENDED_RUBY (constant)">RECOMMENDED_RUBY</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle_thread_error-class_method">
  
    .<strong>handle_thread_error</strong>(error)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 694</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_thread_error'>handle_thread_error</span><span class='lparen'>(</span><span class='id identifier rubyid_error'>error</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='int'>10</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.2</span>

  <span class='comment'># Determine if we should retry
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_error'>error</span>
  <span class='kw'>when</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ETIMEDOUT</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EWOULDBLOCK</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>TimeoutError</span>
    <span class='comment'># Timeout errors are potentially recoverable if we haven&#39;t seen too many
</span>    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Timeout error detected - may attempt retry</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNRESET</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNABORTED</span>
    <span class='comment'># Connection errors are fatal
</span>    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fatal connection error - will not retry</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>else</span>
    <span class='comment'># Check if socket/client are closed or if it&#39;s a known fatal error
</span>    <span class='kw'>if</span> <span class='gvar'>$_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='op'>||</span> <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Client or socket closed - will not retry</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>invalid argument|A connection attempt failed|An existing connection was forcibly closed|An established connection was aborted by the software in your host machine.</span><span class='regexp_end'>/i</span></span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fatal error pattern detected - will not retry</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>else</span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown error - will attempt retry</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle_xml_error-class_method">
  
    .<strong>handle_xml_error</strong>(server_string, error)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Handles XML errors during processing</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_handle_xml_error'>handle_xml_error</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_string'>raw_string</span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_string</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The server string that caused the error</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>error</span>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The error that occurred</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 617</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_xml_error'>handle_xml_error</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span><span class='rparen'>)</span>
  <span class='comment'># Ignoring certain XML errors
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>invalid byte sequence</span><span class='regexp_end'>/</span></span>
    <span class='comment'># Handle specific XML errors
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;settingsInfo .*?space not found </span><span class='regexp_end'>/</span></span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid settingsInfo XML tags detected: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>space not found</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid settingsInfo XML tags fixed to: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_process_xml_data'>process_xml_data</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span> <span class='comment'># Return to retry with fixed string
</span>    <span class='kw'>end</span>

    <span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid XML detected - please report this: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: server_thread: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_buffers-class_method">
  
    .<strong>initialize_buffers</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Initializes the buffers for the game Sets up necessary buffers for socket communication and game state.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_initialize_buffers'>initialize_buffers</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223
224
225
226
227
228
229
230
231
232
233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 221</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_buffers'>initialize_buffers</span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@last_recv</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@thread</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@buffer</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/SharedBuffer.html" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Common/SharedBuffer.html#initialize-instance_method" title="Lich::Common::SharedBuffer#initialize (method)">new</a></span></span>
  <span class='ivar'>@_buffer</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/SharedBuffer.html" title="Lich::Common::SharedBuffer (class)">SharedBuffer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Common/SharedBuffer.html#initialize-instance_method" title="Lich::Common::SharedBuffer#initialize (method)">new</a></span></span>
  <span class='ivar'>@_buffer</span><span class='period'>.</span><span class='id identifier rubyid_max_size'>max_size</span> <span class='op'>=</span> <span class='int'>1000</span>
  <span class='ivar'>@autostarted</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@cli_scripts</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@infomon_loaded</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@room_number_after_ready</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@last_id_shown_room_window</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@game_instance</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="log_error-class_method">
  
    .<strong>log_error</strong>(message, error)  &#x21d2; <tt>Object</tt>  <span class="extras">(protected)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


726
727
728</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 726</span>

<span class='kw'>def</span> <span class='id identifier rubyid_log_error'>log_error</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open-class_method">
  
    .<strong>open</strong>(host, port)  &#x21d2; <tt>TCPSocket</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Opens a socket connection to the specified host and port</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>1234</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hostname or IP address of the server</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>port</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The port number to connect to</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>TCPSocket</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The opened socket</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If there is an error during socket configuration</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 253</span>

<span class='kw'>def</span> <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='const'>TCPSocket</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>

  <span class='comment'># Configure socket with error handling
</span>  <span class='comment'># More forgiving settings for Windows reliability under network stress
</span>  <span class='kw'>begin</span>
    <span class='const'>SocketConfigurator</span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span><span class='lparen'>(</span><span class='ivar'>@socket</span><span class='comma'>,</span>
                                 <span class='label'>keepalive:</span> <span class='lbrace'>{</span>
                                   <span class='label'>enable:</span> <span class='kw'>true</span><span class='comma'>,</span>
                                   <span class='label'>idle:</span> <span class='int'>120</span><span class='comma'>,</span>      <span class='comment'># 2 minutes before first keepalive
</span>                                   <span class='label'>interval:</span> <span class='int'>30</span>    <span class='comment'># 30 seconds between keepalive probes
</span>                                 <span class='rbrace'>}</span><span class='comma'>,</span>
                                 <span class='label'>linger:</span> <span class='lbrace'>{</span>
                                   <span class='label'>enable:</span> <span class='kw'>true</span><span class='comma'>,</span>
                                   <span class='label'>timeout:</span> <span class='int'>5</span>      <span class='comment'># Wait 5 seconds for data to send on close
</span>                                 <span class='rbrace'>}</span><span class='comma'>,</span>
                                 <span class='label'>timeout:</span> <span class='lbrace'>{</span>
                                   <span class='label'>recv:</span> <span class='int'>30</span><span class='comma'>,</span>       <span class='comment'># 30 second receive timeout (increased from 10)
</span>                                   <span class='label'>send:</span> <span class='int'>30</span>        <span class='comment'># 30 second send timeout (increased from 10)
</span>                                 <span class='rbrace'>}</span><span class='comma'>,</span>
                                 <span class='label'>buffer_size:</span> <span class='lbrace'>{</span>
                                   <span class='label'>recv:</span> <span class='int'>32768</span><span class='comma'>,</span>    <span class='comment'># 32KB receive buffer (reduced from 65536)
</span>                                   <span class='label'>send:</span> <span class='int'>32768</span>     <span class='comment'># 32KB send buffer (reduced from 65536)
</span>                                 <span class='rbrace'>}</span><span class='comma'>,</span>
                                 <span class='label'>tcp_nodelay:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='comment'># Disable Nagle&#39;s algorithm for low latency
</span>                                 <span class='label'>tcp_maxrt:</span> <span class='int'>10</span><span class='rparen'>)</span>     <span class='comment'># Windows: max 10 retransmissions before giving up
</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Socket configured successfully for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'>host</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--debug</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='comment'># Log the error but continue - socket may still work with default settings
</span>    <span class='id identifier rubyid_log_error'>log_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Socket configuration error (continuing with defaults)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WARNING: Socket running with default OS settings - may be less reliable under network stress</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_start_wrap_thread'>start_wrap_thread</span>
  <span class='id identifier rubyid_start_main_thread'>start_main_thread</span>

  <span class='ivar'>@socket</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_downstream_hooks-class_method">
  
    .<strong>process_downstream_hooks</strong>(server_string)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Processes downstream hooks for the server string</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_process_downstream_hooks'>process_downstream_hooks</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_string'>raw_string</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_string</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The server string to process</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 639</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_downstream_hooks'>process_downstream_hooks</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='const'>DownstreamHook</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_process_room_information'>process_room_information</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>

    <span class='comment'># Handle frontend-specific modifications
</span>    <span class='kw'>if</span> <span class='gvar'>$frontend</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>genie</span><span class='regexp_end'>/i</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&lt;streamWindow id=&#39;room&#39; title=&#39;Room&#39; subtitle=&quot; - \[.*\] \((?:\d+|\*\*)\)&quot;</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>] \((?:\d+|\*\*)\)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='gvar'>$frontend</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>frostbite</span><span class='regexp_end'>/i</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&lt;streamWindow id=&#39;main&#39; title=&#39;Story&#39; subtitle=&quot; - \[.*\] \((?:\d+|\*\*)\)&quot;</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_alt_string'>alt_string</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>] \((?:\d+|\*\*)\)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='comment'># Handle room number display
</span>    <span class='kw'>if</span> <span class='ivar'>@room_number_after_ready</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;prompt </span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='ivar'>@game_instance</span> <span class='op'>?</span> <span class='ivar'>@game_instance</span><span class='period'>.</span><span class='id identifier rubyid_process_room_display'>process_room_display</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_alt_string'>alt_string</span>
      <span class='ivar'>@room_number_after_ready</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># Handle frontend-specific conversions
</span>    <span class='kw'>if</span> <span class='gvar'>$frontend</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(?:wizard|avalon)$</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=</span> <span class='id identifier rubyid_sf_to_wiz'><span class='object_link'><a href="../../top-level-namespace.html#sf_to_wiz-instance_method" title="#sf_to_wiz (method)">sf_to_wiz</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Send to client
</span>    <span class='id identifier rubyid_send_to_client'>send_to_client</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_room_information-class_method">
  
    .<strong>process_room_information</strong>(alt_string)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


668
669
670
671
672
673
674
675
676</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 668</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_room_information'>process_room_information</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_alt_string'>alt_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(&lt;pushStream id=&quot;familiar&quot; ifClosedStyle=&quot;watching&quot;\/&gt;)?(?:&lt;resource picture=&quot;\d+&quot;\/&gt;|&lt;popBold\/&gt;)?&lt;style id=&quot;roomName&quot;\s+\/&gt;</span><span class='regexp_end'>/</span></span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_lichid'><span class='object_link'><a href="../../Lich.html#display_lichid-class_method" title="Lich.display_lichid (method)">display_lichid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display_uid'><span class='object_link'><a href="../../Lich.html#display_uid-class_method" title="Lich.display_uid (method)">display_uid</a></span></span> <span class='op'>==</span> <span class='kw'>true</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hide_uid_flag'><span class='object_link'><a href="../../Lich.html#hide_uid_flag-class_method" title="Lich.hide_uid_flag (method)">hide_uid_flag</a></span></span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='ivar'>@game_instance</span> <span class='op'>?</span> <span class='ivar'>@game_instance</span><span class='period'>.</span><span class='id identifier rubyid_modify_room_display'>modify_room_display</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_alt_string'>alt_string</span>
    <span class='kw'>end</span>
    <span class='ivar'>@room_number_after_ready</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_alt_string'>alt_string</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_server_string-class_method">
  
    .<strong>process_server_string</strong>(server_string)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Processes the server string received from the socket</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_process_server_string'>process_server_string</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_string'>raw_string</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_string</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The raw server string to process</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 452</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_server_string'>process_server_string</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
  <span class='gvar'>$cmd_prefix</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\034GSw</span><span class='regexp_end'>/</span></span>

  <span class='comment'># Load game-specific modules if needed
</span>  <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='const'>Module</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:GameLoader</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>common/game-loader</span><span class='tstring_end'>&#39;</span></span>
      <span class='const'>GameLoader</span><span class='period'>.</span><span class='id identifier rubyid_load!'>load!</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Set instance if not already set
</span>  <span class='kw'>if</span> <span class='ivar'>@game_instance</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_set_game_instance'>set_game_instance</span><span class='lparen'>(</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Clean server string based on game type
</span>  <span class='kw'>if</span> <span class='ivar'>@game_instance</span>
    <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='ivar'>@game_instance</span><span class='period'>.</span><span class='id identifier rubyid_clean_serverstring'>clean_serverstring</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Debug output if needed
</span>  <span class='id identifier rubyid_pp'>pp</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='gvar'>$deep_debug</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='gvar'>$deep_debug</span>

  <span class='comment'># Push to server buffer
</span>  <span class='gvar'>$_SERVERBUFFER_</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>

  <span class='comment'># Handle autostart
</span>  <span class='id identifier rubyid_handle_autostart'>handle_autostart</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@autostarted</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;app char</span><span class='regexp_end'>/</span></span>

  <span class='comment'># Handle infomon loading
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@infomon_loaded</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Infomon</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='gvar'>$DRINFOMON_VERSION</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_dialogs'>dialogs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='const'>ExecScript</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Infomon.redo!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>quiet:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>infomon_reset</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^DR</span><span class='regexp_end'>/</span></span> <span class='op'>&amp;&amp;</span> <span class='const'>Infomon</span><span class='period'>.</span><span class='id identifier rubyid_db_refresh_needed?'>db_refresh_needed?</span>
    <span class='ivar'>@infomon_loaded</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='comment'># Handle CLI scripts
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@cli_scripts</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@autostarted</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_start_cli_scripts'>start_cli_scripts</span>
  <span class='kw'>end</span>

  <span class='comment'># Process XML data
</span>  <span class='id identifier rubyid_process_xml_data'>process_xml_data</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&lt;settings </span><span class='regexp_end'>/</span></span>

  <span class='comment'># Run downstream hooks
</span>  <span class='id identifier rubyid_process_downstream_hooks'>process_downstream_hooks</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_xml_data-class_method">
  
    .<strong>process_xml_data</strong>(server_string)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Processes XML data from the server string</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_process_xml_data'>process_xml_data</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_string'>raw_string</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_string</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The server string containing XML data</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 565</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_xml_data'>process_xml_data</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='comment'># Check for valid XML
</span>    <span class='const'>REXML</span><span class='op'>::</span><span class='const'>Document</span><span class='period'>.</span><span class='id identifier rubyid_parse_stream'>parse_stream</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;root&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_string'>server_string</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/root&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>XMLData</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='kw'>case</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='comment'># Missing attribute equal: &lt;s&gt; - in dynamic dialogs with a single apostrophe for possessive &#39;Tsetem&#39;s Items&#39;
</span>    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>nested single quotes|nested double quotes|Missing attribute equal: &lt;[^&gt;]+&gt;|Invalid attribute name: &lt;[^&gt;]+&gt;</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_original_server_string'>original_server_string</span> <span class='op'>=</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
      <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLCleaner.html" title="Lich::GameBase::XMLCleaner (module)">XMLCleaner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clean_nested_quotes'><span class='object_link'><a href="XMLCleaner.html#clean_nested_quotes-class_method" title="Lich::GameBase::XMLCleaner.clean_nested_quotes (method)">clean_nested_quotes</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_original_server_string'>original_server_string</span> <span class='op'>!=</span> <span class='id identifier rubyid_server_string'>server_string</span>
        <span class='kw'>retry</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_handle_xml_error'>handle_xml_error</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='comma'>,</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='rparen'>)</span>
        <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
        <span class='kw'>return</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>invalid characters</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLCleaner.html" title="Lich::GameBase::XMLCleaner (module)">XMLCleaner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fix_invalid_characters'><span class='object_link'><a href="XMLCleaner.html#fix_invalid_characters-class_method" title="Lich::GameBase::XMLCleaner.fix_invalid_characters (method)">fix_invalid_characters</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
      <span class='kw'>retry</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>Missing end tag for &#39;d&#39;</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="XMLCleaner.html" title="Lich::GameBase::XMLCleaner (module)">XMLCleaner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fix_xml_tags'><span class='object_link'><a href="XMLCleaner.html#fix_xml_tags-class_method" title="Lich::GameBase::XMLCleaner.fix_xml_tags (method)">fix_xml_tags</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
      <span class='kw'>retry</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_handle_xml_error'>handle_xml_error</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='comma'>,</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='rparen'>)</span>
      <span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Process game-specific data using instance
</span>  <span class='kw'>if</span> <span class='ivar'>@game_instance</span> <span class='op'>&amp;&amp;</span> <span class='const'>Module</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:GameLoader</span><span class='rparen'>)</span>
    <span class='ivar'>@game_instance</span><span class='period'>.</span><span class='id identifier rubyid_process_game_specific_data'>process_game_specific_data</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Process downstream XML
</span>  <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new_downstream_xml'>new_downstream_xml</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Script</span><span class='rparen'>)</span>

  <span class='comment'># Process stripped server string
</span>  <span class='id identifier rubyid_stripped_server'>stripped_server</span> <span class='op'>=</span> <span class='id identifier rubyid_strip_xml'><span class='object_link'><a href="../../top-level-namespace.html#strip_xml-instance_method" title="#strip_xml (method)">strip_xml</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>main</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_stripped_server'>stripped_server</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='ivar'>@buffer</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#TESTING-constant" title="TESTING (constant)">TESTING</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#TESTING-constant" title="TESTING (constant)">TESTING</a></span></span>
    <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new_downstream'>new_downstream</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Script</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="puts-class_method">
  
    .<strong>puts</strong>(str)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Sends a string to the server</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello, server!</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The string to send</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 345</span>

<span class='kw'>def</span> <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='op'>&amp;.</span><span class='id identifier rubyid_file_name'>file_name</span>
    <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_custom?'>custom?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>custom/</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='op'>&amp;.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>=</span> <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='op'>&amp;.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(unknown script)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='gvar'>$_CLIENTBUFFER_</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script_name'>script_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='gvar'>$SEND_CHARACTER</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='gvar'>$cmd_prefix</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>unless</span> <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='op'>&amp;.</span><span class='id identifier rubyid_silent'>silent</span>
    <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script_name'>script_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='gvar'>$SEND_CHARACTER</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid__puts'>_puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='gvar'>$cmd_prefix</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='gvar'>$_LASTUPSTREAM_</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script_name'>script_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='gvar'>$SEND_CHARACTER</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_to_client-class_method">
  
    .<strong>send_to_client</strong>(alt_string)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


678
679
680
681
682
683
684
685
686
687
688
689
690
691
692</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 678</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_to_client'>send_to_client</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='gvar'>$_DETACHABLE_CLIENT_</span>
    <span class='kw'>begin</span>
      <span class='gvar'>$_DETACHABLE_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span>
      <span class='gvar'>$_DETACHABLE_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
      <span class='gvar'>$_DETACHABLE_CLIENT_</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--- Lich: error: client_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: client_thread: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='gvar'>$_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_string'>alt_string</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_game_instance-class_method">
  
    .<strong>set_game_instance</strong>(game_type)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Sets the game instance based on the game type</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set_game_instance'>set_game_instance</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GS</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>game_type</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of game to set the instance for</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_game_instance'>set_game_instance</span><span class='lparen'>(</span><span class='id identifier rubyid_game_type'>game_type</span><span class='rparen'>)</span>
  <span class='ivar'>@game_instance</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="GameInstanceFactory.html" title="Lich::GameBase::GameInstanceFactory (module)">GameInstanceFactory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="GameInstanceFactory.html#create-class_method" title="Lich::GameBase::GameInstanceFactory.create (method)">create</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_game_type'>game_type</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_cli_scripts-class_method">
  
    .<strong>start_cli_scripts</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Starts CLI scripts based on command line arguments</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_start_cli_scripts'>start_cli_scripts</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


550
551
552
553
554
555
556
557
558</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 550</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_cli_scripts'>start_cli_scripts</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\-\-start\-scripts=</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>--start-scripts=</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_script_name'>script_name</span><span class='op'>|</span>
      <span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_script_name'>script_name</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@cli_scripts</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: logged in as </span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_main_thread-class_method">
  
    .<strong>start_main_thread</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Starts the main thread for handling server communication</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::GameBase::Game (class)">Game</a></span></span><span class='period'>.</span><span class='id identifier rubyid_start_main_thread'>start_main_thread</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 378</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_main_thread'>start_main_thread</span>
  <span class='ivar'>@thread</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_consecutive_timeouts'>consecutive_timeouts</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_max_consecutive_timeouts'>max_consecutive_timeouts</span> <span class='op'>=</span> <span class='int'>3</span> <span class='comment'># Allow 3 timeouts before giving up
</span>
    <span class='kw'>begin</span>
      <span class='kw'>while</span> <span class='kw'>true</span>
        <span class='kw'>begin</span>
          <span class='comment'># Try to read from socket with timeout
</span>          <span class='id identifier rubyid_server_string'>server_string</span> <span class='op'>=</span> <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>

          <span class='comment'># Successfully received data - reset timeout counter
</span>          <span class='id identifier rubyid_consecutive_timeouts'>consecutive_timeouts</span> <span class='op'>=</span> <span class='int'>0</span>

          <span class='comment'># Break if socket closed (gets returns nil)
</span>          <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_server_string'>server_string</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

          <span class='ivar'>@last_recv</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
          <span class='ivar'>@_buffer</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../top-level-namespace.html#TESTING-constant" title="TESTING (constant)">TESTING</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#TESTING-constant" title="TESTING (constant)">TESTING</a></span></span>

          <span class='kw'>begin</span>
            <span class='id identifier rubyid_process_server_string'>process_server_string</span><span class='lparen'>(</span><span class='id identifier rubyid_server_string'>server_string</span><span class='rparen'>)</span>
          <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
            <span class='id identifier rubyid_log_error'>log_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error processing server string</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ETIMEDOUT</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EWOULDBLOCK</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>TimeoutError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_timeout_error'>timeout_error</span>
          <span class='comment'># Socket read timed out - this is expected if server is quiet
</span>          <span class='id identifier rubyid_consecutive_timeouts'>consecutive_timeouts</span> <span class='op'>+=</span> <span class='int'>1</span>

          <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Socket read timeout </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_consecutive_timeouts'>consecutive_timeouts</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_consecutive_timeouts'>max_consecutive_timeouts</span><span class='embexpr_end'>}</span><span class='tstring_content'> (no data for 30s)</span><span class='tstring_end'>&quot;</span></span>

          <span class='kw'>if</span> <span class='id identifier rubyid_consecutive_timeouts'>consecutive_timeouts</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_max_consecutive_timeouts'>max_consecutive_timeouts</span>
            <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many consecutive timeouts, connection may be dead</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_timeout_error'>timeout_error</span> <span class='comment'># Let the outer rescue handle it
</span>          <span class='kw'>end</span>

          <span class='comment'># Check if socket is still alive
</span>          <span class='kw'>if</span> <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
            <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Socket is closed, exiting thread</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>break</span>
          <span class='kw'>end</span>

          <span class='comment'># Small sleep before retry
</span>          <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span>
          <span class='kw'>retry</span>
        <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNRESET</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNABORTED</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_conn_error'>conn_error</span>
          <span class='comment'># Connection was reset/broken - these are fatal
</span>          <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connection error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_conn_error'>conn_error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_conn_error'>conn_error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_conn_error'>conn_error</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
      <span class='comment'># Handle any other errors
</span>      <span class='id identifier rubyid_should_continue'>should_continue</span> <span class='op'>=</span> <span class='id identifier rubyid_handle_thread_error'>handle_thread_error</span><span class='lparen'>(</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='rparen'>)</span>

      <span class='comment'># Only retry if handle_thread_error says it&#39;s safe and socket is still open
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_should_continue'>should_continue</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='gvar'>$_CLIENT_</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
        <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Retrying server thread after error...</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_consecutive_timeouts'>consecutive_timeouts</span> <span class='op'>=</span> <span class='int'>0</span> <span class='comment'># Reset counter on retry
</span>        <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span> <span class='comment'># Brief pause before retry
</span>        <span class='kw'>retry</span>
      <span class='kw'>else</span>
        <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server thread exiting due to unrecoverable error</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@thread</span><span class='period'>.</span><span class='id identifier rubyid_priority'>priority</span> <span class='op'>=</span> <span class='int'>4</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_wrap_thread-class_method">
  
    .<strong>start_wrap_thread</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/games.rb', line 295</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_wrap_thread'>start_wrap_thread</span>
  <span class='kw'>begin</span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_vacuum_if_due!'><span class='object_link'><a href="../../Lich.html#db_vacuum_if_due!-class_method" title="Lich.db_vacuum_if_due! (method)">db_vacuum_if_due!</a></span></span><span class='lparen'>(</span><span class='label'>months:</span> <span class='int'>6</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>db_maint(startup): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@wrap_thread</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
    <span class='ivar'>@last_recv</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
    <span class='kw'>until</span> <span class='ivar'>@autostarted</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@last_recv</span> <span class='op'>&gt;=</span> <span class='int'>6</span><span class='rparen'>)</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='ivar'>@autostarted</span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.2</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>look</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='ivar'>@autostarted</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 13 05:02:24 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.2.9).
</div>

    </div>
  <script type="text/javascript">
// Navigation helper for YARD docs
// Adds persistent navigation links, fixes sidebar navigation, and theme toggle

(function() {
  'use strict';

  // Calculate root path for assets
  function getRootPath() {
    var path = window.location.pathname;
    var rootPath = '';

    if (path.includes('/Lich/')) {
      var parts = path.split('/').filter(function(p) { return p; });
      var docsIndex = parts.indexOf('lich-5-docs');
      if (docsIndex >= 0) {
        var subParts = parts.slice(docsIndex + 1);
        rootPath = '../'.repeat(subParts.length - 1);
      }
    }

    if (!rootPath && !path.endsWith('/index.html') && !path.endsWith('/')) {
      var pathParts = path.split('/').filter(function(p) { return p && p !== 'index.html'; });
      var docsIdx = pathParts.indexOf('lich-5-docs');
      if (docsIdx >= 0) {
        rootPath = '../'.repeat(pathParts.length - docsIdx - 2);
      }
    }

    return rootPath;
  }

  // Inject theme CSS
  function injectThemeCSS() {
    if (document.getElementById('theme-css')) return;

    var rootPath = getRootPath();

    // Try multiple paths to find the CSS
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css',
      '/css/theme.css'
    ];

    var link = document.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    // Add error handler to try alternative paths
    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    document.head.appendChild(link);

    // Also inject critical inline styles as fallback
    injectInlineStyles();
  }

  // Inject critical inline styles for immediate dark mode
  function injectInlineStyles() {
    if (document.getElementById('theme-inline-css')) return;

    var style = document.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // File listing badges on index page
      '[data-theme="dark"] .alpha_listing a, [data-theme="dark"] .file_listing a, [data-theme="dark"] p.children a { background-color: #16213e !important; border-color: #333 !important; }',
      '[data-theme="dark"] .r1 a, [data-theme="dark"] .r2 a, [data-theme="dark"] .index_list a { background-color: #16213e !important; border-color: #333 !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] li, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Definition lists
      '[data-theme="dark"] dt, [data-theme="dark"] dd { background-color: transparent !important; }',
      // Catch-all for any remaining white backgrounds
      '[data-theme="dark"] div, [data-theme="dark"] section, [data-theme="dark"] article, [data-theme="dark"] aside { background-color: inherit !important; }'
    ].join('\n');
    document.head.appendChild(style);
  }

  // Get saved theme or detect system preference
  function getPreferredTheme() {
    var saved = localStorage.getItem('yard-theme');
    if (saved) return saved;

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  }

  // Apply theme to a document
  function applyThemeToDocument(doc, theme) {
    if (!doc || !doc.documentElement) return;
    doc.documentElement.setAttribute('data-theme', theme);

    // Also set on body for broader compatibility
    if (doc.body) {
      doc.body.setAttribute('data-theme', theme);
    }
  }

  // Inject inline styles into a document
  function injectInlineStylesToDocument(doc) {
    if (!doc || !doc.head) return;
    if (doc.getElementById('theme-inline-css')) return;

    var style = doc.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements - critical for frame backgrounds
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      '[data-theme="dark"] li { background-color: transparent !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // File listing badges on index page
      '[data-theme="dark"] .alpha_listing a, [data-theme="dark"] .file_listing a, [data-theme="dark"] p.children a { background-color: #16213e !important; border-color: #333 !important; }',
      '[data-theme="dark"] .r1 a, [data-theme="dark"] .r2 a, [data-theme="dark"] .index_list a { background-color: #16213e !important; border-color: #333 !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td, [data-theme="dark"] table tr { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      '[data-theme="dark"] table tr:nth-child(even), [data-theme="dark"] table tr:nth-child(even) td { background-color: #16213e !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Definition lists
      '[data-theme="dark"] dt, [data-theme="dark"] dd { background-color: transparent !important; }',
      // Content area
      '[data-theme="dark"] #content { background-color: #1a1a2e !important; }',
      '[data-theme="dark"] pre, [data-theme="dark"] code { background-color: #0d1117 !important; color: #c9d1d9 !important; }',
      // Catch-all
      '[data-theme="dark"] div, [data-theme="dark"] section { background-color: inherit !important; }'
    ].join('\n');
    doc.head.appendChild(style);
  }

  // Inject theme CSS into a document
  function injectThemeCSSIntoDocument(doc, rootPath) {
    if (!doc || !doc.head) return;

    // Always inject inline styles first as fallback
    injectInlineStylesToDocument(doc);

    if (doc.getElementById('theme-css')) return;

    // Try multiple paths
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css'
    ];

    var link = doc.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    doc.head.appendChild(link);
  }

  // Apply theme to all frames
  function applyThemeToAllFrames(theme) {
    var rootPath = getRootPath();

    // Apply to main document
    applyThemeToDocument(document, theme);
    injectThemeCSSIntoDocument(document, rootPath);

    // Apply to all frames and iframes
    try {
      var frames = document.querySelectorAll('frame, iframe');
      frames.forEach(function(frame) {
        try {
          var frameDoc = frame.contentDocument || frame.contentWindow.document;
          if (frameDoc) {
            applyThemeToDocument(frameDoc, theme);
            // Calculate root path relative to frame
            var frameRootPath = rootPath || '';
            injectThemeCSSIntoDocument(frameDoc, frameRootPath);
          }
        } catch (e) {
          // Cross-origin frame, skip
        }
      });

      // Also check parent frames (if we're in a frame)
      if (window.parent && window.parent !== window) {
        try {
          applyThemeToDocument(window.parent.document, theme);
          injectThemeCSSIntoDocument(window.parent.document, rootPath);
        } catch (e) {
          // Cross-origin, skip
        }
      }

      // Check top-level window
      if (window.top && window.top !== window) {
        try {
          applyThemeToDocument(window.top.document, theme);
          injectThemeCSSIntoDocument(window.top.document, rootPath);

          // Apply to all frames from top
          var topFrames = window.top.document.querySelectorAll('frame, iframe');
          topFrames.forEach(function(frame) {
            try {
              var frameDoc = frame.contentDocument || frame.contentWindow.document;
              if (frameDoc) {
                applyThemeToDocument(frameDoc, theme);
                injectThemeCSSIntoDocument(frameDoc, '');
              }
            } catch (e) {}
          });
        } catch (e) {
          // Cross-origin, skip
        }
      }
    } catch (e) {
      // Frames not accessible
    }
  }

  // Apply theme
  function applyTheme(theme) {
    localStorage.setItem('yard-theme', theme);

    // Apply to all documents
    applyThemeToAllFrames(theme);

    var btn = document.getElementById('theme-toggle');
    if (btn) {
      btn.textContent = theme === 'dark' ? ' Light' : ' Dark';
      btn.title = 'Switch to ' + (theme === 'dark' ? 'light' : 'dark') + ' mode';
    }
  }

  // Toggle theme
  function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme') || 'light';
    var newTheme = current === 'dark' ? 'light' : 'dark';
    applyTheme(newTheme);
  }

  // Check if we're in a sidebar/list frame (should not add nav)
  function isListFrame() {
    var path = window.location.pathname.toLowerCase();
    // Skip list frames
    if (path.includes('class_list') ||
        path.includes('file_list') ||
        path.includes('method_list') ||
        path.includes('_list.html') ||
        path.includes('frames.html')) {
      return true;
    }
    // Skip if this is a frame with full_list (sidebar)
    if (document.getElementById('full_list') && !document.getElementById('content')) {
      return true;
    }
    // Skip if we're clearly in a sub-frame
    if (window.frameElement) {
      return true;
    }
    return false;
  }

  function addNavLinks() {
    // Don't add nav to list/sidebar frames
    if (isListFrame()) return;

    var content = document.getElementById('content');
    if (!content) return;

    if (document.getElementById('quick-nav')) return;

    var rootPath = getRootPath();

    var nav = document.createElement('div');
    nav.id = 'quick-nav';
    nav.style.cssText = 'padding: 8px 15px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ddd; font-size: 14px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;';

    var links = document.createElement('div');
    links.innerHTML = '<a href="' + rootPath + 'index.html" style="margin-right: 15px; text-decoration: none;">Home</a> | ' +
                      '<a href="' + rootPath + '_index.html" style="margin-left: 15px; margin-right: 15px; text-decoration: none;">All Classes</a> | ' +
                      '<a href="' + rootPath + 'file.psm-reference.html" style="margin-left: 15px; text-decoration: none;">PSM Guide</a>';

    var themeBtn = document.createElement('button');
    themeBtn.id = 'theme-toggle';
    themeBtn.type = 'button';
    themeBtn.onclick = toggleTheme;

    nav.appendChild(links);
    nav.appendChild(themeBtn);

    content.insertBefore(nav, content.firstChild);

    var currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    themeBtn.textContent = currentTheme === 'dark' ? ' Light' : ' Dark';
    themeBtn.title = 'Switch to ' + (currentTheme === 'dark' ? 'light' : 'dark') + ' mode';
  }

  // Fix sidebar links - only run in actual sidebar/list frames
  function fixAllSidebarLinks() {
    // Only fix links if we're in a list frame
    if (!isListFrame()) return;

    // Get all possible sidebar/menu containers
    var selectors = [
      '#full_list',
      '#menu',
      '.menu',
      '#full_list_content',
      '.class_list',
      '.objects',
      '.sidebar',
      '#list',
      '.y_list'
    ];

    selectors.forEach(function(selector) {
      var containers = document.querySelectorAll(selector);
      containers.forEach(function(container) {
        // Add click handler to container that forces navigation
        if (!container.dataset.navFixed) {
          container.dataset.navFixed = 'true';

          container.addEventListener('click', function(e) {
            // Find the clicked link
            var target = e.target;
            while (target && target !== container) {
              if (target.tagName === 'A') {
                var href = target.getAttribute('href');
                if (href && href !== '#' && !href.startsWith('javascript:')) {
                  e.preventDefault();
                  e.stopPropagation();
                  e.stopImmediatePropagation();

                  // Navigate the parent/top frame, not this frame
                  if (window.parent && window.parent !== window) {
                    window.parent.location.href = target.href;
                  } else if (window.top && window.top !== window) {
                    window.top.location.href = target.href;
                  } else {
                    window.location.href = target.href;
                  }
                  return false;
                }
              }
              target = target.parentNode;
            }
          }, true); // Capture phase
        }

        // Also fix individual links
        var links = container.querySelectorAll('a');
        links.forEach(function(link) {
          if (!link.dataset.navFixed) {
            link.dataset.navFixed = 'true';
            var href = link.getAttribute('href');
            if (href && href !== '#' && !href.startsWith('javascript:')) {
              // Store the original href
              var fullHref = link.href;

              // Override onclick - navigate parent frame
              link.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (window.parent && window.parent !== window) {
                  window.parent.location.href = fullHref;
                } else if (window.top && window.top !== window) {
                  window.top.location.href = fullHref;
                } else {
                  window.location.href = fullHref;
                }
                return false;
              };
            }
          }
        });
      });
    });
  }

  // Watch for dynamically loaded content - only in list frames
  function observeForNewLinks() {
    // Only observe in list frames
    if (!isListFrame()) return;

    var observer = new MutationObserver(function(mutations) {
      var hasNewNodes = mutations.some(function(m) {
        return m.addedNodes.length > 0;
      });
      if (hasNewNodes) {
        // Delay slightly to let YARD's JS run first
        setTimeout(fixAllSidebarLinks, 10);
      }
    });

    if (document.body) {
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
  }

  // Initialize
  function init() {
    injectThemeCSS();
    applyTheme(getPreferredTheme());
    addNavLinks();
    fixAllSidebarLinks();
    observeForNewLinks();
  }

  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // Run periodically to catch all dynamic content and frames
  var intervals = [50, 100, 250, 500, 1000, 2000, 3000];
  intervals.forEach(function(ms) {
    setTimeout(function() {
      fixAllSidebarLinks();
      // Reapply theme to catch any newly loaded frames
      var theme = localStorage.getItem('yard-theme') || getPreferredTheme();
      applyThemeToAllFrames(theme);
    }, ms);
  });

  // Also run on any click anywhere (last resort) - only in list frames
  document.addEventListener('click', function(e) {
    // Only handle in list frames
    if (!isListFrame()) return;

    if (e.target.tagName === 'A') {
      var href = e.target.getAttribute('href');
      if (href && href !== '#' && !href.startsWith('javascript:')) {
        // Check if it's a sidebar link
        var inSidebar = e.target.closest('#full_list, #menu, .menu, .sidebar');
        if (inSidebar) {
          e.preventDefault();
          e.stopPropagation();
          // Navigate parent frame
          if (window.parent && window.parent !== window) {
            window.parent.location.href = e.target.href;
          } else {
            window.location.href = e.target.href;
          }
        }
      }
    }
  }, true);

  // Listen for system theme changes
  if (window.matchMedia) {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('yard-theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  }
})();

</script>
</body>
</html>