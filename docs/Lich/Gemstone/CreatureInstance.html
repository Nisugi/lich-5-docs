<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Lich::Gemstone::CreatureInstance
  
    &mdash; Lich 5 Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::Gemstone::CreatureInstance";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Gemstone.html" title="Lich::Gemstone (module)">Gemstone</a></span></span>
     &raquo; 
    <span class="title">CreatureInstance</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Lich::Gemstone::CreatureInstance
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Lich::Gemstone::CreatureInstance</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>documented/gemstone/creature.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Individual creature instance (runtime tracking with ID)</p>

<p>Represents a specific creature in the game world, tracked by unique ID. Manages runtime state including damage, injuries, status effects, and UCS data.</p>

<p>Instances are automatically registered and cleaned up based on age. Max registry size prevents memory exhaustion during extended play.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Register and track a creature</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_creature'>creature</span> <span class='op'>=</span> <span class='const'>CreatureInstance</span><span class='period'>.</span><span class='id identifier rubyid_register'><span class='object_link'><a href="#register-class_method" title="Lich::Gemstone::CreatureInstance.register (method)">register</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>troll</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1234</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>troll</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_add_damage'>add_damage</span><span class='lparen'>(</span><span class='int'>50</span><span class='rparen'>)</span>
<span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_add_status'>add_status</span><span class='lparen'>(</span><span class='symbol'>:stunned</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_hp_percent'>hp_percent</span>  <span class='comment'># =&gt; 75.0</span></code></pre>
    
  </div>


</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="BODY_PARTS-constant" class="">BODY_PARTS =
          
        </dt>
        <dd><pre class="code"><span class='qwords_beg'>%w[</span><span class='tstring_content'>abdomen</span><span class='words_sep'> </span><span class='tstring_content'>back</span><span class='words_sep'> </span><span class='tstring_content'>chest</span><span class='words_sep'> </span><span class='tstring_content'>head</span><span class='words_sep'> </span><span class='tstring_content'>leftArm</span><span class='words_sep'> </span><span class='tstring_content'>leftEye</span><span class='words_sep'> </span><span class='tstring_content'>leftFoot</span><span class='words_sep'> </span><span class='tstring_content'>leftHand</span><span class='words_sep'> </span><span class='tstring_content'>leftLeg</span><span class='words_sep'> </span><span class='tstring_content'>neck</span><span class='words_sep'> </span><span class='tstring_content'>nerves</span><span class='words_sep'> </span><span class='tstring_content'>rightArm</span><span class='words_sep'> </span><span class='tstring_content'>rightEye</span><span class='words_sep'> </span><span class='tstring_content'>rightFoot</span><span class='words_sep'> </span><span class='tstring_content'>rightHand</span><span class='words_sep'> </span><span class='tstring_content'>rightLeg</span><span class='tstring_end'>]</span></span></pre></dd>
      
        <dt id="UCS_TTL-constant" class="">UCS_TTL =
          <div class="docstring">
  <div class="discussion">
    
<p>UCS data expires after 2 minutes</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>120</span></pre></dd>
      
        <dt id="UCS_SMITE_TTL-constant" class="">UCS_SMITE_TTL =
          <div class="docstring">
  <div class="discussion">
    
<p>Smite effect expires after 15 seconds</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>15</span></pre></dd>
      
        <dt id="STATUS_DURATIONS-constant" class="">STATUS_DURATIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>Status effect durations (in seconds) for auto-cleanup nil = no auto-cleanup (waits for removal message)</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>breeze</span><span class='tstring_end'>&#39;</span></span>      <span class='op'>=&gt;</span> <span class='int'>6</span><span class='comma'>,</span> <span class='comment'># 6 seconds roundtime
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bind</span><span class='tstring_end'>&#39;</span></span>        <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='comment'># 10 seconds typical
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>web</span><span class='tstring_end'>&#39;</span></span>         <span class='op'>=&gt;</span> <span class='int'>8</span><span class='comma'>,</span> <span class='comment'># 8 seconds typical
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>entangle</span><span class='tstring_end'>&#39;</span></span>    <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='comment'># 10 seconds typical
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hypnotism</span><span class='tstring_end'>&#39;</span></span>   <span class='op'>=&gt;</span> <span class='int'>12</span><span class='comma'>,</span> <span class='comment'># 12 seconds typical
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>calm</span><span class='tstring_end'>&#39;</span></span>        <span class='op'>=&gt;</span> <span class='int'>15</span><span class='comma'>,</span> <span class='comment'># 15 seconds typical
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mass_calm</span><span class='tstring_end'>&#39;</span></span>   <span class='op'>=&gt;</span> <span class='int'>15</span><span class='comma'>,</span> <span class='comment'># 15 seconds typical
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sleep</span><span class='tstring_end'>&#39;</span></span>       <span class='op'>=&gt;</span> <span class='int'>8</span><span class='comma'>,</span> <span class='comment'># 8 seconds typical (can wake early)
</span>  <span class='comment'># Statuses with reliable removal messages - no duration needed
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stunned</span><span class='tstring_end'>&#39;</span></span>     <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='comment'># Has removal messages
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>immobilized</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='comment'># Has removal messages
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>prone</span><span class='tstring_end'>&#39;</span></span>       <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>         <span class='comment'># Has removal messages
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blind</span><span class='tstring_end'>&#39;</span></span>       <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>         <span class='comment'># Has removal messages
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sunburst</span><span class='tstring_end'>&#39;</span></span>    <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='comment'># Has removal messages
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>webbed</span><span class='tstring_end'>&#39;</span></span>      <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='comment'># Has removal messages
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>poisoned</span><span class='tstring_end'>&#39;</span></span>    <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='comment'># Has removal messages
</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="instances-classvariable" class="">@@instances =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span><span class='rbrace'>}</span></pre></dd>
      
        <dt id="max_size-classvariable" class="">@@max_size =
          
        </dt>
        <dd><pre class="code"><span class='int'>1000</span></pre></dd>
      
        <dt id="auto_register-classvariable" class="">@@auto_register =
          
        </dt>
        <dd><pre class="code"><span class='kw'>true</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#created_at-instance_method" title="#created_at (instance method)">#<strong>created_at</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute created_at.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#damage_taken-instance_method" title="#damage_taken (instance method)">#<strong>damage_taken</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute damage_taken.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#fatal_crit-instance_method" title="#fatal_crit (instance method)">#<strong>fatal_crit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute fatal_crit.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#health-instance_method" title="#health (instance method)">#<strong>health</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute health.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#id-instance_method" title="#id (instance method)">#<strong>id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute id.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#injuries-instance_method" title="#injuries (instance method)">#<strong>injuries</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute injuries.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute name.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#noun-instance_method" title="#noun (instance method)">#<strong>noun</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute noun.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#status-instance_method" title="#status (instance method)">#<strong>status</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute status.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#status_timestamps-instance_method" title="#status_timestamps (instance method)">#<strong>status_timestamps</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute status_timestamps.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucs_position-instance_method" title="#ucs_position (instance method)">#<strong>ucs_position</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get UCS position tier (1-3, or nil if expired).</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucs_smote-instance_method" title="#ucs_smote (instance method)">#<strong>ucs_smote</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute ucs_smote.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucs_tierup-instance_method" title="#ucs_tierup (instance method)">#<strong>ucs_tierup</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get UCS tierup vulnerability (or nil if expired).</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucs_updated-instance_method" title="#ucs_updated (instance method)">#<strong>ucs_updated</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute ucs_updated.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#[]-class_method" title="[] (class method)">.<strong>[]</strong>(id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Lookup creature by ID.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#all-class_method" title="all (class method)">.<strong>all</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all registered instances.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#auto_register%3F-class_method" title="auto_register? (class method)">.<strong>auto_register?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if auto-registration is enabled.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleanup_old-class_method" title="cleanup_old (class method)">.<strong>cleanup_old</strong>(max_age_seconds = 600)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove old instances (cleanup).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear-class_method" title="clear (class method)">.<strong>clear</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear all instances (session reset).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#configure-class_method" title="configure (class method)">.<strong>configure</strong>(max_size: 1000, auto_register: true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Configure registry.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#damage_report-class_method" title="damage_report (class method)">.<strong>damage_report</strong>(options = {})  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate damage statistics report for HP analysis.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#full%3F-class_method" title="full? (class method)">.<strong>full?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if registry is full.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_damage_report-class_method" title="print_damage_report (class method)">.<strong>print_damage_report</strong>(options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Print formatted damage report.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register-class_method" title="register (class method)">.<strong>register</strong>(name, id, noun = nil)  &#x21d2; CreatureInstance<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Register a new creature instance in the global registry.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#size-class_method" title="size (class method)">.<strong>size</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get current registry size.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_damage-instance_method" title="#add_damage (instance method)">#<strong>add_damage</strong>(amount)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add damage to creatureâ€™s health pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_injury-instance_method" title="#add_injury (instance method)">#<strong>add_injury</strong>(body_part, amount = 1)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add injury/wound to a body part.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_status-instance_method" title="#add_status (instance method)">#<strong>add_status</strong>(status, duration = nil)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a status effect to the creature.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleanup_expired_statuses-instance_method" title="#cleanup_expired_statuses (instance method)">#<strong>cleanup_expired_statuses</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clean up expired status effects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_smote-instance_method" title="#clear_smote (instance method)">#<strong>clear_smote</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear smote status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#current_hp-instance_method" title="#current_hp (instance method)">#<strong>current_hp</strong>  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate current hit points.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dead%3F-instance_method" title="#dead? (instance method)">#<strong>dead?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if creature is dead (0 HP).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#essential_data-instance_method" title="#essential_data (instance method)">#<strong>essential_data</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Essential data for this instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fatal_crit%3F-instance_method" title="#fatal_crit? (instance method)">#<strong>fatal_crit?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if creature died from fatal crit.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_status%3F-instance_method" title="#has_status? (instance method)">#<strong>has_status?</strong>(status)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if creature has a specific status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_template%3F-instance_method" title="#has_template? (instance method)">#<strong>has_template?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if creature has template data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hp_percent-instance_method" title="#hp_percent (instance method)">#<strong>hp_percent</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate HP percentage (0-100).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(id, noun, name)  &#x21d2; CreatureInstance </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initialize a new creature instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#injured%3F-instance_method" title="#injured? (instance method)">#<strong>injured?</strong>(location, threshold = 1)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if injured at location.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#injured_locations-instance_method" title="#injured_locations (instance method)">#<strong>injured_locations</strong>(threshold = 1)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all injured locations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#low_hp%3F-instance_method" title="#low_hp? (instance method)">#<strong>low_hp?</strong>(threshold = 25)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if creature is below HP threshold.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mark_fatal_crit!-instance_method" title="#mark_fatal_crit! (instance method)">#<strong>mark_fatal_crit!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Mark creature as killed by fatal critical hit.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_hp-instance_method" title="#max_hp (instance method)">#<strong>max_hp</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get maximum HP from template, with fallback.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#position_to_tier-instance_method" title="#position_to_tier (instance method)">#<strong>position_to_tier</strong>(pos)  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convert UCS position string/number to tier (1-3).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_status-instance_method" title="#remove_status (instance method)">#<strong>remove_status</strong>(status)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove status from creature.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_damage-instance_method" title="#reset_damage (instance method)">#<strong>reset_damage</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reset damage (creature healed or respawned).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_ucs_position-instance_method" title="#set_ucs_position (instance method)">#<strong>set_ucs_position</strong>(position)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set UCS position tier.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_ucs_tierup-instance_method" title="#set_ucs_tierup (instance method)">#<strong>set_ucs_tierup</strong>(attack_type)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set UCS tierup vulnerability.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#smite!-instance_method" title="#smite! (instance method)">#<strong>smite!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Mark creature as smote (crimson mist applied).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#smote%3F-instance_method" title="#smote? (instance method)">#<strong>smote?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if creature is currently smote.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#statuses-instance_method" title="#statuses (instance method)">#<strong>statuses</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all current statuses.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#template-instance_method" title="#template (instance method)">#<strong>template</strong>  &#x21d2; CreatureTemplate<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the static template for this creature.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ucs_expired%3F-instance_method" title="#ucs_expired? (instance method)">#<strong>ucs_expired?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if UCS data has expired.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(id, noun, name)  &#x21d2; <tt><span class='object_link'><a href="" title="Lich::Gemstone::CreatureInstance (class)">CreatureInstance</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initialize a new creature instance</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Unique creature ID from game</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>noun</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Creature noun (short name)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Full creature name for template lookup</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 260</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_noun'>noun</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@noun</span> <span class='op'>=</span> <span class='id identifier rubyid_noun'>noun</span>
  <span class='ivar'>@name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@injuries</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='ivar'>@health</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@damage_taken</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@created_at</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='ivar'>@fatal_crit</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@status_timestamps</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@ucs_position</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@ucs_tierup</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@ucs_smote</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@ucs_updated</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="created_at=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="created_at-instance_method">
  
    #<strong>created_at</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute created_at.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_created_at'>created_at</span>
  <span class='ivar'>@created_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="damage_taken=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="damage_taken-instance_method">
  
    #<strong>damage_taken</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute damage_taken.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_damage_taken'>damage_taken</span>
  <span class='ivar'>@damage_taken</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="fatal_crit=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="fatal_crit-instance_method">
  
    #<strong>fatal_crit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute fatal_crit.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fatal_crit'>fatal_crit</span>
  <span class='ivar'>@fatal_crit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="health=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="health-instance_method">
  
    #<strong>health</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute health.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_health'>health</span>
  <span class='ivar'>@health</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="id=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="id-instance_method">
  
    #<strong>id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute id.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_id'>id</span>
  <span class='ivar'>@id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="injuries=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="injuries-instance_method">
  
    #<strong>injuries</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute injuries.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_injuries'>injuries</span>
  <span class='ivar'>@injuries</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="name=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="name-instance_method">
  
    #<strong>name</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute name.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="noun=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="noun-instance_method">
  
    #<strong>noun</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute noun.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_noun'>noun</span>
  <span class='ivar'>@noun</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="status=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="status-instance_method">
  
    #<strong>status</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute status.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span>
  <span class='ivar'>@status</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="status_timestamps=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="status_timestamps-instance_method">
  
    #<strong>status_timestamps</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute status_timestamps.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_status_timestamps'>status_timestamps</span>
  <span class='ivar'>@status_timestamps</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="ucs_position=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="ucs_position-instance_method">
  
    #<strong>ucs_position</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get UCS position tier (1-3, or nil if expired)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


423
424
425</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 423</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucs_position'>ucs_position</span>
  <span class='ivar'>@ucs_position</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="ucs_smote=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="ucs_smote-instance_method">
  
    #<strong>ucs_smote</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute ucs_smote.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucs_smote'>ucs_smote</span>
  <span class='ivar'>@ucs_smote</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="ucs_tierup=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="ucs_tierup-instance_method">
  
    #<strong>ucs_tierup</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get UCS tierup vulnerability (or nil if expired)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


429
430
431</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 429</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucs_tierup'>ucs_tierup</span>
  <span class='ivar'>@ucs_tierup</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="ucs_updated=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="ucs_updated-instance_method">
  
    #<strong>ucs_updated</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute ucs_updated.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucs_updated'>ucs_updated</span>
  <span class='ivar'>@ucs_updated</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="[]-class_method">
  
    .<strong>[]</strong>(id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Lookup creature by ID</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


606
607
608</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 606</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='cvar'>@@instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="all-class_method">
  
    .<strong>all</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all registered instances</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


611
612
613</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 611</span>

<span class='kw'>def</span> <span class='id identifier rubyid_all'>all</span>
  <span class='cvar'>@@instances</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="auto_register?-class_method">
  
    .<strong>auto_register?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if auto-registration is enabled</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


560
561
562</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 560</span>

<span class='kw'>def</span> <span class='id identifier rubyid_auto_register?'>auto_register?</span>
  <span class='cvar'>@@auto_register</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cleanup_old-class_method">
  
    .<strong>cleanup_old</strong>(max_age_seconds = 600)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove old instances (cleanup)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


621
622
623
624
625
626</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 621</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_old'>cleanup_old</span><span class='lparen'>(</span><span class='id identifier rubyid_max_age_seconds'>max_age_seconds</span> <span class='op'>=</span> <span class='int'>600</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cutoff'>cutoff</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='id identifier rubyid_max_age_seconds'>max_age_seconds</span>
  <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='cvar'>@@instances</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='id identifier rubyid_instance'>instance</span><span class='op'>|</span> <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_cutoff'>cutoff</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='cvar'>@@instances</span><span class='period'>.</span><span class='id identifier rubyid_reject!'>reject!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='id identifier rubyid_instance'>instance</span><span class='op'>|</span> <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_cutoff'>cutoff</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_removed'>removed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clear-class_method">
  
    .<strong>clear</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear all instances (session reset)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


616
617
618</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 616</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear'><span class='object_link'><a href="../../top-level-namespace.html#clear-instance_method" title="#clear (method)">clear</a></span></span>
  <span class='cvar'>@@instances</span><span class='period'>.</span><span class='id identifier rubyid_clear'><span class='object_link'><a href="../../top-level-namespace.html#clear-instance_method" title="#clear (method)">clear</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="configure-class_method">
  
    .<strong>configure</strong>(max_size: 1000, auto_register: true)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Configure registry</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


554
555
556
557</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 554</span>

<span class='kw'>def</span> <span class='id identifier rubyid_configure'>configure</span><span class='lparen'>(</span><span class='label'>max_size:</span> <span class='int'>1000</span><span class='comma'>,</span> <span class='label'>auto_register:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='cvar'>@@max_size</span> <span class='op'>=</span> <span class='id identifier rubyid_max_size'>max_size</span>
  <span class='cvar'>@@auto_register</span> <span class='op'>=</span> <span class='id identifier rubyid_auto_register'>auto_register</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="damage_report-class_method">
  
    .<strong>damage_report</strong>(options = {})  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate damage statistics report for HP analysis</p>

<p>Analyzes damage data from all tracked creatures to estimate max HP. Fatal crit deaths are excluded by default (they skew max HP calculations).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Report options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:min_samples</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Minimum samples per creature (default 2)</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:sort_by</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Sort order (:name, :max_damage, :avg_damage)</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:include_fatal</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Include fatal crit deaths in analysis</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of stat hashes with :name, :count, :min_damage, etc.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 638</span>

<span class='kw'>def</span> <span class='id identifier rubyid_damage_report'>damage_report</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_min_samples'>min_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_samples</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>2</span>
  <span class='id identifier rubyid_sort_by'>sort_by</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:sort_by</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='symbol'>:name</span> <span class='comment'># :name, :max_damage, :avg_damage
</span>  <span class='id identifier rubyid_include_fatal'>include_fatal</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:include_fatal</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='kw'>false</span>

  <span class='comment'># Group creatures by name and collect damage data
</span>  <span class='id identifier rubyid_creature_data'>creature_data</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_fatal_crit_data'>fatal_crit_data</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='cvar'>@@instances</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_instance'>instance</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_damage_taken'>damage_taken</span> <span class='op'>&lt;=</span> <span class='int'>0</span>

    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_fatal_crit?'>fatal_crit?</span>
      <span class='comment'># Track fatal crit deaths separately
</span>      <span class='id identifier rubyid_fatal_crit_data'>fatal_crit_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_fatal_crit_data'>fatal_crit_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_damage_taken'>damage_taken</span>

      <span class='comment'># Include in main data only if requested
</span>      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_include_fatal'>include_fatal</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_creature_data'>creature_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_creature_data'>creature_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_damage_taken'>damage_taken</span>
  <span class='kw'>end</span>

  <span class='comment'># Calculate statistics for each creature type
</span>  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_creature_data'>creature_data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_damages'>damages</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_damages'>damages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_min_samples'>min_samples</span>

    <span class='id identifier rubyid_damages'>damages</span><span class='period'>.</span><span class='id identifier rubyid_sort!'>sort!</span>
    <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_damages'>damages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_min_dmg'>min_dmg</span> <span class='op'>=</span> <span class='id identifier rubyid_damages'>damages</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_max_dmg'>max_dmg</span> <span class='op'>=</span> <span class='id identifier rubyid_damages'>damages</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_avg_dmg'>avg_dmg</span> <span class='op'>=</span> <span class='id identifier rubyid_damages'>damages</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_count'>count</span>
    <span class='id identifier rubyid_median_dmg'>median_dmg</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_odd?'>odd?</span>
                   <span class='id identifier rubyid_damages'>damages</span><span class='lbracket'>[</span><span class='id identifier rubyid_count'>count</span> <span class='op'>/</span> <span class='int'>2</span><span class='rbracket'>]</span>
                 <span class='kw'>else</span>
                   <span class='lparen'>(</span><span class='id identifier rubyid_damages'>damages</span><span class='lbracket'>[</span><span class='id identifier rubyid_count'>count</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_damages'>damages</span><span class='lbracket'>[</span><span class='id identifier rubyid_count'>count</span> <span class='op'>/</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>2.0</span>
                 <span class='kw'>end</span>

    <span class='comment'># Count fatal crit deaths for this creature type
</span>    <span class='id identifier rubyid_fatal_count'>fatal_count</span> <span class='op'>=</span> <span class='id identifier rubyid_fatal_crit_data'>fatal_crit_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>||</span> <span class='int'>0</span>

    <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span>
      <span class='label'>name:</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
      <span class='label'>count:</span> <span class='id identifier rubyid_count'>count</span><span class='comma'>,</span>
      <span class='label'>min_damage:</span> <span class='id identifier rubyid_min_dmg'>min_dmg</span><span class='comma'>,</span>
      <span class='label'>max_damage:</span> <span class='id identifier rubyid_max_dmg'>max_dmg</span><span class='comma'>,</span>
      <span class='label'>avg_damage:</span> <span class='id identifier rubyid_avg_dmg'>avg_dmg</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>median_damage:</span> <span class='id identifier rubyid_median_dmg'>median_dmg</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>fatal_crits:</span> <span class='id identifier rubyid_fatal_count'>fatal_count</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='comment'># Sort results
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_sort_by'>sort_by</span>
  <span class='kw'>when</span> <span class='symbol'>:max_damage</span>
    <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_sort_by!'>sort_by!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='op'>-</span><span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:max_damage</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='symbol'>:avg_damage</span>
    <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_sort_by!'>sort_by!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='op'>-</span><span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:avg_damage</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_sort_by!'>sort_by!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="full?-class_method">
  
    .<strong>full?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if registry is full</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


570
571
572</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 570</span>

<span class='kw'>def</span> <span class='id identifier rubyid_full?'>full?</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;=</span> <span class='cvar'>@@max_size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_damage_report-class_method">
  
    .<strong>print_damage_report</strong>(options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Print formatted damage report</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 709</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_damage_report'>print_damage_report</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_damage_report'>damage_report</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No damage data available (need at least </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_samples</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>2</span><span class='embexpr_end'>}</span><span class='tstring_content'> samples per creature)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_puts'>puts</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>90</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CREATURE DAMAGE ANALYSIS REPORT</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>90</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Total creature instances tracked: </span><span class='embexpr_beg'>#{</span><span class='cvar'>@@instances</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creature types with damage data: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fatal crits excluded from analysis (they skew max HP calculations)</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span>

  <span class='comment'># Print header
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%-35s %5s %5s %5s %7s %7s %6s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creature Name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Count</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Min</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Max</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Avg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Median</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fatal</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>90</span>

  <span class='comment'># Print data rows
</span>  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%-35s %5d %5d %5d %7.1f %7.1f %6d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>35</span> <span class='op'>?</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>32</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:min_damage</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:max_damage</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:avg_damage</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:median_damage</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:fatal_crits</span><span class='rbracket'>]</span>
    <span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>90</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Max damage likely indicates creature&#39;s max HP (fatal crits excluded)</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fatal = number of creatures killed by fatal crits (not HP loss)</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Use ;creature_report sort:max to sort by highest max damage</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Use ;creature_report include_fatal to include fatal crit deaths in analysis</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register-class_method">
  
    .<strong>register</strong>(name, id, noun = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Lich::Gemstone::CreatureInstance (class)">CreatureInstance</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Returns nil if registry is full after cleanup attempts</p>
</div>
  </div>


<p>Register a new creature instance in the global registry</p>

<p>Auto-cleanup triggers if registry is full, progressively removing older creatures (15min, 10min, 5min, 2min thresholds).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Creature name for template lookup</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Unique creature ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>noun</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Creature noun (short name)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Lich::Gemstone::CreatureInstance (class)">CreatureInstance</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>New instance or existing if already registered</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 584</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_noun'>noun</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_auto_register?'>auto_register?</span>
  <span class='kw'>return</span> <span class='cvar'>@@instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='cvar'>@@instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span> <span class='comment'># Already exists
</span>
  <span class='comment'># Auto-cleanup old instances if registry is full - get progressively more aggressive
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_full?'>full?</span>
    <span class='comment'># Try 15 minutes, then 10, then 5, then 2, then give up
</span>    <span class='lbracket'>[</span><span class='int'>900</span><span class='comma'>,</span> <span class='int'>600</span><span class='comma'>,</span> <span class='int'>300</span><span class='comma'>,</span> <span class='int'>120</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_age_threshold'>age_threshold</span><span class='op'>|</span>
      <span class='id identifier rubyid_removed'>removed</span> <span class='op'>=</span> <span class='id identifier rubyid_cleanup_old'>cleanup_old</span><span class='lparen'>(</span><span class='id identifier rubyid_age_threshold'>age_threshold</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--- Auto-cleanup: removed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_removed'>removed</span><span class='embexpr_end'>}</span><span class='tstring_content'> old creatures (threshold: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_age_threshold'>age_threshold</span><span class='embexpr_end'>}</span><span class='tstring_content'>s)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_removed'>removed</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='gvar'>$creature_debug</span>
      <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_full?'>full?</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_full?'>full?</span> <span class='comment'># Still full after all cleanup attempts
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_instance'>instance</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_noun'>noun</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='cvar'>@@instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_instance'>instance</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--- Creature registered: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
  <span class='id identifier rubyid_instance'>instance</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="size-class_method">
  
    .<strong>size</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get current registry size</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


565
566
567</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 565</span>

<span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
  <span class='cvar'>@@instances</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_damage-instance_method">
  
    #<strong>add_damage</strong>(amount)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Add damage to creatureâ€™s health pool</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_add_damage'>add_damage</span><span class='lparen'>(</span><span class='int'>50</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_current_hp'>current_hp</span>  <span class='comment'># =&gt; 350 (if max_hp is 400)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>amount</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Damage points to add</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


475
476
477</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 475</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_damage'>add_damage</span><span class='lparen'>(</span><span class='id identifier rubyid_amount'>amount</span><span class='rparen'>)</span>
  <span class='ivar'>@damage_taken</span> <span class='op'>+=</span> <span class='id identifier rubyid_amount'>amount</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_injury-instance_method">
  
    #<strong>add_injury</strong>(body_part, amount = 1)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add injury/wound to a body part</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_add_injury'>add_injury</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>leftArm</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>3</span><span class='rparen'>)</span>  <span class='comment'># Rank 3 wound to left arm</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>body_part</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Body part from BODY_PARTS constant</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>amount</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Wound rank to add (default 1)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If body part is invalid</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


441
442
443
444
445
446</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 441</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_injury'>add_injury</span><span class='lparen'>(</span><span class='id identifier rubyid_body_part'>body_part</span><span class='comma'>,</span> <span class='id identifier rubyid_amount'>amount</span> <span class='op'>=</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#BODY_PARTS-constant" title="Lich::Gemstone::CreatureInstance::BODY_PARTS (constant)">BODY_PARTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_body_part'>body_part</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid body part: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_body_part'>body_part</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@injuries</span><span class='lbracket'>[</span><span class='id identifier rubyid_body_part'>body_part</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_amount'>amount</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_status-instance_method">
  
    #<strong>add_status</strong>(status, duration = nil)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Add a status effect to the creature</p>

<p>Status effects like :stunned, :prone, :webbed are tracked with optional auto-expiration based on STATUS_DURATIONS.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_add_status'>add_status</span><span class='lparen'>(</span><span class='symbol'>:stunned</span><span class='rparen'>)</span>
<span class='id identifier rubyid_creature'>creature</span><span class='period'>.</span><span class='id identifier rubyid_add_status'>add_status</span><span class='lparen'>(</span><span class='symbol'>:custom_debuff</span><span class='comma'>,</span> <span class='int'>30</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>status</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Status effect to add</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>duration</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Duration in seconds (overrides default)</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


301
302
303
304
305
306
307
308
309
310
311
312
313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 301</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_status'>add_status</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_duration'>duration</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>

  <span class='ivar'>@status</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_status'>status</span>

  <span class='comment'># Set expiration timestamp for timed statuses
</span>  <span class='id identifier rubyid_status_key'>status_key</span> <span class='op'>=</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
  <span class='id identifier rubyid_duration'>duration</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="#STATUS_DURATIONS-constant" title="Lich::Gemstone::CreatureInstance::STATUS_DURATIONS (constant)">STATUS_DURATIONS</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_status_key'>status_key</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_duration'>duration</span>
    <span class='ivar'>@status_timestamps</span><span class='lbracket'>[</span><span class='id identifier rubyid_status'>status</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_duration'>duration</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  +status: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'> (expires in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_duration'>duration</span><span class='embexpr_end'>}</span><span class='tstring_content'>s)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  +status: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'> (no auto-expiry)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cleanup_expired_statuses-instance_method">
  
    #<strong>cleanup_expired_statuses</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This is called frequently - performance sensitive</p>
</div>
  </div>

<p class="note returns_void">This method returns an undefined value.</p>
<p>Clean up expired status effects</p>

<p>Called automatically by has_status? and statuses methods. Removes any status whose expiration timestamp has passed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


331
332
333
334
335
336
337
338
339
340</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 331</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_expired_statuses'>cleanup_expired_statuses</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@status_timestamps</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='ivar'>@status_timestamps</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_now'>now</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='ivar'>@status_timestamps</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__status'>_status</span><span class='comma'>,</span> <span class='id identifier rubyid_expires_at'>expires_at</span><span class='op'>|</span> <span class='id identifier rubyid_expires_at'>expires_at</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_now'>now</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_expired_status'>expired_status</span><span class='op'>|</span>
    <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_expired_status'>expired_status</span><span class='rparen'>)</span>
    <span class='ivar'>@status_timestamps</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_expired_status'>expired_status</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  ~status: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_expired_status'>expired_status</span><span class='embexpr_end'>}</span><span class='tstring_content'> (auto-expired)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clear_smote-instance_method">
  
    #<strong>clear_smote</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear smote status</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


410
411
412
413
414</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 410</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_smote'>clear_smote</span>
  <span class='ivar'>@ucs_smote</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@ucs_updated</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  UCS: smote cleared</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="current_hp-instance_method">
  
    #<strong>current_hp</strong>  &#x21d2; <tt>Integer</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate current hit points</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Current HP (max_hp - damage_taken), or nil if max_hp unknown</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


503
504
505
506</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 503</span>

<span class='kw'>def</span> <span class='id identifier rubyid_current_hp'>current_hp</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_max_hp'>max_hp</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_max_hp'>max_hp</span> <span class='op'>-</span> <span class='ivar'>@damage_taken</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dead?-instance_method">
  
    #<strong>dead?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if creature is dead (0 HP)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


521
522
523</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 521</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dead?'>dead?</span>
  <span class='id identifier rubyid_current_hp'>current_hp</span> <span class='op'>==</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="essential_data-instance_method">
  
    #<strong>essential_data</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Essential data for this instance</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 531</span>

<span class='kw'>def</span> <span class='id identifier rubyid_essential_data'>essential_data</span>
  <span class='lbrace'>{</span>
    <span class='label'>id:</span> <span class='ivar'>@id</span><span class='comma'>,</span>
    <span class='label'>noun:</span> <span class='ivar'>@noun</span><span class='comma'>,</span>
    <span class='label'>name:</span> <span class='ivar'>@name</span><span class='comma'>,</span>
    <span class='label'>status:</span> <span class='ivar'>@status</span><span class='comma'>,</span>
    <span class='label'>injuries:</span> <span class='ivar'>@injuries</span><span class='comma'>,</span>
    <span class='label'>health:</span> <span class='ivar'>@health</span><span class='comma'>,</span>
    <span class='label'>damage_taken:</span> <span class='ivar'>@damage_taken</span><span class='comma'>,</span>
    <span class='label'>max_hp:</span> <span class='id identifier rubyid_max_hp'>max_hp</span><span class='comma'>,</span>
    <span class='label'>current_hp:</span> <span class='id identifier rubyid_current_hp'>current_hp</span><span class='comma'>,</span>
    <span class='label'>hp_percent:</span> <span class='id identifier rubyid_hp_percent'>hp_percent</span><span class='comma'>,</span>
    <span class='label'>has_template:</span> <span class='id identifier rubyid_has_template?'>has_template?</span><span class='comma'>,</span>
    <span class='label'>created_at:</span> <span class='ivar'>@created_at</span><span class='comma'>,</span>
    <span class='label'>ucs_position:</span> <span class='id identifier rubyid_ucs_position'>ucs_position</span><span class='comma'>,</span>
    <span class='label'>ucs_tierup:</span> <span class='id identifier rubyid_ucs_tierup'>ucs_tierup</span><span class='comma'>,</span>
    <span class='label'>ucs_smote:</span> <span class='id identifier rubyid_smote?'>smote?</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fatal_crit?-instance_method">
  
    #<strong>fatal_crit?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if creature died from fatal crit</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 459</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fatal_crit?'>fatal_crit?</span>
  <span class='ivar'>@fatal_crit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_status?-instance_method">
  
    #<strong>has_status?</strong>(status)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if creature has a specific status</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


343
344
345
346</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 343</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_status?'>has_status?</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cleanup_expired_statuses'>cleanup_expired_statuses</span> <span class='comment'># Clean up expired statuses first
</span>  <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_template?-instance_method">
  
    #<strong>has_template?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if creature has template data</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


286
287
288</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 286</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_template?'>has_template?</span>
  <span class='op'>!</span><span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hp_percent-instance_method">
  
    #<strong>hp_percent</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate HP percentage (0-100)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


509
510
511
512</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 509</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hp_percent'>hp_percent</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_max_hp'>max_hp</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_max_hp'>max_hp</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_current_hp'>current_hp</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_max_hp'>max_hp</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>100</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="injured?-instance_method">
  
    #<strong>injured?</strong>(location, threshold = 1)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if injured at location</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


449
450
451</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 449</span>

<span class='kw'>def</span> <span class='id identifier rubyid_injured?'>injured?</span><span class='lparen'>(</span><span class='id identifier rubyid_location'>location</span><span class='comma'>,</span> <span class='id identifier rubyid_threshold'>threshold</span> <span class='op'>=</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='ivar'>@injuries</span><span class='lbracket'>[</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_threshold'>threshold</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="injured_locations-instance_method">
  
    #<strong>injured_locations</strong>(threshold = 1)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all injured locations</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


464
465
466</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 464</span>

<span class='kw'>def</span> <span class='id identifier rubyid_injured_locations'>injured_locations</span><span class='lparen'>(</span><span class='id identifier rubyid_threshold'>threshold</span> <span class='op'>=</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='ivar'>@injuries</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_threshold'>threshold</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="low_hp?-instance_method">
  
    #<strong>low_hp?</strong>(threshold = 25)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if creature is below HP threshold</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


515
516
517
518</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 515</span>

<span class='kw'>def</span> <span class='id identifier rubyid_low_hp?'>low_hp?</span><span class='lparen'>(</span><span class='id identifier rubyid_threshold'>threshold</span> <span class='op'>=</span> <span class='int'>25</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_hp_percent'>hp_percent</span>
  <span class='id identifier rubyid_hp_percent'>hp_percent</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_threshold'>threshold</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mark_fatal_crit!-instance_method">
  
    #<strong>mark_fatal_crit!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Mark creature as killed by fatal critical hit</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


454
455
456</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 454</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mark_fatal_crit!'>mark_fatal_crit!</span>
  <span class='ivar'>@fatal_crit</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_hp-instance_method">
  
    #<strong>max_hp</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get maximum HP from template, with fallback</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 480</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_hp'>max_hp</span>
  <span class='comment'># Try template first
</span>  <span class='id identifier rubyid_hp'>hp</span> <span class='op'>=</span> <span class='id identifier rubyid_template'>template</span><span class='op'>&amp;.</span><span class='id identifier rubyid_max_hp'>max_hp</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_hp'>hp</span> <span class='kw'>if</span> <span class='id identifier rubyid_hp'>hp</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_hp'>hp</span> <span class='op'>&gt;</span> <span class='int'>0</span>

  <span class='comment'># Fall back to combat tracker setting if available
</span>  <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Gemstone.html" title="Lich::Gemstone (module)">Gemstone</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Combat.html" title="Lich::Gemstone::Combat (module)">Combat</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Combat/Tracker.html" title="Lich::Gemstone::Combat::Tracker (module)">Tracker</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
       <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Gemstone.html" title="Lich::Gemstone (module)">Gemstone</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Combat.html" title="Lich::Gemstone::Combat (module)">Combat</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Combat/Tracker.html" title="Lich::Gemstone::Combat::Tracker (module)">Tracker</a></span></span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:fallback_hp</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fallback'>fallback</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Gemstone.html" title="Lich::Gemstone (module)">Gemstone</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Combat.html" title="Lich::Gemstone::Combat (module)">Combat</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Combat/Tracker.html" title="Lich::Gemstone::Combat::Tracker (module)">Tracker</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fallback_hp'><span class='object_link'><a href="Combat/Tracker.html#fallback_hp-class_method" title="Lich::Gemstone::Combat::Tracker.fallback_hp (method)">fallback_hp</a></span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_fallback'>fallback</span> <span class='kw'>if</span> <span class='id identifier rubyid_fallback'>fallback</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fallback'>fallback</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span>
    <span class='comment'># Ignore errors accessing tracker
</span>  <span class='kw'>end</span>

  <span class='comment'># Last resort: hardcoded fallback
</span>  <span class='int'>400</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="position_to_tier-instance_method">
  
    #<strong>position_to_tier</strong>(pos)  &#x21d2; <tt>Integer</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Convert UCS position string/number to tier (1-3)</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>pos</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Position value (â€œdecentâ€/â€œgoodâ€/â€œexcellentâ€ or 1/2/3)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Tier number (1-3) or nil if invalid</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


360
361
362
363
364
365
366
367</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 360</span>

<span class='kw'>def</span> <span class='id identifier rubyid_position_to_tier'>position_to_tier</span><span class='lparen'>(</span><span class='id identifier rubyid_pos'>pos</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_pos'>pos</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>decent</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='int'>1</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>good</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='int'>2</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>excellent</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>3</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='int'>3</span>
  <span class='kw'>else</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_status-instance_method">
  
    #<strong>remove_status</strong>(status)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove status from creature</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


318
319
320
321
322</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 318</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_status'>remove_status</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
  <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
  <span class='ivar'>@status_timestamps</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  -status: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_damage-instance_method">
  
    #<strong>reset_damage</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reset damage (creature healed or respawned)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


526
527
528</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 526</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_damage'>reset_damage</span>
  <span class='ivar'>@damage_taken</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_ucs_position-instance_method">
  
    #<strong>set_ucs_position</strong>(position)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set UCS position tier</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


370
371
372
373
374
375
376
377
378
379
380</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 370</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_ucs_position'>set_ucs_position</span><span class='lparen'>(</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_tier'>new_tier</span> <span class='op'>=</span> <span class='id identifier rubyid_position_to_tier'>position_to_tier</span><span class='lparen'>(</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_new_tier'>new_tier</span>

  <span class='comment'># Clear tierup if tier changed
</span>  <span class='ivar'>@ucs_tierup</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_new_tier'>new_tier</span> <span class='op'>!=</span> <span class='ivar'>@ucs_position</span>

  <span class='ivar'>@ucs_position</span> <span class='op'>=</span> <span class='id identifier rubyid_new_tier'>new_tier</span>
  <span class='ivar'>@ucs_updated</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  UCS: position=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_tier'>new_tier</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_ucs_tierup-instance_method">
  
    #<strong>set_ucs_tierup</strong>(attack_type)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set UCS tierup vulnerability</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


383
384
385
386
387</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 383</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_ucs_tierup'>set_ucs_tierup</span><span class='lparen'>(</span><span class='id identifier rubyid_attack_type'>attack_type</span><span class='rparen'>)</span>
  <span class='ivar'>@ucs_tierup</span> <span class='op'>=</span> <span class='id identifier rubyid_attack_type'>attack_type</span>
  <span class='ivar'>@ucs_updated</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  UCS: tierup=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attack_type'>attack_type</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="smite!-instance_method">
  
    #<strong>smite!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Mark creature as smote (crimson mist applied)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


390
391
392
393
394</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 390</span>

<span class='kw'>def</span> <span class='id identifier rubyid_smite!'>smite!</span>
  <span class='ivar'>@ucs_smote</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='ivar'>@ucs_updated</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  UCS: smote!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$creature_debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="smote?-instance_method">
  
    #<strong>smote?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if creature is currently smote</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


397
398
399
400
401
402
403
404
405
406
407</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 397</span>

<span class='kw'>def</span> <span class='id identifier rubyid_smote?'>smote?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='ivar'>@ucs_smote</span>

  <span class='comment'># Check if smite effect has expired
</span>  <span class='kw'>if</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@ucs_smote</span> <span class='op'>&gt;</span> <span class='const'><span class='object_link'><a href="#UCS_SMITE_TTL-constant" title="Lich::Gemstone::CreatureInstance::UCS_SMITE_TTL (constant)">UCS_SMITE_TTL</a></span></span>
    <span class='ivar'>@ucs_smote</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="statuses-instance_method">
  
    #<strong>statuses</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all current statuses</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


349
350
351
352</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 349</span>

<span class='kw'>def</span> <span class='id identifier rubyid_statuses'>statuses</span>
  <span class='id identifier rubyid_cleanup_expired_statuses'>cleanup_expired_statuses</span> <span class='comment'># Clean up expired statuses first
</span>  <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="template-instance_method">
  
    #<strong>template</strong>  &#x21d2; <tt><span class='object_link'><a href="CreatureTemplate.html" title="Lich::Gemstone::CreatureTemplate (class)">CreatureTemplate</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Result is memoized for performance</p>
</div>
  </div>


<p>Get the static template for this creature</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="CreatureTemplate.html" title="Lich::Gemstone::CreatureTemplate (class)">CreatureTemplate</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Associated template or nil if none found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


281
282
283</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 281</span>

<span class='kw'>def</span> <span class='id identifier rubyid_template'>template</span>
  <span class='ivar'>@template</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="CreatureTemplate.html" title="Lich::Gemstone::CreatureTemplate (class)">CreatureTemplate</a></span></span><span class='lbracket'>[</span><span class='ivar'>@name</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ucs_expired?-instance_method">
  
    #<strong>ucs_expired?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if UCS data has expired</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


417
418
419
420</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/creature.rb', line 417</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ucs_expired?'>ucs_expired?</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='ivar'>@ucs_updated</span>
  <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@ucs_updated</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='const'><span class='object_link'><a href="#UCS_TTL-constant" title="Lich::Gemstone::CreatureInstance::UCS_TTL (constant)">UCS_TTL</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Nov 23 01:38:44 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.2.9).
</div>

    </div>
  </body>
</html>