<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Lich::Gemstone::QStrike
  
    &mdash; Lich 5 Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::Gemstone::QStrike";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (Q)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Gemstone.html" title="Lich::Gemstone (module)">Gemstone</a></span></span>
     &raquo; 
    <span class="title">QStrike</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Lich::Gemstone::QStrike
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>documented/gemstone/psms/qstrike.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>QStrike module calculates optimal QSTRIKE roundtime reduction while avoiding negative stamina. Accounts for weapon speeds, attack costs, and Striking Asp stance discounts.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Basic calculation</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'>QStrike</span><span class='period'>.</span><span class='id identifier rubyid_calculate'><span class='object_link'><a href="#calculate-class_method" title="Lich::Gemstone::QStrike.calculate (method)">calculate</a></span></span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>attack_name:</span> <span class='symbol'>:cripple</span><span class='rparen'>)</span>
<span class='comment'># =&gt; { seconds: 2, stamina_cost: 30, qstrike_cmd: &quot;qstrike -2&quot;, ... }</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Get just the command string</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'>QStrike</span><span class='period'>.</span><span class='id identifier rubyid_command'><span class='object_link'><a href="#command-class_method" title="Lich::Gemstone::QStrike.command (method)">command</a></span></span><span class='lparen'>(</span><span class='label'>attack_name:</span> <span class='symbol'>:tackle</span><span class='comma'>,</span> <span class='label'>reserve:</span> <span class='int'>5</span><span class='rparen'>)</span>
<span class='comment'># =&gt; &quot;qstrike -3&quot;</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Execute qstrike + attack</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'>QStrike</span><span class='period'>.</span><span class='id identifier rubyid_use'><span class='object_link'><a href="#use-class_method" title="Lich::Gemstone::QStrike.use (method)">use</a></span></span><span class='lparen'>(</span><span class='label'>reduction:</span> <span class='op'>-</span><span class='int'>3</span><span class='comma'>,</span> <span class='label'>attack:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cripple</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>target:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>kobold</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'># Executes: put &quot;qstrike -3&quot; then CMan.use(&quot;cripple&quot;, &quot;kobold&quot;)</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Absolute RT mode (reduce to 2 second RT)</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'>QStrike</span><span class='period'>.</span><span class='id identifier rubyid_use'><span class='object_link'><a href="#use-class_method" title="Lich::Gemstone::QStrike.use (method)">use</a></span></span><span class='lparen'>(</span><span class='label'>reduction:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>attack:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attack</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>target:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>troll</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Set defaults</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'>QStrike</span><span class='period'>.</span><span class='id identifier rubyid_set_default'><span class='object_link'><a href="#set_default-class_method" title="Lich::Gemstone::QStrike.set_default (method)">set_default</a></span></span><span class='lparen'>(</span><span class='symbol'>:reserve</span><span class='comma'>,</span> <span class='int'>5</span><span class='rparen'>)</span>
<span class='const'>QStrike</span><span class='period'>.</span><span class='id identifier rubyid_set_default'><span class='object_link'><a href="#set_default-class_method" title="Lich::Gemstone::QStrike.set_default (method)">set_default</a></span></span><span class='lparen'>(</span><span class='symbol'>:adaptive</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span></code></pre>
    
  </div>


</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="SPEED_MULTIPLIERS-constant" class="">SPEED_MULTIPLIERS =
          <div class="docstring">
  <div class="discussion">
    
<p>Speed multipliers by weapon category Applied per-weapon to calculate Equipment Speed</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='label'>two_handed:</span> <span class='float'>1.5</span><span class='comma'>,</span>
  <span class='label'>polearm:</span> <span class='float'>1.5</span><span class='comma'>,</span>
  <span class='label'>ranged:</span> <span class='float'>2.5</span><span class='comma'>,</span>
  <span class='comment'># All others default to 1.0
</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="DEFAULT_MULTIPLIER-constant" class="">DEFAULT_MULTIPLIER =
          <div class="docstring">
  <div class="discussion">
    
<p>All others default to 1.0</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='float'>1.0</span></pre></dd>
      
        <dt id="STRIKING_ASP_MULTIPLIERS-constant" class="">STRIKING_ASP_MULTIPLIERS =
          <div class="docstring">
  <div class="discussion">
    
<p>Striking Asp stance cost multipliers by rank Rank 1 = 2/3 cost, Rank 2 = 1/2 cost, Rank 3 = 1/3 cost</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='int'>1</span> <span class='op'>=&gt;</span> <span class='float'>2.0</span> <span class='op'>/</span> <span class='float'>3.0</span><span class='comma'>,</span>  <span class='comment'># 0.667
</span>  <span class='int'>2</span> <span class='op'>=&gt;</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='float'>2.0</span><span class='comma'>,</span>  <span class='comment'># 0.500
</span>  <span class='int'>3</span> <span class='op'>=&gt;</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='float'>3.0</span><span class='comma'>,</span>  <span class='comment'># 0.333
</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="BASE_COST-constant" class="">BASE_COST =
          <div class="docstring">
  <div class="discussion">
    
<p>Base cost constant from formula</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>10</span></pre></dd>
      
        <dt id="MAX_REDUCTION-constant" class="">MAX_REDUCTION =
          <div class="docstring">
  <div class="discussion">
    
<p>Maximum seconds of RT reduction (reasonable upper bound)</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>8</span></pre></dd>
      
        <dt id="VALID_ACTIONS-constant" class="">VALID_ACTIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>Valid combat actions that can use QSTRIKE</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='qwords_beg'>%w[</span><span class='words_sep'>
  </span><span class='tstring_content'>ascension</span><span class='words_sep'> </span><span class='tstring_content'>ambush</span><span class='words_sep'> </span><span class='tstring_content'>attack</span><span class='words_sep'> </span><span class='tstring_content'>cheapshot</span><span class='words_sep'> </span><span class='tstring_content'>cman</span><span class='words_sep'> </span><span class='tstring_content'>cock</span><span class='words_sep'> </span><span class='tstring_content'>disarm</span><span class='words_sep'> </span><span class='tstring_content'>feat</span><span class='words_sep'> </span><span class='tstring_content'>fire</span><span class='words_sep'>
  </span><span class='tstring_content'>grapple</span><span class='words_sep'> </span><span class='tstring_content'>hurl</span><span class='words_sep'> </span><span class='tstring_content'>jab</span><span class='words_sep'> </span><span class='tstring_content'>kill</span><span class='words_sep'> </span><span class='tstring_content'>kick</span><span class='words_sep'> </span><span class='tstring_content'>mstrike</span><span class='words_sep'> </span><span class='tstring_content'>punch</span><span class='words_sep'> </span><span class='tstring_content'>shield</span><span class='words_sep'> </span><span class='tstring_content'>smite</span><span class='words_sep'>
  </span><span class='tstring_content'>stunman</span><span class='words_sep'> </span><span class='tstring_content'>subdue</span><span class='words_sep'> </span><span class='tstring_content'>sweep</span><span class='words_sep'> </span><span class='tstring_content'>tackle</span><span class='words_sep'> </span><span class='tstring_content'>trip</span><span class='words_sep'> </span><span class='tstring_content'>weapon</span><span class='words_sep'> </span><span class='tstring_content'>wtricks</span><span class='words_sep'>
</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="DEFAULT_SETTINGS-constant" class="">DEFAULT_SETTINGS =
          <div class="docstring">
  <div class="discussion">
    
<p>Default settings</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='label'>reserve:</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='label'>adaptive:</span> <span class='kw'>false</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="TECHNIQUE_MODULES-constant" class="">TECHNIQUE_MODULES =
          <div class="docstring">
  <div class="discussion">
    
<p>Module lookup configuration: [Module, class_var, type_symbol]</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='lbracket'>[</span><span class='symbol'>:CMan</span><span class='comma'>,</span> <span class='symbol'>:@@combat_mans</span><span class='comma'>,</span> <span class='symbol'>:cman</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='symbol'>:Weapon</span><span class='comma'>,</span> <span class='symbol'>:@@weapon_techniques</span><span class='comma'>,</span> <span class='symbol'>:weapon</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='symbol'>:Shield</span><span class='comma'>,</span> <span class='symbol'>:@@shield_techniques</span><span class='comma'>,</span> <span class='symbol'>:shield</span><span class='rbracket'>]</span><span class='comma'>,</span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#affordable%3F-class_method" title="affordable? (class method)">.<strong>affordable?</strong>(reserve: nil, attack_cost: 0, attack_name: nil, attack_rt: nil)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if any QSTRIKE reduction is affordable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#base_rt-class_method" title="base_rt (class method)">.<strong>base_rt</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get base RT for current weapon setup Uses the primary weapon’s base RT.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_attack_command-class_method" title="build_attack_command (class method)">.<strong>build_attack_command</strong>(attack, target = nil)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Build attack command string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cache_cost-class_method" title="cache_cost (class method)">.<strong>cache_cost</strong>(cost)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Store cost in cache with current hand state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate-class_method" title="calculate (class method)">.<strong>calculate</strong>(reserve: nil, attack_cost: 0, attack_name: nil, attack_rt: nil)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate optimal QSTRIKE reduction that won’t cause negative stamina.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_cache-class_method" title="clear_cache (class method)">.<strong>clear_cache</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear the cache (call if you know equipment changed).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#command-class_method" title="command (class method)">.<strong>command</strong>(reserve: nil, attack_cost: 0, attack_name: nil, attack_rt: nil)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convenience method: returns just the command string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cost_for_reduction-class_method" title="cost_for_reduction (class method)">.<strong>cost_for_reduction</strong>(seconds)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate stamina cost for a specific reduction amount.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cost_per_second_reduction-class_method" title="cost_per_second_reduction (class method)">.<strong>cost_per_second_reduction</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate stamina cost per second of RT reduction Formula: (10 + primary_equipment_speed + (secondary_equipment_speed / 2)) * asp_multiplier.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#debug_calculation-class_method" title="debug_calculation (class method)">.<strong>debug_calculation</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Display detailed calculation breakdown for debugging Shows all intermediate values used in cost calculation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#default-class_method" title="default (class method)">.<strong>default</strong>(key)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a default value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#defaults-class_method" title="defaults (class method)">.<strong>defaults</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get current defaults.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#defaults=-class_method" title="defaults= (class method)">.<strong>defaults=</strong>(new_defaults)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set all defaults at once.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#defined_module%3F-class_method" title="defined_module? (class method)">.<strong>defined_module?</strong>(mod_name)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if a module is defined.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#detect_attack_type-class_method" title="detect_attack_type (class method)">.<strong>detect_attack_type</strong>(name)  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detect what type of attack this is.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_attack-class_method" title="execute_attack (class method)">.<strong>execute_attack</strong>(attack, target = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute the attack command using appropriate method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_qstrike-class_method" title="execute_qstrike (class method)">.<strong>execute_qstrike</strong>(reduction)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute the qstrike command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_max_seconds-class_method" title="find_max_seconds (class method)">.<strong>find_max_seconds</strong>(available_stamina, cost_per_second)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Find maximum seconds of reduction affordable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_weapon_stats-class_method" title="find_weapon_stats (class method)">.<strong>find_weapon_stats</strong>(hand)  &#x21d2; Hash<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Find weapon stats using multiple lookup strategies Tries: noun, then extracts weapon type from full name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hand_cache_key-class_method" title="hand_cache_key (class method)">.<strong>hand_cache_key</strong>(hand)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a cache key for a hand (handles empty hands).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_settings-class_method" title="load_settings (class method)">.<strong>load_settings</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load settings from DB_Store (per-character).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lookup_attack_cost-class_method" title="lookup_attack_cost (class method)">.<strong>lookup_attack_cost</strong>(name)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Look up stamina cost for a CMan or Weapon technique.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lookup_technique_cost-class_method" title="lookup_technique_cost (class method)">.<strong>lookup_technique_cost</strong>(name, type)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generic technique cost lookup.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#normalize_attack_name-class_method" title="normalize_attack_name (class method)">.<strong>normalize_attack_name</strong>(attack)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Normalize attack name for lookup.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#primary_equipment_speed-class_method" title="primary_equipment_speed (class method)">.<strong>primary_equipment_speed</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get primary hand equipment speed For ranged: LEFT hand is primary For melee: RIGHT hand is primary.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ranged_weapon%3F-class_method" title="ranged_weapon? (class method)">.<strong>ranged_weapon?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determine if using ranged weapon (bow/crossbow in LEFT hand).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reduction_for_target_rt-class_method" title="reduction_for_target_rt (class method)">.<strong>reduction_for_target_rt</strong>(target_rt)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate reduction needed to achieve target absolute RT.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_defaults-class_method" title="reset_defaults (class method)">.<strong>reset_defaults</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reset defaults to factory values.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_settings_cache-class_method" title="reset_settings_cache (class method)">.<strong>reset_settings_cache</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reset settings loaded flag (for testing).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolve_reduction-class_method" title="resolve_reduction (class method)">.<strong>resolve_reduction</strong>(reduction, reserve, attack_cost)  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Resolve reduction value to actual seconds Handles :max, negative (reduce by N), and positive (target RT).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_settings-class_method" title="save_settings (class method)">.<strong>save_settings</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Save settings to DB_Store (per-character).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#secondary_equipment_speed-class_method" title="secondary_equipment_speed (class method)">.<strong>secondary_equipment_speed</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get secondary hand equipment speed For ranged: RIGHT hand is secondary For melee: LEFT hand is secondary Only weapons count - shields and non-weapons = 0.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_default-class_method" title="set_default (class method)">.<strong>set_default</strong>(key, value)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set a single default value (persists to DB_Store for per-character storage).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#striking_asp_active%3F-class_method" title="striking_asp_active? (class method)">.<strong>striking_asp_active?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if Striking Asp stance is active.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#striking_asp_multiplier-class_method" title="striking_asp_multiplier (class method)">.<strong>striking_asp_multiplier</strong>  &#x21d2; Float </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the cost multiplier based on Striking Asp status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#striking_asp_rank-class_method" title="striking_asp_rank (class method)">.<strong>striking_asp_rank</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get Striking Asp rank (1, 2, or 3).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use-class_method" title="use (class method)">.<strong>use</strong>(reduction:, attack:, target: nil, reserve: nil, adaptive: nil)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute QSTRIKE with an attack command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_cache%3F-class_method" title="valid_cache? (class method)">.<strong>valid_cache?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if cached value is still valid (hands haven’t changed).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#weapon_speed_for-class_method" title="weapon_speed_for (class method)">.<strong>weapon_speed_for</strong>(hand)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get weapon stats and equipment speed for a hand.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="affordable?-class_method">
  
    .<strong>affordable?</strong>(reserve: nil, attack_cost: 0, attack_name: nil, attack_rt: nil)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if any QSTRIKE reduction is affordable</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reserve</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Minimum stamina to keep (uses default if nil)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_cost</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Stamina cost of attack</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Name of attack to look up cost</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_rt</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The attack’s actual roundtime (caps max useful reduction)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if at least 1 second of reduction is affordable</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 230</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_affordable?'>affordable?</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>attack_name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>attack_rt:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_calculate'>calculate</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='comma'>,</span> <span class='label'>attack_name:</span> <span class='id identifier rubyid_attack_name'>attack_name</span><span class='comma'>,</span> <span class='label'>attack_rt:</span> <span class='id identifier rubyid_attack_rt'>attack_rt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:seconds</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="base_rt-class_method">
  
    .<strong>base_rt</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get base RT for current weapon setup Uses the primary weapon’s base RT</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Base roundtime in seconds</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 340</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_rt'>base_rt</span>
  <span class='id identifier rubyid_hand'>hand</span> <span class='op'>=</span> <span class='id identifier rubyid_ranged_weapon?'>ranged_weapon?</span> <span class='op'>?</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_left_hand'>left_hand</span> <span class='op'>:</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_right_hand'>right_hand</span>
  <span class='id identifier rubyid_weapon_speed_for'>weapon_speed_for</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:base_rt</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_attack_command-class_method">
  
    .<strong>build_attack_command</strong>(attack, target = nil)  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Build attack command string</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attack</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Attack command</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Target</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Full command string</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


801
802
803
804
805
806
807</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 801</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_build_attack_command'>build_attack_command</span><span class='lparen'>(</span><span class='id identifier rubyid_attack'>attack</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attack'>attack</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_target'>target</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_attack'>attack</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cache_cost-class_method">
  
    .<strong>cache_cost</strong>(cost)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Store cost in cache with current hand state</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cost</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The calculated cost to cache</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


609
610
611
612
613
614
615</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 609</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cache_cost'>cache_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_cost'>cost</span><span class='rparen'>)</span>
  <span class='ivar'>@cached_cost</span> <span class='op'>=</span> <span class='id identifier rubyid_cost'>cost</span>
  <span class='ivar'>@cached_right_hand</span> <span class='op'>=</span> <span class='id identifier rubyid_hand_cache_key'>hand_cache_key</span><span class='lparen'>(</span><span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_right_hand'>right_hand</span><span class='rparen'>)</span>
  <span class='ivar'>@cached_left_hand</span> <span class='op'>=</span> <span class='id identifier rubyid_hand_cache_key'>hand_cache_key</span><span class='lparen'>(</span><span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_left_hand'>left_hand</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span>
  <span class='comment'># Ignore caching errors
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate-class_method">
  
    .<strong>calculate</strong>(reserve: nil, attack_cost: 0, attack_name: nil, attack_rt: nil)  &#x21d2; <tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate optimal QSTRIKE reduction that won’t cause negative stamina</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reserve</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Minimum stamina to keep after QSTRIKE + attack (uses default if nil)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_cost</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Stamina cost of attack being performed (default: 0)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Name of CMan/Weapon technique to look up cost (optional)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_rt</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The attack’s actual roundtime (caps max useful reduction)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Result hash with :seconds, :stamina_cost, :qstrike_cmd, etc.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 150</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calculate'>calculate</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>attack_name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>attack_rt:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_reserve'>reserve</span> <span class='op'>||=</span> <span class='id identifier rubyid_default'>default</span><span class='lparen'>(</span><span class='symbol'>:reserve</span><span class='rparen'>)</span>
  <span class='comment'># Look up attack cost if name provided
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_attack_name'>attack_name</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
    <span class='id identifier rubyid_attack_cost'>attack_cost</span> <span class='op'>=</span> <span class='id identifier rubyid_lookup_attack_cost'>lookup_attack_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_attack_name'>attack_name</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_current_stamina'>current_stamina</span> <span class='op'>=</span> <span class='const'>Char</span><span class='period'>.</span><span class='id identifier rubyid_stamina'>stamina</span>
  <span class='id identifier rubyid_available'>available</span> <span class='op'>=</span> <span class='id identifier rubyid_current_stamina'>current_stamina</span> <span class='op'>-</span> <span class='id identifier rubyid_reserve'>reserve</span> <span class='op'>-</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_available'>available</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span>
      <span class='label'>seconds:</span> <span class='int'>0</span><span class='comma'>,</span>
      <span class='label'>stamina_cost:</span> <span class='int'>0</span><span class='comma'>,</span>
      <span class='label'>qstrike_cmd:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>reason:</span> <span class='symbol'>:insufficient_stamina</span><span class='comma'>,</span>
      <span class='label'>current_stamina:</span> <span class='id identifier rubyid_current_stamina'>current_stamina</span><span class='comma'>,</span>
      <span class='label'>available_stamina:</span> <span class='id identifier rubyid_available'>available</span><span class='comma'>,</span>
      <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='comma'>,</span>
      <span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cost_per_second'>cost_per_second</span> <span class='op'>=</span> <span class='id identifier rubyid_cost_per_second_reduction'>cost_per_second_reduction</span>
  <span class='id identifier rubyid_max_seconds'>max_seconds</span> <span class='op'>=</span> <span class='id identifier rubyid_find_max_seconds'>find_max_seconds</span><span class='lparen'>(</span><span class='id identifier rubyid_available'>available</span><span class='comma'>,</span> <span class='id identifier rubyid_cost_per_second'>cost_per_second</span><span class='rparen'>)</span>

  <span class='comment'># Cap reduction based on attack&#39;s RT (can&#39;t reduce below 1 second)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_attack_rt'>attack_rt</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_attack_rt'>attack_rt</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_max_useful'>max_useful</span> <span class='op'>=</span> <span class='id identifier rubyid_attack_rt'>attack_rt</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='id identifier rubyid_max_seconds'>max_seconds</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_max_seconds'>max_seconds</span><span class='comma'>,</span> <span class='id identifier rubyid_max_useful'>max_useful</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_max_seconds'>max_seconds</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span>
    <span class='id identifier rubyid_total_cost'>total_cost</span> <span class='op'>=</span> <span class='id identifier rubyid_cost_per_second'>cost_per_second</span> <span class='op'>*</span> <span class='id identifier rubyid_max_seconds'>max_seconds</span>
    <span class='lbrace'>{</span>
      <span class='label'>seconds:</span> <span class='id identifier rubyid_max_seconds'>max_seconds</span><span class='comma'>,</span>
      <span class='label'>stamina_cost:</span> <span class='id identifier rubyid_total_cost'>total_cost</span><span class='comma'>,</span>
      <span class='label'>qstrike_cmd:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qstrike -</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_seconds'>max_seconds</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>current_stamina:</span> <span class='id identifier rubyid_current_stamina'>current_stamina</span><span class='comma'>,</span>
      <span class='label'>available_stamina:</span> <span class='id identifier rubyid_available'>available</span><span class='comma'>,</span>
      <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='comma'>,</span>
      <span class='label'>attack_rt:</span> <span class='id identifier rubyid_attack_rt'>attack_rt</span><span class='comma'>,</span>
      <span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span>
      <span class='label'>cost_per_second:</span> <span class='id identifier rubyid_cost_per_second'>cost_per_second</span><span class='comma'>,</span>
      <span class='label'>striking_asp_active:</span> <span class='id identifier rubyid_striking_asp_active?'>striking_asp_active?</span>
    <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='lbrace'>{</span>
      <span class='label'>seconds:</span> <span class='int'>0</span><span class='comma'>,</span>
      <span class='label'>stamina_cost:</span> <span class='int'>0</span><span class='comma'>,</span>
      <span class='label'>qstrike_cmd:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>reason:</span> <span class='symbol'>:too_expensive</span><span class='comma'>,</span>
      <span class='label'>current_stamina:</span> <span class='id identifier rubyid_current_stamina'>current_stamina</span><span class='comma'>,</span>
      <span class='label'>available_stamina:</span> <span class='id identifier rubyid_available'>available</span><span class='comma'>,</span>
      <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='comma'>,</span>
      <span class='label'>attack_rt:</span> <span class='id identifier rubyid_attack_rt'>attack_rt</span><span class='comma'>,</span>
      <span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span>
      <span class='label'>cost_per_second:</span> <span class='id identifier rubyid_cost_per_second'>cost_per_second</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clear_cache-class_method">
  
    .<strong>clear_cache</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear the cache (call if you know equipment changed)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


618
619
620
621
622</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 618</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clear_cache'>clear_cache</span>
  <span class='ivar'>@cached_cost</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@cached_right_hand</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@cached_left_hand</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="command-class_method">
  
    .<strong>command</strong>(reserve: nil, attack_cost: 0, attack_name: nil, attack_rt: nil)  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Convenience method: returns just the command string</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reserve</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Minimum stamina to keep (uses default if nil)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_cost</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Stamina cost of attack</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Name of attack to look up cost</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_rt</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The attack’s actual roundtime (caps max useful reduction)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>“qstrike -N” or nil if can’t afford any reduction</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 219</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_command'>command</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>attack_name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>attack_rt:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_calculate'>calculate</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='comma'>,</span> <span class='label'>attack_name:</span> <span class='id identifier rubyid_attack_name'>attack_name</span><span class='comma'>,</span> <span class='label'>attack_rt:</span> <span class='id identifier rubyid_attack_rt'>attack_rt</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:qstrike_cmd</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cost_for_reduction-class_method">
  
    .<strong>cost_for_reduction</strong>(seconds)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate stamina cost for a specific reduction amount</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>seconds</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Seconds of RT reduction</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Stamina cost</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


330
331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 330</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cost_for_reduction'>cost_for_reduction</span><span class='lparen'>(</span><span class='id identifier rubyid_seconds'>seconds</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_seconds'>seconds</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_seconds'>seconds</span> <span class='op'>&lt;=</span> <span class='int'>0</span>

  <span class='id identifier rubyid_cost_per_second_reduction'>cost_per_second_reduction</span> <span class='op'>*</span> <span class='id identifier rubyid_seconds'>seconds</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cost_per_second_reduction-class_method">
  
    .<strong>cost_per_second_reduction</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate stamina cost per second of RT reduction Formula: (10 + primary_equipment_speed + (secondary_equipment_speed / 2)) * asp_multiplier</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Cost per second (with Striking Asp discount if active)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 459</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cost_per_second_reduction'>cost_per_second_reduction</span>
  <span class='comment'># Check memoization cache
</span>  <span class='kw'>return</span> <span class='ivar'>@cached_cost</span> <span class='kw'>if</span> <span class='id identifier rubyid_valid_cache?'>valid_cache?</span>

  <span class='id identifier rubyid_primary'>primary</span> <span class='op'>=</span> <span class='id identifier rubyid_primary_equipment_speed'>primary_equipment_speed</span>
  <span class='id identifier rubyid_secondary'>secondary</span> <span class='op'>=</span> <span class='id identifier rubyid_secondary_equipment_speed'>secondary_equipment_speed</span>

  <span class='comment'># Base formula: 10 + primary + (secondary / 2)
</span>  <span class='id identifier rubyid_base_cost'>base_cost</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#BASE_COST-constant" title="Lich::Gemstone::QStrike::BASE_COST (constant)">BASE_COST</a></span></span> <span class='op'>+</span> <span class='id identifier rubyid_primary'>primary</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_secondary'>secondary</span> <span class='op'>/</span> <span class='int'>2</span><span class='rparen'>)</span>

  <span class='comment'># Apply Striking Asp discount if active
</span>  <span class='id identifier rubyid_final_cost'>final_cost</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_base_cost'>base_cost</span> <span class='op'>*</span> <span class='id identifier rubyid_striking_asp_multiplier'>striking_asp_multiplier</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='comment'># Cache the result
</span>  <span class='id identifier rubyid_cache_cost'>cache_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_final_cost'>final_cost</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_final_cost'>final_cost</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="debug_calculation-class_method">
  
    .<strong>debug_calculation</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Display detailed calculation breakdown for debugging Shows all intermediate values used in cost calculation</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 482</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_calculation'>debug_calculation</span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=== QStrike Debug Calculation ===</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Right hand
</span>  <span class='id identifier rubyid_right'>right</span> <span class='op'>=</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_right_hand'>right_hand</span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Right hand: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_right'>right</span><span class='op'>&amp;.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Empty</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> (noun: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_right'>right</span><span class='op'>&amp;.</span><span class='id identifier rubyid_noun'>noun</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nil</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>, id: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_right'>right</span><span class='op'>&amp;.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nil</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_right'>right</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_right'>right</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Empty</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='id identifier rubyid_find_weapon_stats'>find_weapon_stats</span><span class='lparen'>(</span><span class='id identifier rubyid_right'>right</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  Weapon found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:base_name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> (category: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  base_rt: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:base_rt</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_multiplier'>multiplier</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#SPEED_MULTIPLIERS-constant" title="Lich::Gemstone::QStrike::SPEED_MULTIPLIERS (constant)">SPEED_MULTIPLIERS</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="#DEFAULT_MULTIPLIER-constant" title="Lich::Gemstone::QStrike::DEFAULT_MULTIPLIER (constant)">DEFAULT_MULTIPLIER</a></span></span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  multiplier: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_multiplier'>multiplier</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_equip_speed'>equip_speed</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:base_rt</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>*</span> <span class='id identifier rubyid_multiplier'>multiplier</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  equipment_speed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_equip_speed'>equip_speed</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  WARNING: No weapon stats found!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Left hand
</span>  <span class='id identifier rubyid_left'>left</span> <span class='op'>=</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_left_hand'>left_hand</span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Left hand: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_left'>left</span><span class='op'>&amp;.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Empty</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> (noun: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_left'>left</span><span class='op'>&amp;.</span><span class='id identifier rubyid_noun'>noun</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nil</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>, id: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_left'>left</span><span class='op'>&amp;.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nil</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_left'>left</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_left'>left</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Empty</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='id identifier rubyid_find_weapon_stats'>find_weapon_stats</span><span class='lparen'>(</span><span class='id identifier rubyid_left'>left</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  Weapon found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:base_name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> (category: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  base_rt: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:base_rt</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_multiplier'>multiplier</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#SPEED_MULTIPLIERS-constant" title="Lich::Gemstone::QStrike::SPEED_MULTIPLIERS (constant)">SPEED_MULTIPLIERS</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="#DEFAULT_MULTIPLIER-constant" title="Lich::Gemstone::QStrike::DEFAULT_MULTIPLIER (constant)">DEFAULT_MULTIPLIER</a></span></span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  multiplier: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_multiplier'>multiplier</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_equip_speed'>equip_speed</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:base_rt</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>*</span> <span class='id identifier rubyid_multiplier'>multiplier</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  equipment_speed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_equip_speed'>equip_speed</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  WARNING: No weapon stats found!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Primary/Secondary determination
</span>  <span class='id identifier rubyid_is_ranged'>is_ranged</span> <span class='op'>=</span> <span class='id identifier rubyid_ranged_weapon?'>ranged_weapon?</span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ranged mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_is_ranged'>is_ranged</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Primary hand: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_is_ranged'>is_ranged</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LEFT</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RIGHT</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Secondary hand: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_is_ranged'>is_ranged</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RIGHT</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LEFT</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Calculated values
</span>  <span class='id identifier rubyid_primary'>primary</span> <span class='op'>=</span> <span class='id identifier rubyid_primary_equipment_speed'>primary_equipment_speed</span>
  <span class='id identifier rubyid_secondary'>secondary</span> <span class='op'>=</span> <span class='id identifier rubyid_secondary_equipment_speed'>secondary_equipment_speed</span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Primary equipment_speed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_primary'>primary</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Secondary equipment_speed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_secondary'>secondary</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Secondary / 2 (integer division): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_secondary'>secondary</span> <span class='op'>/</span> <span class='int'>2</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Formula
</span>  <span class='id identifier rubyid_base_cost'>base_cost</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#BASE_COST-constant" title="Lich::Gemstone::QStrike::BASE_COST (constant)">BASE_COST</a></span></span> <span class='op'>+</span> <span class='id identifier rubyid_primary'>primary</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_secondary'>secondary</span> <span class='op'>/</span> <span class='int'>2</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Formula: BASE_COST(</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#BASE_COST-constant" title="Lich::Gemstone::QStrike::BASE_COST (constant)">BASE_COST</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>) + primary(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_primary'>primary</span><span class='embexpr_end'>}</span><span class='tstring_content'>) + secondary/2(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_secondary'>secondary</span> <span class='op'>/</span> <span class='int'>2</span><span class='embexpr_end'>}</span><span class='tstring_content'>) = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_cost'>base_cost</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Striking Asp
</span>  <span class='id identifier rubyid_asp_mult'>asp_mult</span> <span class='op'>=</span> <span class='id identifier rubyid_striking_asp_multiplier'>striking_asp_multiplier</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_asp_mult'>asp_mult</span> <span class='op'>-</span> <span class='float'>1.0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&gt;</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>EPSILON</span>
    <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Striking Asp multiplier: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_asp_mult'>asp_mult</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_final_cost'>final_cost</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_base_cost'>base_cost</span> <span class='op'>*</span> <span class='id identifier rubyid_asp_mult'>asp_mult</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Final cost (with Asp): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_cost'>base_cost</span><span class='embexpr_end'>}</span><span class='tstring_content'> * </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_asp_mult'>asp_mult</span><span class='embexpr_end'>}</span><span class='tstring_content'> = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_final_cost'>final_cost</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Striking Asp: not active</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Final cost per second: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_cost'>base_cost</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=== End Debug ===</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default-class_method">
  
    .<strong>default</strong>(key)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get a default value</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Setting name</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Current value</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 98</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_default'>default</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_load_settings'>load_settings</span>
  <span class='ivar'>@settings</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#DEFAULT_SETTINGS-constant" title="Lich::Gemstone::QStrike::DEFAULT_SETTINGS (constant)">DEFAULT_SETTINGS</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="defaults-class_method">
  
    .<strong>defaults</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get current defaults</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Current default settings</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 70</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_defaults'>defaults</span>
  <span class='id identifier rubyid_load_settings'>load_settings</span>
  <span class='lbrace'>{</span>
    <span class='label'>reserve:</span> <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:reserve</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>adaptive:</span> <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='symbol'>:adaptive</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="defaults=-class_method">
  
    .<strong>defaults=</strong>(new_defaults)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set all defaults at once</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>new_defaults</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>New default values</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 80</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_defaults='>defaults=</span><span class='lparen'>(</span><span class='id identifier rubyid_new_defaults'>new_defaults</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_load_settings'>load_settings</span>
  <span class='ivar'>@settings</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_new_defaults'>new_defaults</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_save_settings'>save_settings</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="defined_module?-class_method">
  
    .<strong>defined_module?</strong>(mod_name)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if a module is defined</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mod_name</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Module name</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


674
675
676
677
678</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 674</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_defined_module?'>defined_module?</span><span class='lparen'>(</span><span class='id identifier rubyid_mod_name'>mod_name</span><span class='rparen'>)</span>
  <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='id identifier rubyid_mod_name'>mod_name</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="detect_attack_type-class_method">
  
    .<strong>detect_attack_type</strong>(name)  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detect what type of attack this is</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Normalized attack name</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>:cman, :weapon, :shield, or :basic</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


780
781
782
783
784
785
786
787
788
789
790
791
792
793
794</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 780</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_detect_attack_type'>detect_attack_type</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="#TECHNIQUE_MODULES-constant" title="Lich::Gemstone::QStrike::TECHNIQUE_MODULES (constant)">TECHNIQUE_MODULES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mod_name'>mod_name</span><span class='comma'>,</span> <span class='id identifier rubyid_class_var'>class_var</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_defined_module?'>defined_module?</span><span class='lparen'>(</span><span class='id identifier rubyid_mod_name'>mod_name</span><span class='rparen'>)</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_mod'>mod</span> <span class='op'>=</span> <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='id identifier rubyid_mod_name'>mod_name</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_mod'>mod</span><span class='period'>.</span><span class='id identifier rubyid_class_variable_get'>class_variable_get</span><span class='lparen'>(</span><span class='id identifier rubyid_class_var'>class_var</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_type'>type</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:short_name</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='symbol'>:basic</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_attack-class_method">
  
    .<strong>execute_attack</strong>(attack, target = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute the attack command using appropriate method</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attack</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Attack name or command</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Target for the attack</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 744</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_execute_attack'>execute_attack</span><span class='lparen'>(</span><span class='id identifier rubyid_attack'>attack</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attack_str'>attack_str</span> <span class='op'>=</span> <span class='id identifier rubyid_attack'>attack</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_normalized'>normalized</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_attack_name'>normalize_attack_name</span><span class='lparen'>(</span><span class='id identifier rubyid_attack'>attack</span><span class='rparen'>)</span>

  <span class='comment'># Detect and execute based on attack type
</span>  <span class='id identifier rubyid_attack_type'>attack_type</span> <span class='op'>=</span> <span class='id identifier rubyid_detect_attack_type'>detect_attack_type</span><span class='lparen'>(</span><span class='id identifier rubyid_normalized'>normalized</span><span class='rparen'>)</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_attack_type'>attack_type</span>
  <span class='kw'>when</span> <span class='symbol'>:cman</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="CMan.html" title="Lich::Gemstone::CMan (module)">CMan</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="CMan.html" title="Lich::Gemstone::CMan (module)">CMan</a></span></span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:use</span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="CMan.html" title="Lich::Gemstone::CMan (module)">CMan</a></span></span><span class='period'>.</span><span class='id identifier rubyid_use'><span class='object_link'><a href="CMan.html#use-class_method" title="Lich::Gemstone::CMan.use (method)">use</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_normalized'>normalized</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fput'><span class='object_link'><a href="../../top-level-namespace.html#fput-instance_method" title="#fput (method)">fput</a></span></span> <span class='id identifier rubyid_build_attack_command'>build_attack_command</span><span class='lparen'>(</span><span class='id identifier rubyid_attack_str'>attack_str</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='symbol'>:weapon</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Weapon.html" title="Lich::Gemstone::Weapon (module)">Weapon</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="Weapon.html" title="Lich::Gemstone::Weapon (module)">Weapon</a></span></span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:use</span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="Weapon.html" title="Lich::Gemstone::Weapon (module)">Weapon</a></span></span><span class='period'>.</span><span class='id identifier rubyid_use'><span class='object_link'><a href="Weapon.html#use-class_method" title="Lich::Gemstone::Weapon.use (method)">use</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_normalized'>normalized</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fput'><span class='object_link'><a href="../../top-level-namespace.html#fput-instance_method" title="#fput (method)">fput</a></span></span> <span class='id identifier rubyid_build_attack_command'>build_attack_command</span><span class='lparen'>(</span><span class='id identifier rubyid_attack_str'>attack_str</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='symbol'>:shield</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Shield.html" title="Lich::Gemstone::Shield (module)">Shield</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="Shield.html" title="Lich::Gemstone::Shield (module)">Shield</a></span></span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:use</span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="Shield.html" title="Lich::Gemstone::Shield (module)">Shield</a></span></span><span class='period'>.</span><span class='id identifier rubyid_use'><span class='object_link'><a href="Shield.html#use-class_method" title="Lich::Gemstone::Shield.use (method)">use</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_normalized'>normalized</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fput'><span class='object_link'><a href="../../top-level-namespace.html#fput-instance_method" title="#fput (method)">fput</a></span></span> <span class='id identifier rubyid_build_attack_command'>build_attack_command</span><span class='lparen'>(</span><span class='id identifier rubyid_attack_str'>attack_str</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Basic command - just send it
</span>    <span class='id identifier rubyid_fput'><span class='object_link'><a href="../../top-level-namespace.html#fput-instance_method" title="#fput (method)">fput</a></span></span> <span class='id identifier rubyid_build_attack_command'>build_attack_command</span><span class='lparen'>(</span><span class='id identifier rubyid_attack_str'>attack_str</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_qstrike-class_method">
  
    .<strong>execute_qstrike</strong>(reduction)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute the qstrike command</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reduction</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Seconds of reduction</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


734
735
736
737
738</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 734</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_execute_qstrike'>execute_qstrike</span><span class='lparen'>(</span><span class='id identifier rubyid_reduction'>reduction</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_reduction'>reduction</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_reduction'>reduction</span> <span class='op'>&lt;=</span> <span class='int'>0</span>

  <span class='id identifier rubyid_fput'><span class='object_link'><a href="../../top-level-namespace.html#fput-instance_method" title="#fput (method)">fput</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qstrike -</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reduction'>reduction</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_max_seconds-class_method">
  
    .<strong>find_max_seconds</strong>(available_stamina, cost_per_second)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Find maximum seconds of reduction affordable</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>available_stamina</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Stamina available for QSTRIKE</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>cost_per_second</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Cost per second of reduction</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Max seconds (0 if can’t afford any)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


685
686
687
688
689
690
691
692
693</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 685</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_max_seconds'>find_max_seconds</span><span class='lparen'>(</span><span class='id identifier rubyid_available_stamina'>available_stamina</span><span class='comma'>,</span> <span class='id identifier rubyid_cost_per_second'>cost_per_second</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_cost_per_second'>cost_per_second</span> <span class='op'>&lt;=</span> <span class='int'>0</span>

  <span class='comment'># Simple division - how many full seconds can we afford?
</span>  <span class='id identifier rubyid_max'>max</span> <span class='op'>=</span> <span class='id identifier rubyid_available_stamina'>available_stamina</span> <span class='op'>/</span> <span class='id identifier rubyid_cost_per_second'>cost_per_second</span>

  <span class='comment'># Cap at reasonable maximum
</span>  <span class='lbracket'>[</span><span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#MAX_REDUCTION-constant" title="Lich::Gemstone::QStrike::MAX_REDUCTION (constant)">MAX_REDUCTION</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_weapon_stats-class_method">
  
    .<strong>find_weapon_stats</strong>(hand)  &#x21d2; <tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Find weapon stats using multiple lookup strategies Tries: noun, then extracts weapon type from full name</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>hand</span>
      
      
        <span class='type'>(<tt>GameObj</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hand to check</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>WeaponStats data or nil if not found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 363</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_weapon_stats'>find_weapon_stats</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># Strategy 1: Try the noun directly (works for &quot;dagger&quot;, &quot;broadsword&quot;, etc.)
</span>  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Armaments.html" title="Lich::Gemstone::Armaments (module)">Armaments</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Armaments/WeaponStats.html" title="Lich::Gemstone::Armaments::WeaponStats (module)">WeaponStats</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'><span class='object_link'><a href="Armaments/WeaponStats.html#find-class_method" title="Lich::Gemstone::Armaments::WeaponStats.find (method)">find</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_noun'>noun</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_stats'>stats</span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>

  <span class='comment'># Strategy 2: Try the full name (works for &quot;slim short sword&quot; -&gt; finds &quot;short sword&quot;)
</span>  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Armaments.html" title="Lich::Gemstone::Armaments (module)">Armaments</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Armaments/WeaponStats.html" title="Lich::Gemstone::Armaments::WeaponStats (module)">WeaponStats</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'><span class='object_link'><a href="Armaments/WeaponStats.html#find-class_method" title="Lich::Gemstone::Armaments::WeaponStats.find (method)">find</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_stats'>stats</span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>

  <span class='comment'># Strategy 3: Extract weapon type from name by removing common adjectives
</span>  <span class='comment'># e.g., &quot;slim short sword&quot; -&gt; try &quot;short sword&quot;
</span>  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
  <span class='id identifier rubyid_adjectives'>adjectives</span> <span class='op'>=</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>slim</span><span class='words_sep'> </span><span class='tstring_content'>gleaming</span><span class='words_sep'> </span><span class='tstring_content'>steel</span><span class='words_sep'> </span><span class='tstring_content'>iron</span><span class='words_sep'> </span><span class='tstring_content'>silver</span><span class='words_sep'> </span><span class='tstring_content'>gold</span><span class='words_sep'> </span><span class='tstring_content'>mithril</span><span class='words_sep'> </span><span class='tstring_content'>vultite</span><span class='words_sep'> </span><span class='tstring_content'>golvern</span><span class='words_sep'>
                  </span><span class='tstring_content'>ora</span><span class='words_sep'> </span><span class='tstring_content'>krodera</span><span class='words_sep'> </span><span class='tstring_content'>drakar</span><span class='words_sep'> </span><span class='tstring_content'>rhimar</span><span class='words_sep'> </span><span class='tstring_content'>gornar</span><span class='words_sep'> </span><span class='tstring_content'>zorchar</span><span class='words_sep'> </span><span class='tstring_content'>eonake</span><span class='words_sep'> </span><span class='tstring_content'>faenor</span><span class='words_sep'> </span><span class='tstring_content'>invar</span><span class='words_sep'>
                  </span><span class='tstring_content'>kelyn</span><span class='words_sep'> </span><span class='tstring_content'>laje</span><span class='words_sep'> </span><span class='tstring_content'>razern</span><span class='words_sep'> </span><span class='tstring_content'>rolaren</span><span class='words_sep'> </span><span class='tstring_content'>vaalorn</span><span class='words_sep'> </span><span class='tstring_content'>veil</span><span class='words_sep'> </span><span class='tstring_content'>imflass</span><span class='words_sep'> </span><span class='tstring_content'>alexandrite</span><span class='words_sep'>
                  </span><span class='tstring_content'>black</span><span class='words_sep'> </span><span class='tstring_content'>white</span><span class='words_sep'> </span><span class='tstring_content'>red</span><span class='words_sep'> </span><span class='tstring_content'>blue</span><span class='words_sep'> </span><span class='tstring_content'>green</span><span class='words_sep'> </span><span class='tstring_content'>small</span><span class='words_sep'> </span><span class='tstring_content'>large</span><span class='words_sep'> </span><span class='tstring_content'>heavy</span><span class='words_sep'> </span><span class='tstring_content'>light</span><span class='words_sep'> </span><span class='tstring_content'>ornate</span><span class='words_sep'>
                  </span><span class='tstring_content'>polished</span><span class='words_sep'> </span><span class='tstring_content'>rusted</span><span class='words_sep'> </span><span class='tstring_content'>ancient</span><span class='words_sep'> </span><span class='tstring_content'>old</span><span class='words_sep'> </span><span class='tstring_content'>new</span><span class='words_sep'> </span><span class='tstring_content'>fine</span><span class='tstring_end'>]</span></span>

  <span class='id identifier rubyid_words'>words</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
  <span class='comment'># Remove leading adjectives
</span>  <span class='kw'>while</span> <span class='id identifier rubyid_words'>words</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_adjectives'>adjectives</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_words'>words</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_words'>words</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
  <span class='kw'>end</span>

  <span class='comment'># Try progressively shorter suffixes: &quot;short sword&quot;, then &quot;sword&quot;
</span>  <span class='kw'>while</span> <span class='id identifier rubyid_words'>words</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_attempt'>attempt</span> <span class='op'>=</span> <span class='id identifier rubyid_words'>words</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Armaments.html" title="Lich::Gemstone::Armaments (module)">Armaments</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Armaments/WeaponStats.html" title="Lich::Gemstone::Armaments::WeaponStats (module)">WeaponStats</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'><span class='object_link'><a href="Armaments/WeaponStats.html#find-class_method" title="Lich::Gemstone::Armaments::WeaponStats.find (method)">find</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_attempt'>attempt</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_stats'>stats</span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>
    <span class='id identifier rubyid_words'>words</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hand_cache_key-class_method">
  
    .<strong>hand_cache_key</strong>(hand)  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get a cache key for a hand (handles empty hands)</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>hand</span>
      
      
        <span class='type'>(<tt>GameObj</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hand object</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Cache key representing this hand state</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


586
587
588
589
590
591
592</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 586</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_hand_cache_key'>hand_cache_key</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>empty</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>empty</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Empty</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>empty</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_noun'>noun</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_settings-class_method">
  
    .<strong>load_settings</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Load settings from DB_Store (per-character)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116
117
118
119
120
121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 111</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_load_settings'>load_settings</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@settings_loaded</span>

  <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/DB_Store.html" title="Lich::Common::DB_Store (module)">DB_Store</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>XMLData</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_stored'>stored</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/DB_Store.html" title="Lich::Common::DB_Store (module)">DB_Store</a></span></span><span class='period'>.</span><span class='id identifier rubyid_read'><span class='object_link'><a href="../Common/DB_Store.html#read-class_method" title="Lich::Common::DB_Store.read (method)">read</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>lich_qstrike</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@settings</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#DEFAULT_SETTINGS-constant" title="Lich::Gemstone::QStrike::DEFAULT_SETTINGS (constant)">DEFAULT_SETTINGS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_stored'>stored</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='ivar'>@settings_loaded</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='comment'># Fallback to in-memory defaults
</span>    <span class='ivar'>@settings</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="#DEFAULT_SETTINGS-constant" title="Lich::Gemstone::QStrike::DEFAULT_SETTINGS (constant)">DEFAULT_SETTINGS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="lookup_attack_cost-class_method">
  
    .<strong>lookup_attack_cost</strong>(name)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Look up stamina cost for a CMan or Weapon technique</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Attack name</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Stamina cost, or 0 if not found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 637</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lookup_attack_cost'>lookup_attack_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\s-]+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># Handle explicit type prefixes for disambiguation
</span>  <span class='const'><span class='object_link'><a href="#TECHNIQUE_MODULES-constant" title="Lich::Gemstone::QStrike::TECHNIQUE_MODULES (constant)">TECHNIQUE_MODULES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
    <span class='id identifier rubyid_prefix'>prefix</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_type'>type</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_lookup_technique_cost'>lookup_technique_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='id identifier rubyid_prefix'>prefix</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='id identifier rubyid_prefix'>prefix</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Try each module in order until we find a cost
</span>  <span class='const'><span class='object_link'><a href="#TECHNIQUE_MODULES-constant" title="Lich::Gemstone::QStrike::TECHNIQUE_MODULES (constant)">TECHNIQUE_MODULES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
    <span class='id identifier rubyid_cost'>cost</span> <span class='op'>=</span> <span class='id identifier rubyid_lookup_technique_cost'>lookup_technique_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_cost'>cost</span> <span class='kw'>if</span> <span class='id identifier rubyid_cost'>cost</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span>
  <span class='kw'>end</span>

  <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="lookup_technique_cost-class_method">
  
    .<strong>lookup_technique_cost</strong>(name, type)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generic technique cost lookup</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Normalized attack name</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>type</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Technique type (:cman, :weapon, :shield)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Stamina cost, or 0 if not found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


659
660
661
662
663
664
665
666
667
668
669</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 659</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lookup_technique_cost'>lookup_technique_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mod_name'>mod_name</span><span class='comma'>,</span> <span class='id identifier rubyid_class_var'>class_var</span><span class='comma'>,</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#TECHNIQUE_MODULES-constant" title="Lich::Gemstone::QStrike::TECHNIQUE_MODULES (constant)">TECHNIQUE_MODULES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_t'>t</span> <span class='op'>==</span> <span class='id identifier rubyid_type'>type</span> <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>unless</span> <span class='id identifier rubyid_mod_name'>mod_name</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_defined_module?'>defined_module?</span><span class='lparen'>(</span><span class='id identifier rubyid_mod_name'>mod_name</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_mod'>mod</span> <span class='op'>=</span> <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='id identifier rubyid_mod_name'>mod_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_mod'>mod</span><span class='period'>.</span><span class='id identifier rubyid_class_variable_get'>class_variable_get</span><span class='lparen'>(</span><span class='id identifier rubyid_class_var'>class_var</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_entry'>entry</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:short_name</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_entry'>entry</span><span class='op'>&amp;.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:cost</span><span class='comma'>,</span> <span class='symbol'>:stamina</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span>
  <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="normalize_attack_name-class_method">
  
    .<strong>normalize_attack_name</strong>(attack)  &#x21d2; <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Normalize attack name for lookup</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attack</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Attack name or command</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Normalized name</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


727
728
729</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 727</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_normalize_attack_name'>normalize_attack_name</span><span class='lparen'>(</span><span class='id identifier rubyid_attack'>attack</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attack'>attack</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\s-]+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[^a-z0-9_]</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="primary_equipment_speed-class_method">
  
    .<strong>primary_equipment_speed</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get primary hand equipment speed For ranged: LEFT hand is primary For melee: RIGHT hand is primary</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Equipment speed (base_rt * multiplier)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


439
440
441
442</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 439</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_primary_equipment_speed'>primary_equipment_speed</span>
  <span class='id identifier rubyid_hand'>hand</span> <span class='op'>=</span> <span class='id identifier rubyid_ranged_weapon?'>ranged_weapon?</span> <span class='op'>?</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_left_hand'>left_hand</span> <span class='op'>:</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_right_hand'>right_hand</span>
  <span class='id identifier rubyid_weapon_speed_for'>weapon_speed_for</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:equipment_speed</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ranged_weapon?-class_method">
  
    .<strong>ranged_weapon?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determine if using ranged weapon (bow/crossbow in LEFT hand)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if ranged weapon detected in left hand</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


402
403
404
405
406
407
408</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 402</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ranged_weapon?'>ranged_weapon?</span>
  <span class='id identifier rubyid_left'>left</span> <span class='op'>=</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_left_hand'>left_hand</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_left'>left</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_left'>left</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Empty</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='id identifier rubyid_find_weapon_stats'>find_weapon_stats</span><span class='lparen'>(</span><span class='id identifier rubyid_left'>left</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_stats'>stats</span><span class='op'>&amp;.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:category</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='symbol'>:ranged</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reduction_for_target_rt-class_method">
  
    .<strong>reduction_for_target_rt</strong>(target_rt)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate reduction needed to achieve target absolute RT</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>target_rt</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Desired final roundtime</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Seconds of reduction needed (0 if target &gt;= base)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


349
350
351
352
353
354</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 349</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reduction_for_target_rt'>reduction_for_target_rt</span><span class='lparen'>(</span><span class='id identifier rubyid_target_rt'>target_rt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_base'>current_base</span> <span class='op'>=</span> <span class='id identifier rubyid_base_rt'>base_rt</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_target_rt'>target_rt</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_current_base'>current_base</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_current_base'>current_base</span> <span class='op'>-</span> <span class='id identifier rubyid_target_rt'>target_rt</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#MAX_REDUCTION-constant" title="Lich::Gemstone::QStrike::MAX_REDUCTION (constant)">MAX_REDUCTION</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_defaults-class_method">
  
    .<strong>reset_defaults</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reset defaults to factory values</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 104</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reset_defaults'>reset_defaults</span>
  <span class='ivar'>@settings</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#DEFAULT_SETTINGS-constant" title="Lich::Gemstone::QStrike::DEFAULT_SETTINGS (constant)">DEFAULT_SETTINGS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_save_settings'>save_settings</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_settings_cache-class_method">
  
    .<strong>reset_settings_cache</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Reset settings loaded flag (for testing)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 136</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reset_settings_cache'>reset_settings_cache</span>
  <span class='ivar'>@settings_loaded</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@settings</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolve_reduction-class_method">
  
    .<strong>resolve_reduction</strong>(reduction, reserve, attack_cost)  &#x21d2; <tt>Integer</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Resolve reduction value to actual seconds Handles :max, negative (reduce by N), and positive (target RT)</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reduction</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Reduction specification</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>reserve</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Stamina reserve</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack_cost</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Attack stamina cost</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Actual seconds of reduction, or nil if invalid</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 704</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_resolve_reduction'>resolve_reduction</span><span class='lparen'>(</span><span class='id identifier rubyid_reduction'>reduction</span><span class='comma'>,</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_reduction'>reduction</span>
  <span class='kw'>when</span> <span class='symbol'>:max</span><span class='comma'>,</span> <span class='symbol'>:optimal</span>
    <span class='id identifier rubyid_calculate'>calculate</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:seconds</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='const'>Integer</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_reduction'>reduction</span><span class='period'>.</span><span class='id identifier rubyid_negative?'>negative?</span>
      <span class='comment'># Negative = reduce by that many seconds
</span>      <span class='id identifier rubyid_reduction'>reduction</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_reduction'>reduction</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span>
      <span class='comment'># Positive = target absolute RT
</span>      <span class='id identifier rubyid_reduction_for_target_rt'>reduction_for_target_rt</span><span class='lparen'>(</span><span class='id identifier rubyid_reduction'>reduction</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='int'>0</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save_settings-class_method">
  
    .<strong>save_settings</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Save settings to DB_Store (per-character)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 127</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save_settings'>save_settings</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/DB_Store.html" title="Lich::Common::DB_Store (module)">DB_Store</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>XMLData</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_game'>game</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'>XMLData</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Common/DB_Store.html" title="Lich::Common::DB_Store (module)">DB_Store</a></span></span><span class='period'>.</span><span class='id identifier rubyid_save'><span class='object_link'><a href="../Common/DB_Store.html#save-class_method" title="Lich::Common::DB_Store.save (method)">save</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>lich_qstrike</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='ivar'>@settings</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="secondary_equipment_speed-class_method">
  
    .<strong>secondary_equipment_speed</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get secondary hand equipment speed For ranged: RIGHT hand is secondary For melee: LEFT hand is secondary Only weapons count - shields and non-weapons = 0</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Equipment speed (base_rt * multiplier), or 0 if not a weapon</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


450
451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 450</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_secondary_equipment_speed'>secondary_equipment_speed</span>
  <span class='id identifier rubyid_hand'>hand</span> <span class='op'>=</span> <span class='id identifier rubyid_ranged_weapon?'>ranged_weapon?</span> <span class='op'>?</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_right_hand'>right_hand</span> <span class='op'>:</span> <span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_left_hand'>left_hand</span>
  <span class='id identifier rubyid_weapon_speed_for'>weapon_speed_for</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:equipment_speed</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_default-class_method">
  
    .<strong>set_default</strong>(key, value)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set a single default value (persists to DB_Store for per-character storage)</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Setting name (:reserve, :adaptive)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>New value</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 89</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_default'>set_default</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_load_settings'>load_settings</span>
  <span class='ivar'>@settings</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='id identifier rubyid_save_settings'>save_settings</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="striking_asp_active?-class_method">
  
    .<strong>striking_asp_active?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if Striking Asp stance is active</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


554
555
556
557
558
559
560</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 554</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_striking_asp_active?'>striking_asp_active?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Effects.html" title="Lich::Gemstone::Effects (module)">Effects</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Effects.html#Buffs-constant" title="Lich::Gemstone::Effects::Buffs (constant)">Buffs</a></span></span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="Effects.html" title="Lich::Gemstone::Effects (module)">Effects</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Effects.html#Buffs-constant" title="Lich::Gemstone::Effects::Buffs (constant)">Buffs</a></span></span><span class='period'>.</span><span class='id identifier rubyid_active?'>active?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Striking Asp</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="striking_asp_multiplier-class_method">
  
    .<strong>striking_asp_multiplier</strong>  &#x21d2; <tt>Float</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the cost multiplier based on Striking Asp status</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>1.0 if not active, or discounted multiplier if active</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


574
575
576
577
578
579</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 574</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_striking_asp_multiplier'>striking_asp_multiplier</span>
  <span class='kw'>return</span> <span class='float'>1.0</span> <span class='kw'>unless</span> <span class='id identifier rubyid_striking_asp_active?'>striking_asp_active?</span>

  <span class='id identifier rubyid_rank'>rank</span> <span class='op'>=</span> <span class='id identifier rubyid_striking_asp_rank'>striking_asp_rank</span>
  <span class='const'><span class='object_link'><a href="#STRIKING_ASP_MULTIPLIERS-constant" title="Lich::Gemstone::QStrike::STRIKING_ASP_MULTIPLIERS (constant)">STRIKING_ASP_MULTIPLIERS</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_rank'>rank</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='float'>1.0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="striking_asp_rank-class_method">
  
    .<strong>striking_asp_rank</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get Striking Asp rank (1, 2, or 3)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Rank, or 0 if not known</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


564
565
566
567
568
569
570</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 564</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_striking_asp_rank'>striking_asp_rank</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>unless</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="CMan.html" title="Lich::Gemstone::CMan (module)">CMan</a></span></span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="CMan.html" title="Lich::Gemstone::CMan (module)">CMan</a></span></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>striking_asp</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span>
  <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="use-class_method">
  
    .<strong>use</strong>(reduction:, attack:, target: nil, reserve: nil, adaptive: nil)  &#x21d2; <tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute QSTRIKE with an attack command</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Reduce RT by 3 seconds</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::QStrike (module)">QStrike</a></span></span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='label'>reduction:</span> <span class='op'>-</span><span class='int'>3</span><span class='comma'>,</span> <span class='label'>attack:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cripple</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>target:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>kobold</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Target absolute 2 second RT</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::QStrike (module)">QStrike</a></span></span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='label'>reduction:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>attack:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attack</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>target:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>troll</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Use maximum affordable reduction</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::QStrike (module)">QStrike</a></span></span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='label'>reduction:</span> <span class='symbol'>:max</span><span class='comma'>,</span> <span class='label'>attack:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mstrike</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reduction</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>RT reduction: negative = reduce by N seconds, positive = target absolute RT</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attack</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Attack to perform (e.g., “cripple”, “attack”, “mstrike”)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Target for the attack (optional)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>reserve</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Stamina to reserve (uses default if nil)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>adaptive</span>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If true, use max affordable when can’t afford requested (uses default if nil)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Result with :success, :reduction_used, :reason, etc.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 256</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='label'>reduction:</span><span class='comma'>,</span> <span class='label'>attack:</span><span class='comma'>,</span> <span class='label'>target:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>reserve:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>adaptive:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_reserve'>reserve</span> <span class='op'>||=</span> <span class='id identifier rubyid_default'>default</span><span class='lparen'>(</span><span class='symbol'>:reserve</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_adaptive'>adaptive</span> <span class='op'>=</span> <span class='id identifier rubyid_default'>default</span><span class='lparen'>(</span><span class='symbol'>:adaptive</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_adaptive'>adaptive</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_attack_name'>attack_name</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_attack_name'>normalize_attack_name</span><span class='lparen'>(</span><span class='id identifier rubyid_attack'>attack</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attack_cost'>attack_cost</span> <span class='op'>=</span> <span class='id identifier rubyid_lookup_attack_cost'>lookup_attack_cost</span><span class='lparen'>(</span><span class='id identifier rubyid_attack_name'>attack_name</span><span class='rparen'>)</span>

  <span class='comment'># Determine the actual reduction to attempt
</span>  <span class='id identifier rubyid_actual_reduction'>actual_reduction</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_reduction'>resolve_reduction</span><span class='lparen'>(</span><span class='id identifier rubyid_reduction'>reduction</span><span class='comma'>,</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_actual_reduction'>actual_reduction</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_actual_reduction'>actual_reduction</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
    <span class='id identifier rubyid_max_affordable'>max_affordable</span> <span class='op'>=</span> <span class='id identifier rubyid_calculate'>calculate</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:seconds</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[QStrike] Cannot afford any reduction. Stamina: </span><span class='embexpr_beg'>#{</span><span class='const'>Char</span><span class='period'>.</span><span class='id identifier rubyid_stamina'>stamina</span><span class='embexpr_end'>}</span><span class='tstring_content'>, Reserve: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reserve'>reserve</span><span class='embexpr_end'>}</span><span class='tstring_content'>, Attack cost: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='lbrace'>{</span>
      <span class='label'>success:</span> <span class='kw'>false</span><span class='comma'>,</span>
      <span class='label'>reason:</span> <span class='symbol'>:cannot_afford</span><span class='comma'>,</span>
      <span class='label'>requested_reduction:</span> <span class='id identifier rubyid_reduction'>reduction</span><span class='comma'>,</span>
      <span class='label'>max_affordable:</span> <span class='id identifier rubyid_max_affordable'>max_affordable</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='comment'># Check if we can afford the requested reduction
</span>  <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span> <span class='op'>=</span> <span class='id identifier rubyid_cost_for_reduction'>cost_for_reduction</span><span class='lparen'>(</span><span class='id identifier rubyid_actual_reduction'>actual_reduction</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_available'>available</span> <span class='op'>=</span> <span class='const'>Char</span><span class='period'>.</span><span class='id identifier rubyid_stamina'>stamina</span> <span class='op'>-</span> <span class='id identifier rubyid_reserve'>reserve</span> <span class='op'>-</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_available'>available</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_adaptive'>adaptive</span>
      <span class='comment'># Calculate what we can actually afford
</span>      <span class='id identifier rubyid_max_affordable'>max_affordable</span> <span class='op'>=</span> <span class='id identifier rubyid_calculate'>calculate</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:seconds</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_max_affordable'>max_affordable</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span>
        <span class='id identifier rubyid_actual_reduction'>actual_reduction</span> <span class='op'>=</span> <span class='id identifier rubyid_max_affordable'>max_affordable</span>
        <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span> <span class='op'>=</span> <span class='id identifier rubyid_cost_for_reduction'>cost_for_reduction</span><span class='lparen'>(</span><span class='id identifier rubyid_actual_reduction'>actual_reduction</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[QStrike] Insufficient stamina. Need: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span><span class='embexpr_end'>}</span><span class='tstring_content'>, Available: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_available'>available</span><span class='embexpr_end'>}</span><span class='tstring_content'> (after </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reserve'>reserve</span><span class='embexpr_end'>}</span><span class='tstring_content'> reserve + </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='embexpr_end'>}</span><span class='tstring_content'> attack)</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>return</span> <span class='lbrace'>{</span>
          <span class='label'>success:</span> <span class='kw'>false</span><span class='comma'>,</span>
          <span class='label'>reason:</span> <span class='symbol'>:insufficient_stamina</span><span class='comma'>,</span>
          <span class='label'>requested_reduction:</span> <span class='id identifier rubyid_reduction'>reduction</span><span class='comma'>,</span>
          <span class='label'>available_stamina:</span> <span class='id identifier rubyid_available'>available</span><span class='comma'>,</span>
          <span class='label'>qstrike_cost:</span> <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span>
        <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_max_affordable'>max_affordable</span> <span class='op'>=</span> <span class='id identifier rubyid_calculate'>calculate</span><span class='lparen'>(</span><span class='label'>reserve:</span> <span class='id identifier rubyid_reserve'>reserve</span><span class='comma'>,</span> <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:seconds</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_respond'><span class='object_link'><a href="../../top-level-namespace.html#respond-instance_method" title="#respond (method)">respond</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[QStrike] Insufficient stamina for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_actual_reduction'>actual_reduction</span><span class='embexpr_end'>}</span><span class='tstring_content'>s reduction. Need: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span><span class='embexpr_end'>}</span><span class='tstring_content'>, Available: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_available'>available</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Max affordable: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_affordable'>max_affordable</span><span class='embexpr_end'>}</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='lbrace'>{</span>
        <span class='label'>success:</span> <span class='kw'>false</span><span class='comma'>,</span>
        <span class='label'>reason:</span> <span class='symbol'>:insufficient_stamina</span><span class='comma'>,</span>
        <span class='label'>requested_reduction:</span> <span class='id identifier rubyid_reduction'>reduction</span><span class='comma'>,</span>
        <span class='label'>available_stamina:</span> <span class='id identifier rubyid_available'>available</span><span class='comma'>,</span>
        <span class='label'>qstrike_cost:</span> <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span><span class='comma'>,</span>
        <span class='label'>max_affordable:</span> <span class='id identifier rubyid_max_affordable'>max_affordable</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Execute the qstrike and attack
</span>  <span class='id identifier rubyid_execute_qstrike'>execute_qstrike</span><span class='lparen'>(</span><span class='id identifier rubyid_actual_reduction'>actual_reduction</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_execute_attack'>execute_attack</span><span class='lparen'>(</span><span class='id identifier rubyid_attack'>attack</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>

  <span class='lbrace'>{</span>
    <span class='label'>success:</span> <span class='kw'>true</span><span class='comma'>,</span>
    <span class='label'>reduction_used:</span> <span class='id identifier rubyid_actual_reduction'>actual_reduction</span><span class='comma'>,</span>
    <span class='label'>qstrike_cost:</span> <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span><span class='comma'>,</span>
    <span class='label'>attack_cost:</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='comma'>,</span>
    <span class='label'>total_cost:</span> <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span> <span class='op'>+</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span><span class='comma'>,</span>
    <span class='label'>stamina_after:</span> <span class='const'>Char</span><span class='period'>.</span><span class='id identifier rubyid_stamina'>stamina</span> <span class='op'>-</span> <span class='id identifier rubyid_qstrike_cost'>qstrike_cost</span> <span class='op'>-</span> <span class='id identifier rubyid_attack_cost'>attack_cost</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_cache?-class_method">
  
    .<strong>valid_cache?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if cached value is still valid (hands haven’t changed)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


596
597
598
599
600
601
602
603
604
605</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 596</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_cache?'>valid_cache?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='ivar'>@cached_cost</span>

  <span class='id identifier rubyid_current_right'>current_right</span> <span class='op'>=</span> <span class='id identifier rubyid_hand_cache_key'>hand_cache_key</span><span class='lparen'>(</span><span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_right_hand'>right_hand</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_left'>current_left</span> <span class='op'>=</span> <span class='id identifier rubyid_hand_cache_key'>hand_cache_key</span><span class='lparen'>(</span><span class='const'>GameObj</span><span class='period'>.</span><span class='id identifier rubyid_left_hand'>left_hand</span><span class='rparen'>)</span>

  <span class='ivar'>@cached_right_hand</span> <span class='op'>==</span> <span class='id identifier rubyid_current_right'>current_right</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@cached_left_hand</span> <span class='op'>==</span> <span class='id identifier rubyid_current_left'>current_left</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="weapon_speed_for-class_method">
  
    .<strong>weapon_speed_for</strong>(hand)  &#x21d2; <tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get weapon stats and equipment speed for a hand</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>hand</span>
      
      
        <span class='type'>(<tt>GameObj</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hand to check</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>{ base_rt: N, category: :sym, equipment_speed: N }</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/psms/qstrike.rb', line 414</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_weapon_speed_for'>weapon_speed_for</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_empty_result'>empty_result</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>base_rt:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>category:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>equipment_speed:</span> <span class='int'>0</span> <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_empty_result'>empty_result</span> <span class='kw'>if</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Empty</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='id identifier rubyid_find_weapon_stats'>find_weapon_stats</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_empty_result'>empty_result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_stats'>stats</span>

  <span class='id identifier rubyid_base_rt'>base_rt</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:base_rt</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_base_rt'>base_rt</span> <span class='op'>=</span> <span class='id identifier rubyid_base_rt'>base_rt</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='kw'>if</span> <span class='id identifier rubyid_base_rt'>base_rt</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base_rt'>base_rt</span> <span class='op'>=</span> <span class='id identifier rubyid_base_rt'>base_rt</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='id identifier rubyid_category'>category</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_multiplier'>multiplier</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#SPEED_MULTIPLIERS-constant" title="Lich::Gemstone::QStrike::SPEED_MULTIPLIERS (constant)">SPEED_MULTIPLIERS</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_category'>category</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="#DEFAULT_MULTIPLIER-constant" title="Lich::Gemstone::QStrike::DEFAULT_MULTIPLIER (constant)">DEFAULT_MULTIPLIER</a></span></span>

  <span class='comment'># Equipment Speed = Weapon Base RT * Speed Modifier
</span>  <span class='id identifier rubyid_equipment_speed'>equipment_speed</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_base_rt'>base_rt</span> <span class='op'>*</span> <span class='id identifier rubyid_multiplier'>multiplier</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='lbrace'>{</span> <span class='label'>base_rt:</span> <span class='id identifier rubyid_base_rt'>base_rt</span><span class='comma'>,</span> <span class='label'>category:</span> <span class='id identifier rubyid_category'>category</span><span class='comma'>,</span> <span class='label'>equipment_speed:</span> <span class='id identifier rubyid_equipment_speed'>equipment_speed</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 13 05:08:16 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.2.9).
</div>

    </div>
  <script type="text/javascript">
// Navigation helper for YARD docs
// Adds persistent navigation links, fixes sidebar navigation, and theme toggle

(function() {
  'use strict';

  // Calculate root path for assets
  function getRootPath() {
    var path = window.location.pathname;
    var rootPath = '';

    if (path.includes('/Lich/')) {
      var parts = path.split('/').filter(function(p) { return p; });
      var docsIndex = parts.indexOf('lich-5-docs');
      if (docsIndex >= 0) {
        var subParts = parts.slice(docsIndex + 1);
        rootPath = '../'.repeat(subParts.length - 1);
      }
    }

    if (!rootPath && !path.endsWith('/index.html') && !path.endsWith('/')) {
      var pathParts = path.split('/').filter(function(p) { return p && p !== 'index.html'; });
      var docsIdx = pathParts.indexOf('lich-5-docs');
      if (docsIdx >= 0) {
        rootPath = '../'.repeat(pathParts.length - docsIdx - 2);
      }
    }

    return rootPath;
  }

  // Inject theme CSS
  function injectThemeCSS() {
    if (document.getElementById('theme-css')) return;

    var rootPath = getRootPath();

    // Try multiple paths to find the CSS
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css',
      '/css/theme.css'
    ];

    var link = document.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    // Add error handler to try alternative paths
    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    document.head.appendChild(link);

    // Also inject critical inline styles as fallback
    injectInlineStyles();
  }

  // Inject critical inline styles for immediate dark mode
  function injectInlineStyles() {
    if (document.getElementById('theme-inline-css')) return;

    var style = document.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // File listing badges on index page
      '[data-theme="dark"] .alpha_listing a, [data-theme="dark"] .file_listing a, [data-theme="dark"] p.children a { background-color: #16213e !important; border-color: #333 !important; }',
      '[data-theme="dark"] .r1 a, [data-theme="dark"] .r2 a, [data-theme="dark"] .index_list a { background-color: #16213e !important; border-color: #333 !important; }',
      // Defined in box
      '[data-theme="dark"] .defined_in, [data-theme="dark"] .defines, [data-theme="dark"] dl.box, [data-theme="dark"] .box_info { background-color: #16213e !important; border-color: #333 !important; }',
      // Expand/collapse buttons
      '[data-theme="dark"] .summary_toggle, [data-theme="dark"] a.toggle, [data-theme="dark"] .expand, [data-theme="dark"] .collapse { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      // Method summary badges
      '[data-theme="dark"] .summary_signature a, [data-theme="dark"] ul.summary a, [data-theme="dark"] .summary a { background-color: #16213e !important; border-color: #333 !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] li, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Definition lists
      '[data-theme="dark"] dt, [data-theme="dark"] dd { background-color: transparent !important; }',
      // Catch-all for any remaining white backgrounds
      '[data-theme="dark"] div, [data-theme="dark"] section, [data-theme="dark"] article, [data-theme="dark"] aside { background-color: inherit !important; }'
    ].join('\n');
    document.head.appendChild(style);
  }

  // Get saved theme or detect system preference
  function getPreferredTheme() {
    var saved = localStorage.getItem('yard-theme');
    if (saved) return saved;

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  }

  // Apply theme to a document
  function applyThemeToDocument(doc, theme) {
    if (!doc || !doc.documentElement) return;
    doc.documentElement.setAttribute('data-theme', theme);

    // Also set on body for broader compatibility
    if (doc.body) {
      doc.body.setAttribute('data-theme', theme);
    }
  }

  // Inject inline styles into a document
  function injectInlineStylesToDocument(doc) {
    if (!doc || !doc.head) return;
    if (doc.getElementById('theme-inline-css')) return;

    var style = doc.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements - critical for frame backgrounds
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      '[data-theme="dark"] li { background-color: transparent !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // File listing badges on index page
      '[data-theme="dark"] .alpha_listing a, [data-theme="dark"] .file_listing a, [data-theme="dark"] p.children a { background-color: #16213e !important; border-color: #333 !important; }',
      '[data-theme="dark"] .r1 a, [data-theme="dark"] .r2 a, [data-theme="dark"] .index_list a { background-color: #16213e !important; border-color: #333 !important; }',
      // Defined in box
      '[data-theme="dark"] .defined_in, [data-theme="dark"] .defines, [data-theme="dark"] dl.box, [data-theme="dark"] .box_info { background-color: #16213e !important; border-color: #333 !important; }',
      // Expand/collapse buttons
      '[data-theme="dark"] .summary_toggle, [data-theme="dark"] a.toggle, [data-theme="dark"] .expand, [data-theme="dark"] .collapse { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      // Method summary badges
      '[data-theme="dark"] .summary_signature a, [data-theme="dark"] ul.summary a, [data-theme="dark"] .summary a { background-color: #16213e !important; border-color: #333 !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td, [data-theme="dark"] table tr { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      '[data-theme="dark"] table tr:nth-child(even), [data-theme="dark"] table tr:nth-child(even) td { background-color: #16213e !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Definition lists
      '[data-theme="dark"] dt, [data-theme="dark"] dd { background-color: transparent !important; }',
      // Content area
      '[data-theme="dark"] #content { background-color: #1a1a2e !important; }',
      '[data-theme="dark"] pre, [data-theme="dark"] code { background-color: #0d1117 !important; color: #c9d1d9 !important; }',
      // Catch-all
      '[data-theme="dark"] div, [data-theme="dark"] section { background-color: inherit !important; }'
    ].join('\n');
    doc.head.appendChild(style);
  }

  // Inject theme CSS into a document
  function injectThemeCSSIntoDocument(doc, rootPath) {
    if (!doc || !doc.head) return;

    // Always inject inline styles first as fallback
    injectInlineStylesToDocument(doc);

    if (doc.getElementById('theme-css')) return;

    // Try multiple paths
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css'
    ];

    var link = doc.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    doc.head.appendChild(link);
  }

  // Apply theme to all frames
  function applyThemeToAllFrames(theme) {
    var rootPath = getRootPath();

    // Apply to main document
    applyThemeToDocument(document, theme);
    injectThemeCSSIntoDocument(document, rootPath);

    // Apply to all frames and iframes
    try {
      var frames = document.querySelectorAll('frame, iframe');
      frames.forEach(function(frame) {
        try {
          var frameDoc = frame.contentDocument || frame.contentWindow.document;
          if (frameDoc) {
            applyThemeToDocument(frameDoc, theme);
            // Calculate root path relative to frame
            var frameRootPath = rootPath || '';
            injectThemeCSSIntoDocument(frameDoc, frameRootPath);
          }
        } catch (e) {
          // Cross-origin frame, skip
        }
      });

      // Also check parent frames (if we're in a frame)
      if (window.parent && window.parent !== window) {
        try {
          applyThemeToDocument(window.parent.document, theme);
          injectThemeCSSIntoDocument(window.parent.document, rootPath);
        } catch (e) {
          // Cross-origin, skip
        }
      }

      // Check top-level window
      if (window.top && window.top !== window) {
        try {
          applyThemeToDocument(window.top.document, theme);
          injectThemeCSSIntoDocument(window.top.document, rootPath);

          // Apply to all frames from top
          var topFrames = window.top.document.querySelectorAll('frame, iframe');
          topFrames.forEach(function(frame) {
            try {
              var frameDoc = frame.contentDocument || frame.contentWindow.document;
              if (frameDoc) {
                applyThemeToDocument(frameDoc, theme);
                injectThemeCSSIntoDocument(frameDoc, '');
              }
            } catch (e) {}
          });
        } catch (e) {
          // Cross-origin, skip
        }
      }
    } catch (e) {
      // Frames not accessible
    }
  }

  // Apply theme
  function applyTheme(theme) {
    localStorage.setItem('yard-theme', theme);

    // Apply to all documents
    applyThemeToAllFrames(theme);

    var btn = document.getElementById('theme-toggle');
    if (btn) {
      btn.textContent = theme === 'dark' ? '☀️ Light' : '🌙 Dark';
      btn.title = 'Switch to ' + (theme === 'dark' ? 'light' : 'dark') + ' mode';
    }
  }

  // Toggle theme
  function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme') || 'light';
    var newTheme = current === 'dark' ? 'light' : 'dark';
    applyTheme(newTheme);
  }

  // Check if we're in a sidebar/list frame (should not add nav)
  function isListFrame() {
    var path = window.location.pathname.toLowerCase();
    // Skip list frames
    if (path.includes('class_list') ||
        path.includes('file_list') ||
        path.includes('method_list') ||
        path.includes('_list.html') ||
        path.includes('frames.html')) {
      return true;
    }
    // Skip if this is a frame with full_list (sidebar)
    if (document.getElementById('full_list') && !document.getElementById('content')) {
      return true;
    }
    // Skip if we're clearly in a sub-frame
    if (window.frameElement) {
      return true;
    }
    return false;
  }

  function addNavLinks() {
    // Don't add nav to list/sidebar frames
    if (isListFrame()) return;

    var content = document.getElementById('content');
    if (!content) return;

    if (document.getElementById('quick-nav')) return;

    var rootPath = getRootPath();

    var nav = document.createElement('div');
    nav.id = 'quick-nav';
    nav.style.cssText = 'padding: 8px 15px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ddd; font-size: 14px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;';

    var links = document.createElement('div');
    links.innerHTML = '<a href="' + rootPath + 'index.html" style="margin-right: 15px; text-decoration: none;">Home</a> | ' +
                      '<a href="' + rootPath + '_index.html" style="margin-left: 15px; margin-right: 15px; text-decoration: none;">All Classes</a> | ' +
                      '<a href="' + rootPath + 'file.psm-reference.html" style="margin-left: 15px; text-decoration: none;">PSM Guide</a>';

    var themeBtn = document.createElement('button');
    themeBtn.id = 'theme-toggle';
    themeBtn.type = 'button';
    themeBtn.onclick = toggleTheme;

    nav.appendChild(links);
    nav.appendChild(themeBtn);

    content.insertBefore(nav, content.firstChild);

    var currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    themeBtn.textContent = currentTheme === 'dark' ? '☀️ Light' : '🌙 Dark';
    themeBtn.title = 'Switch to ' + (currentTheme === 'dark' ? 'light' : 'dark') + ' mode';
  }

  // Fix sidebar links - only run in actual sidebar/list frames
  function fixAllSidebarLinks() {
    // Only fix links if we're in a list frame
    if (!isListFrame()) return;

    // Get all possible sidebar/menu containers
    var selectors = [
      '#full_list',
      '#menu',
      '.menu',
      '#full_list_content',
      '.class_list',
      '.objects',
      '.sidebar',
      '#list',
      '.y_list'
    ];

    selectors.forEach(function(selector) {
      var containers = document.querySelectorAll(selector);
      containers.forEach(function(container) {
        // Add click handler to container that forces navigation
        if (!container.dataset.navFixed) {
          container.dataset.navFixed = 'true';

          container.addEventListener('click', function(e) {
            // Find the clicked link
            var target = e.target;
            while (target && target !== container) {
              if (target.tagName === 'A') {
                var href = target.getAttribute('href');
                if (href && href !== '#' && !href.startsWith('javascript:')) {
                  e.preventDefault();
                  e.stopPropagation();
                  e.stopImmediatePropagation();

                  // Navigate the parent/top frame, not this frame
                  if (window.parent && window.parent !== window) {
                    window.parent.location.href = target.href;
                  } else if (window.top && window.top !== window) {
                    window.top.location.href = target.href;
                  } else {
                    window.location.href = target.href;
                  }
                  return false;
                }
              }
              target = target.parentNode;
            }
          }, true); // Capture phase
        }

        // Also fix individual links
        var links = container.querySelectorAll('a');
        links.forEach(function(link) {
          if (!link.dataset.navFixed) {
            link.dataset.navFixed = 'true';
            var href = link.getAttribute('href');
            if (href && href !== '#' && !href.startsWith('javascript:')) {
              // Store the original href
              var fullHref = link.href;

              // Override onclick - navigate parent frame
              link.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (window.parent && window.parent !== window) {
                  window.parent.location.href = fullHref;
                } else if (window.top && window.top !== window) {
                  window.top.location.href = fullHref;
                } else {
                  window.location.href = fullHref;
                }
                return false;
              };
            }
          }
        });
      });
    });
  }

  // Watch for dynamically loaded content - only in list frames
  function observeForNewLinks() {
    // Only observe in list frames
    if (!isListFrame()) return;

    var observer = new MutationObserver(function(mutations) {
      var hasNewNodes = mutations.some(function(m) {
        return m.addedNodes.length > 0;
      });
      if (hasNewNodes) {
        // Delay slightly to let YARD's JS run first
        setTimeout(fixAllSidebarLinks, 10);
      }
    });

    if (document.body) {
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
  }

  // Initialize
  function init() {
    injectThemeCSS();
    applyTheme(getPreferredTheme());
    addNavLinks();
    fixAllSidebarLinks();
    observeForNewLinks();
  }

  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // Run periodically to catch all dynamic content and frames
  var intervals = [50, 100, 250, 500, 1000, 2000, 3000];
  intervals.forEach(function(ms) {
    setTimeout(function() {
      fixAllSidebarLinks();
      // Reapply theme to catch any newly loaded frames
      var theme = localStorage.getItem('yard-theme') || getPreferredTheme();
      applyThemeToAllFrames(theme);
    }, ms);
  });

  // Also run on any click anywhere (last resort) - only in list frames
  document.addEventListener('click', function(e) {
    // Only handle in list frames
    if (!isListFrame()) return;

    if (e.target.tagName === 'A') {
      var href = e.target.getAttribute('href');
      if (href && href !== '#' && !href.startsWith('javascript:')) {
        // Check if it's a sidebar link
        var inSidebar = e.target.closest('#full_list, #menu, .menu, .sidebar');
        if (inSidebar) {
          e.preventDefault();
          e.stopPropagation();
          // Navigate parent frame
          if (window.parent && window.parent !== window) {
            window.parent.location.href = e.target.href;
          } else {
            window.location.href = e.target.href;
          }
        }
      }
    }
  }, true);

  // Listen for system theme changes
  if (window.matchMedia) {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('yard-theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  }
})();

</script>
</body>
</html>