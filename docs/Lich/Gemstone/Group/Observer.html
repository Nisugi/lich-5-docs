<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Lich::Gemstone::Group::Observer
  
    &mdash; Lich 5 Documentation
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::Gemstone::Group::Observer";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (O)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Gemstone.html" title="Lich::Gemstone (module)">Gemstone</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span>
     &raquo; 
    <span class="title">Observer</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Lich::Gemstone::Group::Observer
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>documented/gemstone/group.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Observes game output and automatically updates Group state. Watches for group-related messages and updates membership, leadership, and status.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span>
    
  
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#consume-class_method" title="consume (class method)">.<strong>consume</strong>(line, match_data)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Processes a line of group-related game output and updates Group state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exist-class_method" title="exist (class method)">.<strong>exist</strong>(xml)  &#x21d2; Array&lt;GameObj&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extracts GameObj instances from XML character links in game output.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wants%3F-class_method" title="wants? (class method)">.<strong>wants?</strong>(line)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if a line of game output contains group-related information.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="consume-class_method">
  
    .<strong>consume</strong>(line, match_data)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Processes a line of group-related game output and updates Group state. Handles all types of group changes: joins, leaves, leadership changes, etc.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>line</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>line of game output</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>match_data</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../MatchData.html" title="MatchData (class)">MatchData</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>regex match data from the line</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/group.rb', line 450</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_consume'>consume</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_match_data'>match_data</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#GIVEN_LEADERSHIP-constant" title="Lich::Gemstone::Group::Observer::Term::GIVEN_LEADERSHIP (constant)">GIVEN_LEADERSHIP</a></span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='symbol'>:self</span>
  <span class='kw'>end</span>

  <span class='comment'>## Group indicator changed!
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#GROUP_EMPTIED-constant" title="Lich::Gemstone::Group::Observer::Term::GROUP_EMPTIED (constant)">GROUP_EMPTIED</a></span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='symbol'>:self</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid__members'><span class='object_link'><a href="../Group.html#_members-class_method" title="Lich::Gemstone::Group._members (method)">_members</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_people'>people</span> <span class='op'>=</span> <span class='id identifier rubyid_exist'>exist</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are leading</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='symbol'>:self</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are grouped with</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_line'>line</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#NO_GROUP-constant" title="Lich::Gemstone::Group::Observer::Term::NO_GROUP (constant)">NO_GROUP</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#DISBAND-constant" title="Lich::Gemstone::Group::Observer::Term::DISBAND (constant)">DISBAND</a></span></span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='symbol'>:self</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid__members'><span class='object_link'><a href="../Group.html#_members-class_method" title="Lich::Gemstone::Group._members (method)">_members</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#STATUS-constant" title="Lich::Gemstone::Group::Observer::Term::STATUS (constant)">STATUS</a></span></span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_status'><span class='object_link'><a href="../Group.html#status-class_method" title="Lich::Gemstone::Group.status (method)">status</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_match_data'>match_data</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_checked'>checked</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#GAVE_LEADER_AWAY-constant" title="Lich::Gemstone::Group::Observer::Term::GAVE_LEADER_AWAY (constant)">GAVE_LEADER_AWAY</a></span></span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#ADDED_TO_NEW_GROUP-constant" title="Lich::Gemstone::Group::Observer::Term::ADDED_TO_NEW_GROUP (constant)">ADDED_TO_NEW_GROUP</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#JOINED_NEW_GROUP-constant" title="Lich::Gemstone::Group::Observer::Term::JOINED_NEW_GROUP (constant)">JOINED_NEW_GROUP</a></span></span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_checked'>checked</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#SWAP_LEADER-constant" title="Lich::Gemstone::Group::Observer::Term::SWAP_LEADER (constant)">SWAP_LEADER</a></span></span>
    <span class='lparen'>(</span><span class='id identifier rubyid_old_leader'>old_leader</span><span class='comma'>,</span> <span class='id identifier rubyid_new_leader'>new_leader</span><span class='rparen'>)</span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_people'>people</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'><span class='object_link'><a href="../Group.html#include%3F-class_method" title="Lich::Gemstone::Group.include? (method)">include?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_old_leader'>old_leader</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'><span class='object_link'><a href="../Group.html#include%3F-class_method" title="Lich::Gemstone::Group.include? (method)">include?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_new_leader'>new_leader</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_new_leader'>new_leader</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#LEADER_ADDED_MEMBER-constant" title="Lich::Gemstone::Group::Observer::Term::LEADER_ADDED_MEMBER (constant)">LEADER_ADDED_MEMBER</a></span></span>
    <span class='lparen'>(</span><span class='id identifier rubyid_leader'>leader</span><span class='comma'>,</span> <span class='id identifier rubyid_added'>added</span><span class='rparen'>)</span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_added'>added</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'><span class='object_link'><a href="../Group.html#include%3F-class_method" title="Lich::Gemstone::Group.include? (method)">include?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_leader'>leader</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#LEADER_REMOVED_MEMBER-constant" title="Lich::Gemstone::Group::Observer::Term::LEADER_REMOVED_MEMBER (constant)">LEADER_REMOVED_MEMBER</a></span></span>
    <span class='lparen'>(</span><span class='id identifier rubyid_leader'>leader</span><span class='comma'>,</span> <span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_delete'><span class='object_link'><a href="../Group.html#delete-class_method" title="Lich::Gemstone::Group.delete (method)">delete</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_removed'>removed</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'><span class='object_link'><a href="../Group.html#include%3F-class_method" title="Lich::Gemstone::Group.include? (method)">include?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_leader'>leader</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#JOIN-constant" title="Lich::Gemstone::Group::Observer::Term::JOIN (constant)">JOIN</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#ADD-constant" title="Lich::Gemstone::Group::Observer::Term::ADD (constant)">ADD</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#NOOP-constant" title="Lich::Gemstone::Group::Observer::Term::NOOP (constant)">NOOP</a></span></span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_people'>people</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#MEMBER-constant" title="Lich::Gemstone::Group::Observer::Term::MEMBER (constant)">MEMBER</a></span></span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_refresh'><span class='object_link'><a href="../Group.html#refresh-class_method" title="Lich::Gemstone::Group.refresh (method)">refresh</a></span></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_people'>people</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_FRIENDLY_FIRST-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_FRIENDLY_FIRST (constant)">HOLD_FRIENDLY_FIRST</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_NEUTRAL_FIRST-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_NEUTRAL_FIRST (constant)">HOLD_NEUTRAL_FIRST</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_RESERVED_FIRST-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_RESERVED_FIRST (constant)">HOLD_RESERVED_FIRST</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_WARM_FIRST-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_WARM_FIRST (constant)">HOLD_WARM_FIRST</a></span></span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_FRIENDLY_SECOND-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_FRIENDLY_SECOND (constant)">HOLD_FRIENDLY_SECOND</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_NEUTRAL_SECOND-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_NEUTRAL_SECOND (constant)">HOLD_NEUTRAL_SECOND</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_RESERVED_SECOND-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_RESERVED_SECOND (constant)">HOLD_RESERVED_SECOND</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_WARM_SECOND-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_WARM_SECOND (constant)">HOLD_WARM_SECOND</a></span></span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_checked'>checked</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_leader'><span class='object_link'><a href="../Group.html#leader-class_method" title="Lich::Gemstone::Group.leader (method)">leader</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_FRIENDLY_THIRD-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_FRIENDLY_THIRD (constant)">HOLD_FRIENDLY_THIRD</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_NEUTRAL_THIRD-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_NEUTRAL_THIRD (constant)">HOLD_NEUTRAL_THIRD</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_RESERVED_THIRD-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_RESERVED_THIRD (constant)">HOLD_RESERVED_THIRD</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#HOLD_WARM_THIRD-constant" title="Lich::Gemstone::Group::Observer::Term::HOLD_WARM_THIRD (constant)">HOLD_WARM_THIRD</a></span></span>
    <span class='lparen'>(</span><span class='id identifier rubyid_leader'>leader</span><span class='comma'>,</span> <span class='id identifier rubyid_added'>added</span><span class='rparen'>)</span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_added'>added</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'><span class='object_link'><a href="../Group.html#include%3F-class_method" title="Lich::Gemstone::Group.include? (method)">include?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_leader'>leader</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#OTHER_JOINED_GROUP-constant" title="Lich::Gemstone::Group::Observer::Term::OTHER_JOINED_GROUP (constant)">OTHER_JOINED_GROUP</a></span></span>
    <span class='lparen'>(</span><span class='id identifier rubyid_added'>added</span><span class='comma'>,</span> <span class='id identifier rubyid_leader'>leader</span><span class='rparen'>)</span> <span class='op'>=</span> <span class='id identifier rubyid_people'>people</span>
    <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_push'><span class='object_link'><a href="../Group.html#push-class_method" title="Lich::Gemstone::Group.push (method)">push</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_added'>added</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'><span class='object_link'><a href="../Group.html#include%3F-class_method" title="Lich::Gemstone::Group.include? (method)">include?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_leader'>leader</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#LEAVE-constant" title="Lich::Gemstone::Group::Observer::Term::LEAVE (constant)">LEAVE</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#REMOVE-constant" title="Lich::Gemstone::Group::Observer::Term::REMOVE (constant)">REMOVE</a></span></span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='period'>.</span><span class='id identifier rubyid_delete'><span class='object_link'><a href="../Group.html#delete-class_method" title="Lich::Gemstone::Group.delete (method)">delete</a></span></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_people'>people</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="exist-class_method">
  
    .<strong>exist</strong>(xml)  &#x21d2; <tt>Array&lt;GameObj&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extracts GameObj instances from XML character links in game output.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>xml</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>game output containing character XML tags</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;GameObj&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>array of GameObj instances found in the XML</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


433
434
435</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/group.rb', line 433</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_exist'>exist</span><span class='lparen'>(</span><span class='id identifier rubyid_xml'>xml</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Group.html" title="Lich::Gemstone::Group (class)">Group</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Gemstone::Group::Observer (module)">Observer</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#EXIST-constant" title="Lich::Gemstone::Group::Observer::Term::EXIST (constant)">EXIST</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid__noun'>_noun</span><span class='comma'>,</span> <span class='id identifier rubyid__name'>_name</span><span class='op'>|</span> <span class='const'>GameObj</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wants?-class_method">
  
    .<strong>wants?</strong>(line)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if a line of game output contains group-related information.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>line</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>line of game output</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if line contains group information</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


440
441
442
443</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/gemstone/group.rb', line 440</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_wants?'>wants?</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#ANY-constant" title="Lich::Gemstone::Group::Observer::Term::ANY (constant)">ANY</a></span></span><span class='rparen'>)</span> <span class='kw'>or</span>
    <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Observer/Term.html" title="Lich::Gemstone::Group::Observer::Term (module)">Term</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Observer/Term.html#GROUP_EMPTIED-constant" title="Lich::Gemstone::Group::Observer::Term::GROUP_EMPTIED (constant)">GROUP_EMPTIED</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 13 04:57:14 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.2.9).
</div>

    </div>
  <script type="text/javascript">
// Navigation helper for YARD docs
// Adds persistent navigation links, fixes sidebar navigation, and theme toggle

(function() {
  'use strict';

  // Calculate root path for assets
  function getRootPath() {
    var path = window.location.pathname;
    var rootPath = '';

    if (path.includes('/Lich/')) {
      var parts = path.split('/').filter(function(p) { return p; });
      var docsIndex = parts.indexOf('lich-5-docs');
      if (docsIndex >= 0) {
        var subParts = parts.slice(docsIndex + 1);
        rootPath = '../'.repeat(subParts.length - 1);
      }
    }

    if (!rootPath && !path.endsWith('/index.html') && !path.endsWith('/')) {
      var pathParts = path.split('/').filter(function(p) { return p && p !== 'index.html'; });
      var docsIdx = pathParts.indexOf('lich-5-docs');
      if (docsIdx >= 0) {
        rootPath = '../'.repeat(pathParts.length - docsIdx - 2);
      }
    }

    return rootPath;
  }

  // Inject theme CSS
  function injectThemeCSS() {
    if (document.getElementById('theme-css')) return;

    var rootPath = getRootPath();

    // Try multiple paths to find the CSS
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css',
      '/css/theme.css'
    ];

    var link = document.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    // Add error handler to try alternative paths
    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    document.head.appendChild(link);

    // Also inject critical inline styles as fallback
    injectInlineStyles();
  }

  // Inject critical inline styles for immediate dark mode
  function injectInlineStyles() {
    if (document.getElementById('theme-inline-css')) return;

    var style = document.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] li, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Catch-all for any remaining white backgrounds
      '[data-theme="dark"] div, [data-theme="dark"] section, [data-theme="dark"] article, [data-theme="dark"] aside { background-color: inherit !important; }'
    ].join('\n');
    document.head.appendChild(style);
  }

  // Get saved theme or detect system preference
  function getPreferredTheme() {
    var saved = localStorage.getItem('yard-theme');
    if (saved) return saved;

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  }

  // Apply theme to a document
  function applyThemeToDocument(doc, theme) {
    if (!doc || !doc.documentElement) return;
    doc.documentElement.setAttribute('data-theme', theme);

    // Also set on body for broader compatibility
    if (doc.body) {
      doc.body.setAttribute('data-theme', theme);
    }
  }

  // Inject inline styles into a document
  function injectInlineStylesToDocument(doc) {
    if (!doc || !doc.head) return;
    if (doc.getElementById('theme-inline-css')) return;

    var style = doc.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements - critical for frame backgrounds
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      '[data-theme="dark"] li { background-color: transparent !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td, [data-theme="dark"] table tr { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      '[data-theme="dark"] table tr:nth-child(even), [data-theme="dark"] table tr:nth-child(even) td { background-color: #16213e !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Content area
      '[data-theme="dark"] #content { background-color: #1a1a2e !important; }',
      '[data-theme="dark"] pre, [data-theme="dark"] code { background-color: #0d1117 !important; color: #c9d1d9 !important; }',
      // Catch-all
      '[data-theme="dark"] div, [data-theme="dark"] section { background-color: inherit !important; }'
    ].join('\n');
    doc.head.appendChild(style);
  }

  // Inject theme CSS into a document
  function injectThemeCSSIntoDocument(doc, rootPath) {
    if (!doc || !doc.head) return;

    // Always inject inline styles first as fallback
    injectInlineStylesToDocument(doc);

    if (doc.getElementById('theme-css')) return;

    // Try multiple paths
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css'
    ];

    var link = doc.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    doc.head.appendChild(link);
  }

  // Apply theme to all frames
  function applyThemeToAllFrames(theme) {
    var rootPath = getRootPath();

    // Apply to main document
    applyThemeToDocument(document, theme);
    injectThemeCSSIntoDocument(document, rootPath);

    // Apply to all frames and iframes
    try {
      var frames = document.querySelectorAll('frame, iframe');
      frames.forEach(function(frame) {
        try {
          var frameDoc = frame.contentDocument || frame.contentWindow.document;
          if (frameDoc) {
            applyThemeToDocument(frameDoc, theme);
            // Calculate root path relative to frame
            var frameRootPath = rootPath || '';
            injectThemeCSSIntoDocument(frameDoc, frameRootPath);
          }
        } catch (e) {
          // Cross-origin frame, skip
        }
      });

      // Also check parent frames (if we're in a frame)
      if (window.parent && window.parent !== window) {
        try {
          applyThemeToDocument(window.parent.document, theme);
          injectThemeCSSIntoDocument(window.parent.document, rootPath);
        } catch (e) {
          // Cross-origin, skip
        }
      }

      // Check top-level window
      if (window.top && window.top !== window) {
        try {
          applyThemeToDocument(window.top.document, theme);
          injectThemeCSSIntoDocument(window.top.document, rootPath);

          // Apply to all frames from top
          var topFrames = window.top.document.querySelectorAll('frame, iframe');
          topFrames.forEach(function(frame) {
            try {
              var frameDoc = frame.contentDocument || frame.contentWindow.document;
              if (frameDoc) {
                applyThemeToDocument(frameDoc, theme);
                injectThemeCSSIntoDocument(frameDoc, '');
              }
            } catch (e) {}
          });
        } catch (e) {
          // Cross-origin, skip
        }
      }
    } catch (e) {
      // Frames not accessible
    }
  }

  // Apply theme
  function applyTheme(theme) {
    localStorage.setItem('yard-theme', theme);

    // Apply to all documents
    applyThemeToAllFrames(theme);

    var btn = document.getElementById('theme-toggle');
    if (btn) {
      btn.textContent = theme === 'dark' ? ' Light' : ' Dark';
      btn.title = 'Switch to ' + (theme === 'dark' ? 'light' : 'dark') + ' mode';
    }
  }

  // Toggle theme
  function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme') || 'light';
    var newTheme = current === 'dark' ? 'light' : 'dark';
    applyTheme(newTheme);
  }

  // Check if we're in a sidebar/list frame (should not add nav)
  function isListFrame() {
    var path = window.location.pathname.toLowerCase();
    // Skip list frames
    if (path.includes('class_list') ||
        path.includes('file_list') ||
        path.includes('method_list') ||
        path.includes('_list.html') ||
        path.includes('frames.html')) {
      return true;
    }
    // Skip if this is a frame with full_list (sidebar)
    if (document.getElementById('full_list') && !document.getElementById('content')) {
      return true;
    }
    // Skip if we're clearly in a sub-frame
    if (window.frameElement) {
      return true;
    }
    return false;
  }

  function addNavLinks() {
    // Don't add nav to list/sidebar frames
    if (isListFrame()) return;

    var content = document.getElementById('content');
    if (!content) return;

    if (document.getElementById('quick-nav')) return;

    var rootPath = getRootPath();

    var nav = document.createElement('div');
    nav.id = 'quick-nav';
    nav.style.cssText = 'padding: 8px 15px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ddd; font-size: 14px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;';

    var links = document.createElement('div');
    links.innerHTML = '<a href="' + rootPath + 'index.html" style="margin-right: 15px; text-decoration: none;">Home</a> | ' +
                      '<a href="' + rootPath + '_index.html" style="margin-left: 15px; margin-right: 15px; text-decoration: none;">All Classes</a> | ' +
                      '<a href="' + rootPath + 'file.psm-reference.html" style="margin-left: 15px; text-decoration: none;">PSM Guide</a>';

    var themeBtn = document.createElement('button');
    themeBtn.id = 'theme-toggle';
    themeBtn.type = 'button';
    themeBtn.onclick = toggleTheme;

    nav.appendChild(links);
    nav.appendChild(themeBtn);

    content.insertBefore(nav, content.firstChild);

    var currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    themeBtn.textContent = currentTheme === 'dark' ? ' Light' : ' Dark';
    themeBtn.title = 'Switch to ' + (currentTheme === 'dark' ? 'light' : 'dark') + ' mode';
  }

  // Fix sidebar links - only run in actual sidebar/list frames
  function fixAllSidebarLinks() {
    // Only fix links if we're in a list frame
    if (!isListFrame()) return;

    // Get all possible sidebar/menu containers
    var selectors = [
      '#full_list',
      '#menu',
      '.menu',
      '#full_list_content',
      '.class_list',
      '.objects',
      '.sidebar',
      '#list',
      '.y_list'
    ];

    selectors.forEach(function(selector) {
      var containers = document.querySelectorAll(selector);
      containers.forEach(function(container) {
        // Add click handler to container that forces navigation
        if (!container.dataset.navFixed) {
          container.dataset.navFixed = 'true';

          container.addEventListener('click', function(e) {
            // Find the clicked link
            var target = e.target;
            while (target && target !== container) {
              if (target.tagName === 'A') {
                var href = target.getAttribute('href');
                if (href && href !== '#' && !href.startsWith('javascript:')) {
                  e.preventDefault();
                  e.stopPropagation();
                  e.stopImmediatePropagation();

                  // Navigate the parent/top frame, not this frame
                  if (window.parent && window.parent !== window) {
                    window.parent.location.href = target.href;
                  } else if (window.top && window.top !== window) {
                    window.top.location.href = target.href;
                  } else {
                    window.location.href = target.href;
                  }
                  return false;
                }
              }
              target = target.parentNode;
            }
          }, true); // Capture phase
        }

        // Also fix individual links
        var links = container.querySelectorAll('a');
        links.forEach(function(link) {
          if (!link.dataset.navFixed) {
            link.dataset.navFixed = 'true';
            var href = link.getAttribute('href');
            if (href && href !== '#' && !href.startsWith('javascript:')) {
              // Store the original href
              var fullHref = link.href;

              // Override onclick - navigate parent frame
              link.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (window.parent && window.parent !== window) {
                  window.parent.location.href = fullHref;
                } else if (window.top && window.top !== window) {
                  window.top.location.href = fullHref;
                } else {
                  window.location.href = fullHref;
                }
                return false;
              };
            }
          }
        });
      });
    });
  }

  // Watch for dynamically loaded content - only in list frames
  function observeForNewLinks() {
    // Only observe in list frames
    if (!isListFrame()) return;

    var observer = new MutationObserver(function(mutations) {
      var hasNewNodes = mutations.some(function(m) {
        return m.addedNodes.length > 0;
      });
      if (hasNewNodes) {
        // Delay slightly to let YARD's JS run first
        setTimeout(fixAllSidebarLinks, 10);
      }
    });

    if (document.body) {
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
  }

  // Initialize
  function init() {
    injectThemeCSS();
    applyTheme(getPreferredTheme());
    addNavLinks();
    fixAllSidebarLinks();
    observeForNewLinks();
  }

  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // Run periodically to catch all dynamic content and frames
  var intervals = [50, 100, 250, 500, 1000, 2000, 3000];
  intervals.forEach(function(ms) {
    setTimeout(function() {
      fixAllSidebarLinks();
      // Reapply theme to catch any newly loaded frames
      var theme = localStorage.getItem('yard-theme') || getPreferredTheme();
      applyThemeToAllFrames(theme);
    }, ms);
  });

  // Also run on any click anywhere (last resort) - only in list frames
  document.addEventListener('click', function(e) {
    // Only handle in list frames
    if (!isListFrame()) return;

    if (e.target.tagName === 'A') {
      var href = e.target.getAttribute('href');
      if (href && href !== '#' && !href.startsWith('javascript:')) {
        // Check if it's a sidebar link
        var inSidebar = e.target.closest('#full_list, #menu, .menu, .sidebar');
        if (inSidebar) {
          e.preventDefault();
          e.stopPropagation();
          // Navigate parent frame
          if (window.parent && window.parent !== window) {
            window.parent.location.href = e.target.href;
          } else {
            window.location.href = e.target.href;
          }
        }
      }
    }
  }, true);

  // Listen for system theme changes
  if (window.matchMedia) {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('yard-theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  }
})();

</script>
</body>
</html>