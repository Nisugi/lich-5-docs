<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Lich::Common::GUI::EncryptionModeChange
  
    &mdash; Lich 5 Documentation
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::Common::GUI::EncryptionModeChange";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (E)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span>
     &raquo; 
    <span class="title">EncryptionModeChange</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Lich::Common::GUI::EncryptionModeChange
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>documented/common/gui/encryption_mode_change.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show_change_mode_dialog-class_method" title="show_change_mode_dialog (class method)">.<strong>show_change_mode_dialog</strong>(parent, data_dir, on_completion = nil)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Displays a dialog for changing the encryption mode.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="show_change_mode_dialog-class_method">
  
    .<strong>show_change_mode_dialog</strong>(parent, data_dir, on_completion = nil)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Displays a dialog for changing the encryption mode.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::GUI::EncryptionModeChange (module)">EncryptionModeChange</a></span></span><span class='period'>.</span><span class='id identifier rubyid_show_change_mode_dialog'>show_change_mode_dialog</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_window'>parent_window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/path/to/data</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>parent</span>
      
      
        <span class='type'>(<tt>Gtk::Window</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The parent window for the dialog.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>data_dir</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The directory containing the YAML data.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>on_completion</span>
      
      
        <span class='type'>(<tt>Proc</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Optional callback to be called upon completion.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns true if the dialog was shown successfully.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Raises an error if the YAML file cannot be loaded.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/gui/encryption_mode_change.rb', line 20</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_show_change_mode_dialog'>show_change_mode_dialog</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_data_dir'>data_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_on_completion'>on_completion</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_yaml_file'>yaml_file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="YamlState.html" title="Lich::Common::GUI::YamlState (module)">YamlState</a></span></span><span class='period'>.</span><span class='id identifier rubyid_yaml_file_path'><span class='object_link'><a href="YamlState.html#yaml_file_path-class_method" title="Lich::Common::GUI::YamlState.yaml_file_path (method)">yaml_file_path</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data_dir'>data_dir</span><span class='rparen'>)</span>

  <span class='comment'># Load current mode
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_yaml_data'>yaml_data</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_current_mode'>current_mode</span> <span class='op'>=</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>encryption_mode</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>||</span> <span class='symbol'>:plaintext</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Failed to load YAML for mode change dialog: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_show_error_dialog'>show_error_dialog</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to load account data: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># Create dialog
</span>  <span class='id identifier rubyid_dialog'>dialog</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>Dialog</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Change Encryption Mode</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>parent:</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span>
    <span class='label'>flags:</span> <span class='symbol'>:modal</span><span class='comma'>,</span>
    <span class='label'>buttons:</span> <span class='lbracket'>[</span>
      <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Change Mode</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>ResponseType</span><span class='op'>::</span><span class='const'>APPLY</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cancel</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>ResponseType</span><span class='op'>::</span><span class='const'>CANCEL</span><span class='rbracket'>]</span>
    <span class='rbracket'>]</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_dialog'>dialog</span><span class='period'>.</span><span class='id identifier rubyid_set_default_size'>set_default_size</span><span class='lparen'>(</span><span class='int'>450</span><span class='comma'>,</span> <span class='int'>350</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dialog'>dialog</span><span class='period'>.</span><span class='id identifier rubyid_border_width'>border_width</span> <span class='op'>=</span> <span class='int'>10</span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_window_accessible'><span class='object_link'><a href="Accessibility.html#make_window_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_window_accessible (method)">make_window_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_dialog'>dialog</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Change Encryption Mode Dialog</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Dialog for changing the encryption mode</span><span class='tstring_end'>&quot;</span></span>
  <span class='rparen'>)</span>

  <span class='comment'># Create content area
</span>  <span class='id identifier rubyid_content_area'>content_area</span> <span class='op'>=</span> <span class='id identifier rubyid_dialog'>dialog</span><span class='period'>.</span><span class='id identifier rubyid_content_area'>content_area</span>
  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_spacing'>spacing</span> <span class='op'>=</span> <span class='int'>10</span>

  <span class='comment'># Add header
</span>  <span class='id identifier rubyid_header_label'>header_label</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>Label</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_header_label'>header_label</span><span class='period'>.</span><span class='id identifier rubyid_set_markup'>set_markup</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;span weight=&#39;bold&#39;&gt;Change Encryption Mode&lt;/span&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_header_label'>header_label</span><span class='period'>.</span><span class='id identifier rubyid_set_xalign'>set_xalign</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_accessible'><span class='object_link'><a href="Accessibility.html#make_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_accessible (method)">make_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_header_label'>header_label</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Change Encryption Mode Header</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Title for the encryption mode change dialog</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:label</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_header_label'>header_label</span><span class='rparen'>)</span>

  <span class='comment'># Add current mode display
</span>  <span class='id identifier rubyid_current_mode_label'>current_mode_label</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>Label</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_current_mode_text'>current_mode_text</span> <span class='op'>=</span> <span class='id identifier rubyid_mode_display_text'>mode_display_text</span><span class='lparen'>(</span><span class='id identifier rubyid_current_mode'>current_mode</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_mode_label'>current_mode_label</span><span class='period'>.</span><span class='id identifier rubyid_set_markup'>set_markup</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Current Mode: &lt;b&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_mode_text'>current_mode_text</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/b&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_mode_label'>current_mode_label</span><span class='period'>.</span><span class='id identifier rubyid_set_xalign'>set_xalign</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_accessible'><span class='object_link'><a href="Accessibility.html#make_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_accessible (method)">make_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_current_mode_label'>current_mode_label</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Current Mode Display</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Shows the current encryption mode</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:label</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_current_mode_label'>current_mode_label</span><span class='rparen'>)</span>

  <span class='comment'># Add separator
</span>  <span class='id identifier rubyid_separator'>separator</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>Separator</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:horizontal</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_separator'>separator</span><span class='rparen'>)</span>

  <span class='comment'># Add mode selection label
</span>  <span class='id identifier rubyid_selection_label'>selection_label</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>Label</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Select new encryption mode:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_selection_label'>selection_label</span><span class='period'>.</span><span class='id identifier rubyid_set_xalign'>set_xalign</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_accessible'><span class='object_link'><a href="Accessibility.html#make_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_accessible (method)">make_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_selection_label'>selection_label</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Mode Selection Instruction</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Instruction to select a new encryption mode</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:label</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_selection_label'>selection_label</span><span class='rparen'>)</span>

  <span class='comment'># Create radio button group for mode selection
</span>  <span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>RadioButton</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>label:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Plaintext (No Encryption)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span><span class='period'>.</span><span class='id identifier rubyid_tooltip_text'>tooltip_text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Passwords stored unencrypted (accessibility mode)</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_accessible'><span class='object_link'><a href="Accessibility.html#make_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_accessible (method)">make_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Plaintext Mode Option</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Select plaintext encryption mode</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:button</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_standard_radio'>standard_radio</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>RadioButton</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>member:</span> <span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span><span class='comma'>,</span>
                                        <span class='label'>label:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Standard Encryption (Account Name)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_standard_radio'>standard_radio</span><span class='period'>.</span><span class='id identifier rubyid_tooltip_text'>tooltip_text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Encrypt with account name</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_accessible'><span class='object_link'><a href="Accessibility.html#make_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_accessible (method)">make_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_standard_radio'>standard_radio</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Standard Mode Option</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Select standard encryption mode</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:button</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_enhanced_radio'>enhanced_radio</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>RadioButton</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>member:</span> <span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span><span class='comma'>,</span>
                                        <span class='label'>label:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enhanced Encryption (Master Password)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_enhanced_radio'>enhanced_radio</span><span class='period'>.</span><span class='id identifier rubyid_tooltip_text'>tooltip_text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Encrypt with master password (strongest security)</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_accessible'><span class='object_link'><a href="Accessibility.html#make_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_accessible (method)">make_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_enhanced_radio'>enhanced_radio</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enhanced Mode Option</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Select enhanced encryption mode</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:button</span>
  <span class='rparen'>)</span>

  <span class='comment'># Set currently selected mode
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_current_mode'>current_mode</span>
  <span class='kw'>when</span> <span class='symbol'>:plaintext</span>
    <span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span><span class='period'>.</span><span class='id identifier rubyid_active'>active</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='symbol'>:standard</span>
    <span class='id identifier rubyid_standard_radio'>standard_radio</span><span class='period'>.</span><span class='id identifier rubyid_active'>active</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='symbol'>:enhanced</span>
    <span class='id identifier rubyid_enhanced_radio'>enhanced_radio</span><span class='period'>.</span><span class='id identifier rubyid_active'>active</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_standard_radio'>standard_radio</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_enhanced_radio'>enhanced_radio</span><span class='rparen'>)</span>

  <span class='comment'># Add warning note
</span>  <span class='id identifier rubyid_warning_label'>warning_label</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>Label</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_warning_label'>warning_label</span><span class='period'>.</span><span class='id identifier rubyid_set_markup'>set_markup</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;i&gt;All passwords will be decrypted and re-encrypted\nwith the new method.&lt;/i&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_warning_label'>warning_label</span><span class='period'>.</span><span class='id identifier rubyid_set_xalign'>set_xalign</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_warning_label'>warning_label</span><span class='period'>.</span><span class='id identifier rubyid_set_line_wrap'>set_line_wrap</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_accessible'><span class='object_link'><a href="Accessibility.html#make_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_accessible (method)">make_accessible</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_warning_label'>warning_label</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Re-encryption Warning</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Warning that all passwords will be re-encrypted</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:label</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_content_area'>content_area</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_warning_label'>warning_label</span><span class='rparen'>)</span>

  <span class='comment'># Track mode change result
</span>  <span class='id identifier rubyid_mode_changed'>mode_changed</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># Set up response handler
</span>  <span class='id identifier rubyid_dialog'>dialog</span><span class='period'>.</span><span class='id identifier rubyid_signal_connect'>signal_connect</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>response</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dlg'>dlg</span><span class='comma'>,</span> <span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: change_encryption_mode response handler, response=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span> <span class='op'>==</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>ResponseType</span><span class='op'>::</span><span class='const'>APPLY</span>
      <span class='comment'># Determine selected mode
</span>      <span class='id identifier rubyid_selected_mode'>selected_mode</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_plaintext_radio'>plaintext_radio</span><span class='period'>.</span><span class='id identifier rubyid_active?'>active?</span>
                        <span class='symbol'>:plaintext</span>
                      <span class='kw'>elsif</span> <span class='id identifier rubyid_standard_radio'>standard_radio</span><span class='period'>.</span><span class='id identifier rubyid_active?'>active?</span>
                        <span class='symbol'>:standard</span>
                      <span class='kw'>elsif</span> <span class='id identifier rubyid_enhanced_radio'>enhanced_radio</span><span class='period'>.</span><span class='id identifier rubyid_active?'>active?</span>
                        <span class='symbol'>:enhanced</span>
                      <span class='kw'>end</span>

      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: selected_mode=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_selected_mode'>selected_mode</span><span class='embexpr_end'>}</span><span class='tstring_content'>, current_mode=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_mode'>current_mode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

      <span class='comment'># If mode didn&#39;t change, just close dialog
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_selected_mode'>selected_mode</span> <span class='op'>==</span> <span class='id identifier rubyid_current_mode'>current_mode</span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: mode unchanged, closing</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_dlg'>dlg</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_dlg'>dlg</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: spawning thread for dialogs and mode change</span><span class='tstring_end'>&quot;</span></span>

      <span class='comment'># Spawn thread to run dialogs and mode change
</span>      <span class='comment'># Dialogs use Gtk.queue internally, so they need a non-GTK thread
</span>      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: thread starting</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_new_master_password'>new_master_password</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_validation_passed'>validation_passed</span> <span class='op'>=</span> <span class='kw'>true</span>

        <span class='comment'># Validate leaving current mode
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_current_mode'>current_mode</span> <span class='op'>==</span> <span class='symbol'>:enhanced</span>
          <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: showing password confirmation dialog for leaving enhanced mode</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_validation_result'>validation_result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MasterPasswordPromptUI.html" title="Lich::Common::GUI::MasterPasswordPromptUI (class)">MasterPasswordPromptUI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_show_password_confirmation_for_mode_change'><span class='object_link'><a href="MasterPasswordPromptUI.html#show_password_confirmation_for_mode_change-class_method" title="Lich::Common::GUI::MasterPasswordPromptUI.show_password_confirmation_for_mode_change (method)">show_password_confirmation_for_mode_change</a></span></span><span class='lparen'>(</span>
            <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master_password_validation_test</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
            <span class='label'>leaving_enhanced:</span> <span class='kw'>true</span>
          <span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: validation_result=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_validation_result'>validation_result</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>unless</span> <span class='id identifier rubyid_validation_result'>validation_result</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_validation_result'>validation_result</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span>
            <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: password confirmation cancelled</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_validation_passed'>validation_passed</span> <span class='op'>=</span> <span class='kw'>false</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_validation_passed'>validation_passed</span>
          <span class='comment'># Validate entering new mode
</span>          <span class='kw'>if</span> <span class='id identifier rubyid_selected_mode'>selected_mode</span> <span class='op'>==</span> <span class='symbol'>:enhanced</span>
            <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: showing password dialog</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_new_master_password'>new_master_password</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="MasterPasswordPromptUI.html" title="Lich::Common::GUI::MasterPasswordPromptUI (class)">MasterPasswordPromptUI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_show_dialog'><span class='object_link'><a href="MasterPasswordPromptUI.html#show_dialog-class_method" title="Lich::Common::GUI::MasterPasswordPromptUI.show_dialog (method)">show_dialog</a></span></span>
            <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: password_nil?=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_master_password'>new_master_password</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>unless</span> <span class='id identifier rubyid_new_master_password'>new_master_password</span>
              <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: password entry cancelled</span><span class='tstring_end'>&quot;</span></span>
              <span class='id identifier rubyid_validation_passed'>validation_passed</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='kw'>end</span>
          <span class='kw'>elsif</span> <span class='id identifier rubyid_selected_mode'>selected_mode</span> <span class='op'>==</span> <span class='symbol'>:plaintext</span>
            <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: showing plaintext confirmation</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>unless</span> <span class='id identifier rubyid_confirm_plaintext_mode_dialog'>confirm_plaintext_mode_dialog</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='rparen'>)</span>
              <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: plaintext confirmation cancelled</span><span class='tstring_end'>&quot;</span></span>
              <span class='id identifier rubyid_validation_passed'>validation_passed</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
          <span class='comment'># selected_mode == :standard needs nothing special
</span>        <span class='kw'>end</span>

        <span class='comment'># All validations passed, queue the actual mode change
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_validation_passed'>validation_passed</span>
          <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: all validations passed, queuing mode change</span><span class='tstring_end'>&quot;</span></span>
          <span class='const'>Gtk</span><span class='period'>.</span><span class='id identifier rubyid_queue'>queue</span> <span class='kw'>do</span>
            <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: in Gtk.queue, calling YamlState.change_encryption_mode</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="YamlState.html" title="Lich::Common::GUI::YamlState (module)">YamlState</a></span></span><span class='period'>.</span><span class='id identifier rubyid_change_encryption_mode'><span class='object_link'><a href="YamlState.html#change_encryption_mode-class_method" title="Lich::Common::GUI::YamlState.change_encryption_mode (method)">change_encryption_mode</a></span></span><span class='lparen'>(</span>
              <span class='id identifier rubyid_data_dir'>data_dir</span><span class='comma'>,</span>
              <span class='id identifier rubyid_selected_mode'>selected_mode</span><span class='comma'>,</span>
              <span class='id identifier rubyid_new_master_password'>new_master_password</span>
            <span class='rparen'>)</span>
            <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: change_encryption_mode returned </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_success'>success</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

            <span class='kw'>if</span> <span class='id identifier rubyid_success'>success</span>
              <span class='id identifier rubyid_mode_changed'>mode_changed</span> <span class='op'>=</span> <span class='kw'>true</span>
              <span class='id identifier rubyid_success_dialog'>success_dialog</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>MessageDialog</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
                <span class='label'>parent:</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span>
                <span class='label'>flags:</span> <span class='symbol'>:modal</span><span class='comma'>,</span>
                <span class='label'>type:</span> <span class='symbol'>:info</span><span class='comma'>,</span>
                <span class='label'>buttons:</span> <span class='symbol'>:ok</span><span class='comma'>,</span>
                <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Encryption mode changed successfully.</span><span class='tstring_end'>&quot;</span></span>
              <span class='rparen'>)</span>

              <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_window_accessible'><span class='object_link'><a href="Accessibility.html#make_window_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_window_accessible (method)">make_window_accessible</a></span></span><span class='lparen'>(</span>
                <span class='id identifier rubyid_success_dialog'>success_dialog</span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Success Message</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Encryption mode change success notification</span><span class='tstring_end'>&quot;</span></span>
              <span class='rparen'>)</span>

              <span class='id identifier rubyid_success_dialog'>success_dialog</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>
              <span class='id identifier rubyid_success_dialog'>success_dialog</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
              <span class='comment'># Call completion callback after mode change succeeds
</span>              <span class='id identifier rubyid_on_completion'>on_completion</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span> <span class='kw'>if</span> <span class='id identifier rubyid_on_completion'>on_completion</span>
            <span class='kw'>else</span>
              <span class='id identifier rubyid_error_dialog'>error_dialog</span> <span class='op'>=</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>MessageDialog</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
                <span class='label'>parent:</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span>
                <span class='label'>flags:</span> <span class='symbol'>:modal</span><span class='comma'>,</span>
                <span class='label'>type:</span> <span class='symbol'>:error</span><span class='comma'>,</span>
                <span class='label'>buttons:</span> <span class='symbol'>:ok</span><span class='comma'>,</span>
                <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to change encryption mode. Please check the logs.</span><span class='tstring_end'>&quot;</span></span>
              <span class='rparen'>)</span>

              <span class='const'><span class='object_link'><a href="Accessibility.html" title="Lich::Common::GUI::Accessibility (module)">Accessibility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_make_window_accessible'><span class='object_link'><a href="Accessibility.html#make_window_accessible-class_method" title="Lich::Common::GUI::Accessibility.make_window_accessible (method)">make_window_accessible</a></span></span><span class='lparen'>(</span>
                <span class='id identifier rubyid_error_dialog'>error_dialog</span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error Message</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Encryption mode change failed notification</span><span class='tstring_end'>&quot;</span></span>
              <span class='rparen'>)</span>

              <span class='id identifier rubyid_error_dialog'>error_dialog</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>
              <span class='id identifier rubyid_error_dialog'>error_dialog</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: thread complete</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: thread spawned, signal handler returning</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_response'>response</span> <span class='op'>==</span> <span class='const'>Gtk</span><span class='op'>::</span><span class='const'>ResponseType</span><span class='op'>::</span><span class='const'>CANCEL</span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug: mode change cancelled</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_dlg'>dlg</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Show dialog
</span>  <span class='id identifier rubyid_dialog'>dialog</span><span class='period'>.</span><span class='id identifier rubyid_show_all'>show_all</span>

  <span class='comment'># Return true to indicate dialog was shown (actual result will be async)
</span>  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 13 05:18:54 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.2.9).
</div>

    </div>
  <script type="text/javascript">
// Navigation helper for YARD docs
// Adds persistent navigation links, fixes sidebar navigation, and theme toggle

(function() {
  'use strict';

  // Calculate root path for assets
  function getRootPath() {
    var path = window.location.pathname;
    var rootPath = '';

    if (path.includes('/Lich/')) {
      var parts = path.split('/').filter(function(p) { return p; });
      var docsIndex = parts.indexOf('lich-5-docs');
      if (docsIndex >= 0) {
        var subParts = parts.slice(docsIndex + 1);
        rootPath = '../'.repeat(subParts.length - 1);
      }
    }

    if (!rootPath && !path.endsWith('/index.html') && !path.endsWith('/')) {
      var pathParts = path.split('/').filter(function(p) { return p && p !== 'index.html'; });
      var docsIdx = pathParts.indexOf('lich-5-docs');
      if (docsIdx >= 0) {
        rootPath = '../'.repeat(pathParts.length - docsIdx - 2);
      }
    }

    return rootPath;
  }

  // Inject theme CSS
  function injectThemeCSS() {
    if (document.getElementById('theme-css')) return;

    var rootPath = getRootPath();

    // Try multiple paths to find the CSS
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css',
      '/css/theme.css'
    ];

    var link = document.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    // Add error handler to try alternative paths
    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    document.head.appendChild(link);

    // Also inject critical inline styles as fallback
    injectInlineStyles();
  }

  // Inject critical inline styles for immediate dark mode
  function injectInlineStyles() {
    if (document.getElementById('theme-inline-css')) return;

    var style = document.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // File listing badges on index page
      '[data-theme="dark"] .alpha_listing a, [data-theme="dark"] .file_listing a, [data-theme="dark"] p.children a { background-color: #16213e !important; border-color: #333 !important; }',
      '[data-theme="dark"] .r1 a, [data-theme="dark"] .r2 a, [data-theme="dark"] .index_list a { background-color: #16213e !important; border-color: #333 !important; }',
      // Defined in box
      '[data-theme="dark"] .defined_in, [data-theme="dark"] .defines, [data-theme="dark"] dl.box, [data-theme="dark"] .box_info { background-color: #16213e !important; border-color: #333 !important; }',
      // Expand/collapse buttons and show/hide links
      '[data-theme="dark"] .summary_toggle, [data-theme="dark"] a.toggle, [data-theme="dark"] .expand, [data-theme="dark"] .collapse { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] .show_all, [data-theme="dark"] .hide_all, [data-theme="dark"] a.show, [data-theme="dark"] a.hide { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] .more, [data-theme="dark"] a.more, [data-theme="dark"] .less, [data-theme="dark"] a.less { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] dl.box a, [data-theme="dark"] .box_info a, [data-theme="dark"] .showAll, [data-theme="dark"] .hideAll { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] h2 a, [data-theme="dark"] h3 a, [data-theme="dark"] a[href="#"] { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      // Method summary badges
      '[data-theme="dark"] .summary_signature a, [data-theme="dark"] ul.summary a, [data-theme="dark"] .summary a { background-color: #16213e !important; border-color: #333 !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] li, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Definition lists
      '[data-theme="dark"] dt, [data-theme="dark"] dd { background-color: transparent !important; }',
      // Catch-all for any remaining white backgrounds
      '[data-theme="dark"] div, [data-theme="dark"] section, [data-theme="dark"] article, [data-theme="dark"] aside { background-color: inherit !important; }'
    ].join('\n');
    document.head.appendChild(style);
  }

  // Get saved theme or detect system preference
  function getPreferredTheme() {
    var saved = localStorage.getItem('yard-theme');
    if (saved) return saved;

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  }

  // Apply theme to a document
  function applyThemeToDocument(doc, theme) {
    if (!doc || !doc.documentElement) return;
    doc.documentElement.setAttribute('data-theme', theme);

    // Also set on body for broader compatibility
    if (doc.body) {
      doc.body.setAttribute('data-theme', theme);
    }
  }

  // Inject inline styles into a document
  function injectInlineStylesToDocument(doc) {
    if (!doc || !doc.head) return;
    if (doc.getElementById('theme-inline-css')) return;

    var style = doc.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      // Root elements - critical for frame backgrounds
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      'html[data-theme="dark"], html[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      'body[data-theme="dark"] { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      // Sidebar frames
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects, [data-theme="dark"] .list { background-color: #16213e !important; }',
      '[data-theme="dark"] li { background-color: transparent !important; }',
      // Table of Contents
      '[data-theme="dark"] #toc, [data-theme="dark"] .toc, [data-theme="dark"] #table_of_contents { background-color: #1a1a2e !important; border-color: #333 !important; }',
      '[data-theme="dark"] #toc a, [data-theme="dark"] .toc a { color: #5dade2 !important; }',
      '[data-theme="dark"] #toc li, [data-theme="dark"] .toc li { background-color: transparent !important; }',
      // File listing badges on index page
      '[data-theme="dark"] .alpha_listing a, [data-theme="dark"] .file_listing a, [data-theme="dark"] p.children a { background-color: #16213e !important; border-color: #333 !important; }',
      '[data-theme="dark"] .r1 a, [data-theme="dark"] .r2 a, [data-theme="dark"] .index_list a { background-color: #16213e !important; border-color: #333 !important; }',
      // Defined in box
      '[data-theme="dark"] .defined_in, [data-theme="dark"] .defines, [data-theme="dark"] dl.box, [data-theme="dark"] .box_info { background-color: #16213e !important; border-color: #333 !important; }',
      // Expand/collapse buttons and show/hide links
      '[data-theme="dark"] .summary_toggle, [data-theme="dark"] a.toggle, [data-theme="dark"] .expand, [data-theme="dark"] .collapse { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] .show_all, [data-theme="dark"] .hide_all, [data-theme="dark"] a.show, [data-theme="dark"] a.hide { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] .more, [data-theme="dark"] a.more, [data-theme="dark"] .less, [data-theme="dark"] a.less { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] dl.box a, [data-theme="dark"] .box_info a, [data-theme="dark"] .showAll, [data-theme="dark"] .hideAll { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      '[data-theme="dark"] h2 a, [data-theme="dark"] h3 a, [data-theme="dark"] a[href="#"] { background-color: #0f3460 !important; border-color: #333 !important; color: #5dade2 !important; }',
      // Method summary badges
      '[data-theme="dark"] .summary_signature a, [data-theme="dark"] ul.summary a, [data-theme="dark"] .summary a { background-color: #16213e !important; border-color: #333 !important; }',
      // Links
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      // Tables
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td, [data-theme="dark"] table tr { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      '[data-theme="dark"] table tr:nth-child(even), [data-theme="dark"] table tr:nth-child(even) td { background-color: #16213e !important; }',
      // Forms
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      // Text
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] p, [data-theme="dark"] span { color: #b8b8b8 !important; }',
      // Definition lists
      '[data-theme="dark"] dt, [data-theme="dark"] dd { background-color: transparent !important; }',
      // Content area
      '[data-theme="dark"] #content { background-color: #1a1a2e !important; }',
      '[data-theme="dark"] pre, [data-theme="dark"] code { background-color: #0d1117 !important; color: #c9d1d9 !important; }',
      // Catch-all
      '[data-theme="dark"] div, [data-theme="dark"] section { background-color: inherit !important; }'
    ].join('\n');
    doc.head.appendChild(style);
  }

  // Inject theme CSS into a document
  function injectThemeCSSIntoDocument(doc, rootPath) {
    if (!doc || !doc.head) return;

    // Always inject inline styles first as fallback
    injectInlineStylesToDocument(doc);

    if (doc.getElementById('theme-css')) return;

    // Try multiple paths
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css'
    ];

    var link = doc.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    doc.head.appendChild(link);
  }

  // Apply theme to all frames
  function applyThemeToAllFrames(theme) {
    var rootPath = getRootPath();

    // Apply to main document
    applyThemeToDocument(document, theme);
    injectThemeCSSIntoDocument(document, rootPath);

    // Apply to all frames and iframes
    try {
      var frames = document.querySelectorAll('frame, iframe');
      frames.forEach(function(frame) {
        try {
          var frameDoc = frame.contentDocument || frame.contentWindow.document;
          if (frameDoc) {
            applyThemeToDocument(frameDoc, theme);
            // Calculate root path relative to frame
            var frameRootPath = rootPath || '';
            injectThemeCSSIntoDocument(frameDoc, frameRootPath);
          }
        } catch (e) {
          // Cross-origin frame, skip
        }
      });

      // Also check parent frames (if we're in a frame)
      if (window.parent && window.parent !== window) {
        try {
          applyThemeToDocument(window.parent.document, theme);
          injectThemeCSSIntoDocument(window.parent.document, rootPath);
        } catch (e) {
          // Cross-origin, skip
        }
      }

      // Check top-level window
      if (window.top && window.top !== window) {
        try {
          applyThemeToDocument(window.top.document, theme);
          injectThemeCSSIntoDocument(window.top.document, rootPath);

          // Apply to all frames from top
          var topFrames = window.top.document.querySelectorAll('frame, iframe');
          topFrames.forEach(function(frame) {
            try {
              var frameDoc = frame.contentDocument || frame.contentWindow.document;
              if (frameDoc) {
                applyThemeToDocument(frameDoc, theme);
                injectThemeCSSIntoDocument(frameDoc, '');
              }
            } catch (e) {}
          });
        } catch (e) {
          // Cross-origin, skip
        }
      }
    } catch (e) {
      // Frames not accessible
    }
  }

  // Apply theme
  function applyTheme(theme) {
    localStorage.setItem('yard-theme', theme);

    // Apply to all documents
    applyThemeToAllFrames(theme);

    var btn = document.getElementById('theme-toggle');
    if (btn) {
      btn.textContent = theme === 'dark' ? ' Light' : ' Dark';
      btn.title = 'Switch to ' + (theme === 'dark' ? 'light' : 'dark') + ' mode';
    }
  }

  // Toggle theme
  function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme') || 'light';
    var newTheme = current === 'dark' ? 'light' : 'dark';
    applyTheme(newTheme);
  }

  // Check if we're in a sidebar/list frame (should not add nav)
  function isListFrame() {
    var path = window.location.pathname.toLowerCase();
    // Skip list frames
    if (path.includes('class_list') ||
        path.includes('file_list') ||
        path.includes('method_list') ||
        path.includes('_list.html') ||
        path.includes('frames.html')) {
      return true;
    }
    // Skip if this is a frame with full_list (sidebar)
    if (document.getElementById('full_list') && !document.getElementById('content')) {
      return true;
    }
    // Skip if we're clearly in a sub-frame
    if (window.frameElement) {
      return true;
    }
    return false;
  }

  function addNavLinks() {
    // Don't add nav to list/sidebar frames
    if (isListFrame()) return;

    var content = document.getElementById('content');
    if (!content) return;

    if (document.getElementById('quick-nav')) return;

    var rootPath = getRootPath();

    var nav = document.createElement('div');
    nav.id = 'quick-nav';
    nav.style.cssText = 'padding: 8px 15px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ddd; font-size: 14px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;';

    var links = document.createElement('div');
    links.innerHTML = '<a href="' + rootPath + 'index.html" style="margin-right: 15px; text-decoration: none;">Home</a> | ' +
                      '<a href="' + rootPath + '_index.html" style="margin-left: 15px; margin-right: 15px; text-decoration: none;">All Classes</a> | ' +
                      '<a href="' + rootPath + 'file.psm-reference.html" style="margin-left: 15px; text-decoration: none;">PSM Guide</a>';

    var themeBtn = document.createElement('button');
    themeBtn.id = 'theme-toggle';
    themeBtn.type = 'button';
    themeBtn.onclick = toggleTheme;

    nav.appendChild(links);
    nav.appendChild(themeBtn);

    content.insertBefore(nav, content.firstChild);

    var currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    themeBtn.textContent = currentTheme === 'dark' ? ' Light' : ' Dark';
    themeBtn.title = 'Switch to ' + (currentTheme === 'dark' ? 'light' : 'dark') + ' mode';
  }

  // Fix sidebar links - only run in actual sidebar/list frames
  function fixAllSidebarLinks() {
    // Only fix links if we're in a list frame
    if (!isListFrame()) return;

    // Get all possible sidebar/menu containers
    var selectors = [
      '#full_list',
      '#menu',
      '.menu',
      '#full_list_content',
      '.class_list',
      '.objects',
      '.sidebar',
      '#list',
      '.y_list'
    ];

    selectors.forEach(function(selector) {
      var containers = document.querySelectorAll(selector);
      containers.forEach(function(container) {
        // Add click handler to container that forces navigation
        if (!container.dataset.navFixed) {
          container.dataset.navFixed = 'true';

          container.addEventListener('click', function(e) {
            // Find the clicked link
            var target = e.target;
            while (target && target !== container) {
              if (target.tagName === 'A') {
                var href = target.getAttribute('href');
                if (href && href !== '#' && !href.startsWith('javascript:')) {
                  e.preventDefault();
                  e.stopPropagation();
                  e.stopImmediatePropagation();

                  // Navigate the parent/top frame, not this frame
                  if (window.parent && window.parent !== window) {
                    window.parent.location.href = target.href;
                  } else if (window.top && window.top !== window) {
                    window.top.location.href = target.href;
                  } else {
                    window.location.href = target.href;
                  }
                  return false;
                }
              }
              target = target.parentNode;
            }
          }, true); // Capture phase
        }

        // Also fix individual links
        var links = container.querySelectorAll('a');
        links.forEach(function(link) {
          if (!link.dataset.navFixed) {
            link.dataset.navFixed = 'true';
            var href = link.getAttribute('href');
            if (href && href !== '#' && !href.startsWith('javascript:')) {
              // Store the original href
              var fullHref = link.href;

              // Override onclick - navigate parent frame
              link.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (window.parent && window.parent !== window) {
                  window.parent.location.href = fullHref;
                } else if (window.top && window.top !== window) {
                  window.top.location.href = fullHref;
                } else {
                  window.location.href = fullHref;
                }
                return false;
              };
            }
          }
        });
      });
    });
  }

  // Watch for dynamically loaded content - only in list frames
  function observeForNewLinks() {
    // Only observe in list frames
    if (!isListFrame()) return;

    var observer = new MutationObserver(function(mutations) {
      var hasNewNodes = mutations.some(function(m) {
        return m.addedNodes.length > 0;
      });
      if (hasNewNodes) {
        // Delay slightly to let YARD's JS run first
        setTimeout(fixAllSidebarLinks, 10);
      }
    });

    if (document.body) {
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
  }

  // Initialize
  function init() {
    injectThemeCSS();
    applyTheme(getPreferredTheme());
    addNavLinks();
    fixAllSidebarLinks();
    observeForNewLinks();
  }

  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // Run periodically to catch all dynamic content and frames
  var intervals = [50, 100, 250, 500, 1000, 2000, 3000];
  intervals.forEach(function(ms) {
    setTimeout(function() {
      fixAllSidebarLinks();
      // Reapply theme to catch any newly loaded frames
      var theme = localStorage.getItem('yard-theme') || getPreferredTheme();
      applyThemeToAllFrames(theme);
    }, ms);
  });

  // Also run on any click anywhere (last resort) - only in list frames
  document.addEventListener('click', function(e) {
    // Only handle in list frames
    if (!isListFrame()) return;

    if (e.target.tagName === 'A') {
      var href = e.target.getAttribute('href');
      if (href && href !== '#' && !href.startsWith('javascript:')) {
        // Check if it's a sidebar link
        var inSidebar = e.target.closest('#full_list, #menu, .menu, .sidebar');
        if (inSidebar) {
          e.preventDefault();
          e.stopPropagation();
          // Navigate parent frame
          if (window.parent && window.parent !== window) {
            window.parent.location.href = e.target.href;
          } else {
            window.location.href = e.target.href;
          }
        }
      }
    }
  }, true);

  // Listen for system theme changes
  if (window.matchMedia) {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('yard-theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  }
})();

</script>
</body>
</html>