<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Lich::Common::CLI::PasswordManager
  
    &mdash; Lich 5 Documentation
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Lich::Common::CLI::PasswordManager";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span>
     &raquo; 
    <span class="title">PasswordManager</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Lich::Common::CLI::PasswordManager
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>documented/common/cli/cli_password_manager.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_account-class_method" title="add_account (class method)">.<strong>add_account</strong>(account, password, frontend = nil)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds a new account with the specified password.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#change_account_password-class_method" title="change_account_password (class method)">.<strong>change_account_password</strong>(account, new_password)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Changes the password for a specified account.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#change_master_password-class_method" title="change_master_password (class method)">.<strong>change_master_password</strong>(old_password, new_password = nil)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Changes the master password used for account encryption.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#determine_predominant_frontend-class_method" title="determine_predominant_frontend (class method)">.<strong>determine_predominant_frontend</strong>(yaml_file)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determines the most commonly used frontend from the accounts in the YAML file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_master_password_from_keychain_or_prompt-class_method" title="get_master_password_from_keychain_or_prompt (class method)">.<strong>get_master_password_from_keychain_or_prompt</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the master password from the keychain or prompts the user to create one.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prompt_and_confirm_password-class_method" title="prompt_and_confirm_password (class method)">.<strong>prompt_and_confirm_password</strong>(prompt = &quot;Enter password&quot;)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Prompts the user to enter and confirm a password.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prompt_for_frontend-class_method" title="prompt_for_frontend (class method)">.<strong>prompt_for_frontend</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Prompts the user to select a frontend from a list of options.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prompt_for_master_password-class_method" title="prompt_for_master_password (class method)">.<strong>prompt_for_master_password</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Prompts the user to enter the master password.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#recover_master_password-class_method" title="recover_master_password (class method)">.<strong>recover_master_password</strong>(master_password = nil)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Recovers the master password from the keychain or prompts the user for it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_master_password_available-class_method" title="validate_master_password_available (class method)">.<strong>validate_master_password_available</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Validates if the master password is available for use.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_account-class_method">
  
    .<strong>add_account</strong>(account, password, frontend = nil)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds a new account with the specified password.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Adding a new account</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_add_account'>add_account</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_account</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_password</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stormfront</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>account</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the account to be added.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>password</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The password for the new account.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>frontend</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Optional frontend to associate with the account.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns 0 on success, 1 if master password is unavailable, or 2 if authentication fails.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Raises an error if there is an issue during the process.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 105</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_account'>add_account</span><span class='lparen'>(</span><span class='id identifier rubyid_account'>account</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_frontend'>frontend</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># Validate master password availability before attempting add
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_validate_master_password_available'>validate_master_password_available</span>
    <span class='kw'>return</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_data_dir'>data_dir</span> <span class='op'>=</span> <span class='const'>DATA_DIR</span>
  <span class='id identifier rubyid_yaml_file'>yaml_file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/YamlState.html" title="Lich::Common::GUI::YamlState (module)">YamlState</a></span></span><span class='period'>.</span><span class='id identifier rubyid_yaml_file_path'><span class='object_link'><a href="../GUI/YamlState.html#yaml_file_path-class_method" title="Lich::Common::GUI::YamlState.yaml_file_path (method)">yaml_file_path</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data_dir'>data_dir</span><span class='rparen'>)</span>

  <span class='kw'>begin</span>
    <span class='comment'># Check if account already exists
</span>    <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_yaml_data'>yaml_data</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_account'>account</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; already exists</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Use --change-account-password to update the password.</span><span class='tstring_end'>&quot;</span></span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI add account failed - account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; already exists</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>return</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Adding account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; via CLI</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Authenticate with game servers to fetch characters (like GUI does)
</span>    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Authenticating with game servers...</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Authenticating account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; with game servers</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_auth_data'>auth_data</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/Authentication.html" title="Lich::Common::GUI::Authentication (module)">Authentication</a></span></span><span class='period'>.</span><span class='id identifier rubyid_authenticate'><span class='object_link'><a href="../GUI/Authentication.html#authenticate-class_method" title="Lich::Common::GUI::Authentication.authenticate (method)">authenticate</a></span></span><span class='lparen'>(</span>
      <span class='label'>account:</span> <span class='id identifier rubyid_account'>account</span><span class='comma'>,</span>
      <span class='label'>password:</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span>
      <span class='label'>legacy:</span> <span class='kw'>true</span>
    <span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_auth_data'>auth_data</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_auth_data'>auth_data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_auth_data'>auth_data</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Authentication failed or no characters found</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI add account failed - game server authentication failed for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>2</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Authentication successful - found </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_data'>auth_data</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> character(s)</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Determine frontend
</span>    <span class='id identifier rubyid_selected_frontend'>selected_frontend</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_frontend'>frontend</span>
                          <span class='comment'># Frontend provided via --frontend flag
</span>                          <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Using provided frontend: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_frontend'>frontend</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                          <span class='id identifier rubyid_frontend'>frontend</span>
                        <span class='kw'>else</span>
                          <span class='comment'># Check predominant frontend in YAML, or prompt
</span>                          <span class='id identifier rubyid_predominant'>predominant</span> <span class='op'>=</span> <span class='id identifier rubyid_determine_predominant_frontend'>determine_predominant_frontend</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
                          <span class='kw'>if</span> <span class='id identifier rubyid_predominant'>predominant</span>
                            <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Using predominant frontend: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_predominant'>predominant</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                            <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Using predominant frontend: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_predominant'>predominant</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                            <span class='id identifier rubyid_predominant'>predominant</span>
                          <span class='kw'>else</span>
                            <span class='comment'># Prompt user
</span>                            <span class='id identifier rubyid_prompt_for_frontend'>prompt_for_frontend</span>
                          <span class='kw'>end</span>
                        <span class='kw'>end</span>

    <span class='comment'># Convert authentication data to character list
</span>    <span class='id identifier rubyid_character_list'>character_list</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/AccountManager.html" title="Lich::Common::GUI::AccountManager (module)">AccountManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_convert_auth_data_to_characters'><span class='object_link'><a href="../GUI/AccountManager.html#convert_auth_data_to_characters-class_method" title="Lich::Common::GUI::AccountManager.convert_auth_data_to_characters (method)">convert_auth_data_to_characters</a></span></span><span class='lparen'>(</span>
      <span class='id identifier rubyid_auth_data'>auth_data</span><span class='comma'>,</span>
      <span class='id identifier rubyid_selected_frontend'>selected_frontend</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stormfront</span><span class='tstring_end'>&#39;</span></span>
    <span class='rparen'>)</span>

    <span class='comment'># Save account + characters using AccountManager
</span>    <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/AccountManager.html" title="Lich::Common::GUI::AccountManager (module)">AccountManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_add_or_update_account'><span class='object_link'><a href="../GUI/AccountManager.html#add_or_update_account-class_method" title="Lich::Common::GUI::AccountManager.add_or_update_account (method)">add_or_update_account</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data_dir'>data_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_account'>account</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_character_list'>character_list</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>success: Account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; added with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_character_list'>character_list</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> character(s)</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; added successfully with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_character_list'>character_list</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> character(s)</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_selected_frontend'>selected_frontend</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_selected_frontend'>selected_frontend</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>note: Frontend not set - use GUI to configure or rerun with --frontend</span><span class='tstring_end'>&quot;</span></span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>warning: No frontend set for account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='int'>0</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Failed to save account</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI add account failed - could not save account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='comment'># CRITICAL: Only log e.message, NEVER log password values
</span>    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI add account failed for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="change_account_password-class_method">
  
    .<strong>change_account_password</strong>(account, new_password)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Changes the password for a specified account.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Changing an account password</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_change_account_password'>change_account_password</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_account</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new_password</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>account</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the account whose password is to be changed.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>new_password</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The new password for the account.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns 0 on success, 1 if master password is unavailable, 2 if account not found, or 1 on error.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Raises an error if there is an issue during the process.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 22</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_change_account_password'>change_account_password</span><span class='lparen'>(</span><span class='id identifier rubyid_account'>account</span><span class='comma'>,</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='rparen'>)</span>
  <span class='comment'># Validate master password availability before attempting change
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_validate_master_password_available'>validate_master_password_available</span>
    <span class='kw'>return</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_data_dir'>data_dir</span> <span class='op'>=</span> <span class='const'>DATA_DIR</span>
  <span class='id identifier rubyid_yaml_file'>yaml_file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/YamlState.html" title="Lich::Common::GUI::YamlState (module)">YamlState</a></span></span><span class='period'>.</span><span class='id identifier rubyid_yaml_file_path'><span class='object_link'><a href="../GUI/YamlState.html#yaml_file_path-class_method" title="Lich::Common::GUI::YamlState.yaml_file_path (method)">yaml_file_path</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data_dir'>data_dir</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: entry.yaml not found at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='int'>2</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_yaml_data'>yaml_data</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_encryption_mode'>encryption_mode</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>encryption_mode</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>plaintext</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

    <span class='comment'># Find account
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_account'>account</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; not found</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI change password failed - account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; not found</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>2</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Changing password for account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; (mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_encryption_mode'>encryption_mode</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Encrypt password based on mode
</span>    <span class='id identifier rubyid_encrypted'>encrypted</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_encryption_mode'>encryption_mode</span>
                <span class='kw'>when</span> <span class='symbol'>:plaintext</span>
                  <span class='id identifier rubyid_new_password'>new_password</span>
                <span class='kw'>when</span> <span class='symbol'>:standard</span>
                  <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/PasswordCipher.html" title="Lich::Common::GUI::PasswordCipher (module)">PasswordCipher</a></span></span><span class='period'>.</span><span class='id identifier rubyid_encrypt'><span class='object_link'><a href="../GUI/PasswordCipher.html#encrypt-class_method" title="Lich::Common::GUI::PasswordCipher.encrypt (method)">encrypt</a></span></span><span class='lparen'>(</span>
                    <span class='id identifier rubyid_new_password'>new_password</span><span class='comma'>,</span>
                    <span class='label'>mode:</span> <span class='symbol'>:standard</span><span class='comma'>,</span>
                    <span class='label'>account_name:</span> <span class='id identifier rubyid_account'>account</span>
                  <span class='rparen'>)</span>
                <span class='kw'>when</span> <span class='symbol'>:enhanced</span>
                  <span class='id identifier rubyid_master_password'>master_password</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_retrieve_master_password'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#retrieve_master_password-class_method" title="Lich::Common::GUI::MasterPasswordManager.retrieve_master_password (method)">retrieve_master_password</a></span></span>
                  <span class='kw'>if</span> <span class='id identifier rubyid_master_password'>master_password</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Enhanced mode requires master password in keychain</span><span class='tstring_end'>&#39;</span></span>
                    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: CLI change password failed - master password not in keychain</span><span class='tstring_end'>&#39;</span></span>
                    <span class='kw'>return</span> <span class='int'>1</span>
                  <span class='kw'>end</span>
                  <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/PasswordCipher.html" title="Lich::Common::GUI::PasswordCipher (module)">PasswordCipher</a></span></span><span class='period'>.</span><span class='id identifier rubyid_encrypt'><span class='object_link'><a href="../GUI/PasswordCipher.html#encrypt-class_method" title="Lich::Common::GUI::PasswordCipher.encrypt (method)">encrypt</a></span></span><span class='lparen'>(</span>
                    <span class='id identifier rubyid_new_password'>new_password</span><span class='comma'>,</span>
                    <span class='label'>mode:</span> <span class='symbol'>:enhanced</span><span class='comma'>,</span>
                    <span class='label'>account_name:</span> <span class='id identifier rubyid_account'>account</span><span class='comma'>,</span>
                    <span class='label'>master_password:</span> <span class='id identifier rubyid_master_password'>master_password</span>
                  <span class='rparen'>)</span>
                <span class='kw'>else</span>
                  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Unknown encryption mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_encryption_mode'>encryption_mode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI change password failed - unknown encryption mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_encryption_mode'>encryption_mode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>return</span> <span class='int'>1</span>
                <span class='kw'>end</span>

    <span class='comment'># Update account password
</span>    <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_account'>account</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_encrypted'>encrypted</span>

    <span class='comment'># Save YAML
</span>    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>0o600</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
      <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>success: Password changed for account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Password changed successfully for account &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
    <span class='int'>0</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='comment'># CRITICAL: Only log e.message, NEVER log password values
</span>    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI change password failed for &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account'>account</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="change_master_password-class_method">
  
    .<strong>change_master_password</strong>(old_password, new_password = nil)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Changes the master password used for account encryption.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Changing the master password</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_change_master_password'>change_master_password</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>old_password</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new_password</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>old_password</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The current master password.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>new_password</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The new master password. If nil, prompts for input.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns 0 on success, 1 if validation fails, or 2 if the YAML file is not found.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Raises an error if there is an issue during the process.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 198</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_change_master_password'>change_master_password</span><span class='lparen'>(</span><span class='id identifier rubyid_old_password'>old_password</span><span class='comma'>,</span> <span class='id identifier rubyid_new_password'>new_password</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data_dir'>data_dir</span> <span class='op'>=</span> <span class='const'>DATA_DIR</span>
  <span class='id identifier rubyid_yaml_file'>yaml_file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/YamlState.html" title="Lich::Common::GUI::YamlState (module)">YamlState</a></span></span><span class='period'>.</span><span class='id identifier rubyid_yaml_file_path'><span class='object_link'><a href="../GUI/YamlState.html#yaml_file_path-class_method" title="Lich::Common::GUI::YamlState.yaml_file_path (method)">yaml_file_path</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data_dir'>data_dir</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: entry.yaml not found at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='int'>2</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_yaml_data'>yaml_data</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_encryption_mode'>encryption_mode</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>encryption_mode</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>plaintext</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_encryption_mode'>encryption_mode</span> <span class='op'>==</span> <span class='symbol'>:enhanced</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Master password only used in Enhanced encryption mode</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Current mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_encryption_mode'>encryption_mode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI change master password failed - wrong encryption mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_encryption_mode'>encryption_mode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>3</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Starting CLI master password change</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Validate old password
</span>    <span class='id identifier rubyid_validation_test'>validation_test</span> <span class='op'>=</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master_password_validation_test</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_validate_master_password'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#validate_master_password-class_method" title="Lich::Common::GUI::MasterPasswordManager.validate_master_password (method)">validate_master_password</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_old_password'>old_password</span><span class='comma'>,</span> <span class='id identifier rubyid_validation_test'>validation_test</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Current master password incorrect</span><span class='tstring_end'>&#39;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: CLI change master password failed - incorrect current password</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>return</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Current master password validated successfully</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Use provided password or prompt for new password
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enter new master password: </span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Unable to read password from STDIN / terminal</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Please run this command interactively (not in a pipe or automated script without input)</span><span class='tstring_end'>&#39;</span></span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: CLI change master password failed - stdin unavailable</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>return</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_new_password'>new_password</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

      <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Confirm new master password: </span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Unable to read password from STDIN / terminal</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Please run this command interactively (not in a pipe or automated script without input)</span><span class='tstring_end'>&#39;</span></span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: CLI change master password failed - stdin unavailable</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>return</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_confirm_password'>confirm_password</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

      <span class='kw'>unless</span> <span class='id identifier rubyid_new_password'>new_password</span> <span class='op'>==</span> <span class='id identifier rubyid_confirm_password'>confirm_password</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Passwords do not match</span><span class='tstring_end'>&quot;</span></span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI change master password failed - password confirmation mismatch</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>return</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_new_password'>new_password</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>8</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Password must be at least 8 characters</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI change master password failed - password too short</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_account_count'>account_count</span> <span class='op'>=</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Re-encrypting </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_account_count'>account_count</span><span class='embexpr_end'>}</span><span class='tstring_content'> account(s) with new master password</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Re-encrypt all accounts
</span>    <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__username'>_username</span><span class='comma'>,</span> <span class='id identifier rubyid_account_data'>account_data</span><span class='op'>|</span>
      <span class='comment'># Decrypt with old password
</span>      <span class='id identifier rubyid_plaintext'>plaintext</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/PasswordCipher.html" title="Lich::Common::GUI::PasswordCipher (module)">PasswordCipher</a></span></span><span class='period'>.</span><span class='id identifier rubyid_decrypt'><span class='object_link'><a href="../GUI/PasswordCipher.html#decrypt-class_method" title="Lich::Common::GUI::PasswordCipher.decrypt (method)">decrypt</a></span></span><span class='lparen'>(</span>
        <span class='id identifier rubyid_account_data'>account_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='label'>mode:</span> <span class='symbol'>:enhanced</span><span class='comma'>,</span>
        <span class='label'>master_password:</span> <span class='id identifier rubyid_old_password'>old_password</span>
      <span class='rparen'>)</span>

      <span class='comment'># Encrypt with new password
</span>      <span class='id identifier rubyid_new_encrypted'>new_encrypted</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/PasswordCipher.html" title="Lich::Common::GUI::PasswordCipher (module)">PasswordCipher</a></span></span><span class='period'>.</span><span class='id identifier rubyid_encrypt'><span class='object_link'><a href="../GUI/PasswordCipher.html#encrypt-class_method" title="Lich::Common::GUI::PasswordCipher.encrypt (method)">encrypt</a></span></span><span class='lparen'>(</span>
        <span class='id identifier rubyid_plaintext'>plaintext</span><span class='comma'>,</span>
        <span class='label'>mode:</span> <span class='symbol'>:enhanced</span><span class='comma'>,</span>
        <span class='label'>master_password:</span> <span class='id identifier rubyid_new_password'>new_password</span>
      <span class='rparen'>)</span>

      <span class='id identifier rubyid_account_data'>account_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_encrypted'>new_encrypted</span>
    <span class='kw'>end</span>

    <span class='comment'># Update validation test
</span>    <span class='id identifier rubyid_new_validation'>new_validation</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create_validation_test'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#create_validation_test-class_method" title="Lich::Common::GUI::MasterPasswordManager.create_validation_test (method)">create_validation_test</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_new_password'>new_password</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master_password_validation_test</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_validation'>new_validation</span>

    <span class='comment'># Update keychain
</span>    <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_store_master_password'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#store_master_password-class_method" title="Lich::Common::GUI::MasterPasswordManager.store_master_password (method)">store_master_password</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_new_password'>new_password</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Failed to update keychain</span><span class='tstring_end'>&#39;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: CLI change master password failed - keychain update failed</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>return</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='comment'># Save YAML
</span>    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>0o600</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
      <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>success: Master password changed</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>info: Master password changed successfully via CLI</span><span class='tstring_end'>&#39;</span></span>
    <span class='int'>0</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='comment'># CRITICAL: Only log e.message, NEVER log password values
</span>    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI change master password failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="determine_predominant_frontend-class_method">
  
    .<strong>determine_predominant_frontend</strong>(yaml_file)  &#x21d2; <tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determines the most commonly used frontend from the accounts in the YAML file.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Determining predominant frontend</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_frontend'>frontend</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_determine_predominant_frontend'>determine_predominant_frontend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/yaml_file</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>yaml_file</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The path to the YAML file containing account data.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns the predominant frontend or nil if none found.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 319</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_determine_predominant_frontend'>determine_predominant_frontend</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_yaml_data'>yaml_data</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_frontend_counts'>frontend_counts</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accounts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__username'>_username</span><span class='comma'>,</span> <span class='id identifier rubyid_account_data'>account_data</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_account_data'>account_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>characters</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_account_data'>account_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>characters</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_char'>char</span><span class='op'>|</span>
      <span class='id identifier rubyid_fe'>fe</span> <span class='op'>=</span> <span class='id identifier rubyid_char'>char</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>frontend</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_frontend_counts'>frontend_counts</span><span class='lbracket'>[</span><span class='id identifier rubyid_fe'>fe</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_fe'>fe</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_fe'>fe</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_frontend_counts'>frontend_counts</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_frontend_counts'>frontend_counts</span><span class='period'>.</span><span class='id identifier rubyid_max_by'>max_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__fe'>_fe</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='id identifier rubyid_count'>count</span> <span class='rbrace'>}</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_master_password_from_keychain_or_prompt-class_method">
  
    .<strong>get_master_password_from_keychain_or_prompt</strong>  &#x21d2; <tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the master password from the keychain or prompts the user to create one.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Getting master password from keychain or prompting</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_master_password'>master_password</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_master_password_from_keychain_or_prompt'>get_master_password_from_keychain_or_prompt</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns the master password or nil if not available.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


549
550
551
552
553
554
555
556
557</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 549</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_master_password_from_keychain_or_prompt'>get_master_password_from_keychain_or_prompt</span>
  <span class='comment'># Check if password already exists in keychain
</span>  <span class='id identifier rubyid_existing'>existing</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_retrieve_master_password'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#retrieve_master_password-class_method" title="Lich::Common::GUI::MasterPasswordManager.retrieve_master_password (method)">retrieve_master_password</a></span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_existing'>existing</span> <span class='kw'>if</span> <span class='id identifier rubyid_existing'>existing</span>

  <span class='comment'># Not in keychain, prompt user to create one
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creating new master password for Enhanced encryption mode...</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_prompt_and_confirm_password'>prompt_and_confirm_password</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enter new master password</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prompt_and_confirm_password-class_method">
  
    .<strong>prompt_and_confirm_password</strong>(prompt = &quot;Enter password&quot;)  &#x21d2; <tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Prompts the user to enter and confirm a password.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Prompting and confirming a password</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_password'>password</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_prompt_and_confirm_password'>prompt_and_confirm_password</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enter your password</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>prompt</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;Enter password&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The prompt message to display to the user.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns the confirmed password or nil if there was an error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 506</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_prompt_and_confirm_password'>prompt_and_confirm_password</span><span class='lparen'>(</span><span class='id identifier rubyid_prompt'>prompt</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enter password</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prompt'>prompt</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Unable to read password from STDIN / terminal</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Please run this command interactively (not in a pipe or automated script without input)</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Password prompt failed - stdin unavailable</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_password'>password</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Confirm </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prompt'>prompt</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Unable to read password from STDIN / terminal</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Please run this command interactively (not in a pipe or automated script without input)</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Password confirmation failed - stdin unavailable</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_confirm_password'>confirm_password</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>==</span> <span class='id identifier rubyid_confirm_password'>confirm_password</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Passwords do not match</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Password confirmation mismatch</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_password'>password</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>8</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Password must be at least 8 characters</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Password too short (minimum 8 characters)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_password'>password</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
  <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Password prompt failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prompt_for_frontend-class_method">
  
    .<strong>prompt_for_frontend</strong>  &#x21d2; <tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Prompts the user to select a frontend from a list of options.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Prompting for frontend</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_selected_frontend'>selected_frontend</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_prompt_for_frontend'>prompt_for_frontend</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns the selected frontend or nil if skipped.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 344</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_prompt_for_frontend'>prompt_for_frontend</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nSelect frontend (or press Enter to skip):</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  1. wizard</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  2. stormfront</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  3. avalon</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Choice (1-3 or Enter): </span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Unable to read input from STDIN / terminal</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Please run this command interactively (not in a pipe or automated script without input)</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_choice'>choice</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_choice'>choice</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_choice'>choice</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>wizard</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stormfront</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>3</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>avalon</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid choice, skipping frontend selection</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prompt_for_master_password-class_method">
  
    .<strong>prompt_for_master_password</strong>  &#x21d2; <tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Prompts the user to enter the master password.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Prompting for master password</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_master_password'>master_password</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_prompt_for_master_password'>prompt_for_master_password</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns the entered master password or nil if there was an error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


563
564
565
566
567
568
569
570
571
572
573
574
575</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 563</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_prompt_for_master_password'>prompt_for_master_password</span>
  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enter master password: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Unable to read password from STDIN / terminal</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Master password prompt failed - stdin unavailable</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
  <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Master password prompt failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="recover_master_password-class_method">
  
    .<strong>recover_master_password</strong>(master_password = nil)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Recovers the master password from the keychain or prompts the user for it.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Recovering the master password</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_recover_master_password'>recover_master_password</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>master_password</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Optional master password to validate against.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns 0 on success, 1 if validation fails, or 2 if the YAML file is not found.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Raises an error if there is an issue during the process.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 425</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_recover_master_password'>recover_master_password</span><span class='lparen'>(</span><span class='id identifier rubyid_master_password'>master_password</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data_dir'>data_dir</span> <span class='op'>=</span> <span class='const'>DATA_DIR</span>
  <span class='id identifier rubyid_yaml_file'>yaml_file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/YamlState.html" title="Lich::Common::GUI::YamlState (module)">YamlState</a></span></span><span class='period'>.</span><span class='id identifier rubyid_yaml_file_path'><span class='object_link'><a href="../GUI/YamlState.html#yaml_file_path-class_method" title="Lich::Common::GUI::YamlState.yaml_file_path (method)">yaml_file_path</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data_dir'>data_dir</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: entry.yaml not found at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='int'>2</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_yaml_data'>yaml_data</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_encryption_mode'>encryption_mode</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>encryption_mode</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>plaintext</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_encryption_mode'>encryption_mode</span> <span class='op'>==</span> <span class='symbol'>:enhanced</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Master password recovery only works in Enhanced encryption mode</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Current mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_encryption_mode'>encryption_mode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI recover master password failed - wrong encryption mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_encryption_mode'>encryption_mode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>3</span>
    <span class='kw'>end</span>

    <span class='comment'># Must have validation test to validate password
</span>    <span class='id identifier rubyid_validation_test'>validation_test</span> <span class='op'>=</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master_password_validation_test</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_validation_test'>validation_test</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: No validation test found - cannot recover master password</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI recover master password failed - no validation test</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Starting master password recovery</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Get password to validate
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_master_password'>master_password</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enter master password: </span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Unable to read password from STDIN / terminal</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Please run this command interactively (not in a pipe or automated script without input)</span><span class='tstring_end'>&#39;</span></span>
        <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: CLI recover master password failed - stdin unavailable</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>return</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_master_password'>master_password</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_master_password'>master_password</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>8</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Password must be at least 8 characters</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI recover master password failed - password too short</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='comment'># Validate password against validation test
</span>    <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_validate_master_password'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#validate_master_password-class_method" title="Lich::Common::GUI::MasterPasswordManager.validate_master_password (method)">validate_master_password</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_master_password'>master_password</span><span class='comma'>,</span> <span class='id identifier rubyid_validation_test'>validation_test</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Password validation failed</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI recover master password failed - password validation failed</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Password validated successfully</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Store validated password in keychain
</span>    <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_store_master_password'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#store_master_password-class_method" title="Lich::Common::GUI::MasterPasswordManager.store_master_password (method)">store_master_password</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_master_password'>master_password</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: Failed to store master password in keychain</span><span class='tstring_end'>&#39;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>error: CLI recover master password failed - keychain storage failed</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>return</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>success: Master password recovered and restored to keychain</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>info: Master password recovered successfully via CLI</span><span class='tstring_end'>&#39;</span></span>
    <span class='int'>0</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='comment'># CRITICAL: Only log e.message, NEVER log password values
</span>    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: CLI recover master password failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_master_password_available-class_method">
  
    .<strong>validate_master_password_available</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Validates if the master password is available for use.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Validating master password availability</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_is_available'>is_available</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../CLI.html" title="Lich::Common::CLI (module)">CLI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Lich::Common::CLI::PasswordManager (module)">PasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_validate_master_password_available'>validate_master_password_available</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns true if the master password is available, false otherwise.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'documented/common/cli/cli_password_manager.rb', line 374</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_validate_master_password_available'>validate_master_password_available</span>
  <span class='id identifier rubyid_data_dir'>data_dir</span> <span class='op'>=</span> <span class='const'>DATA_DIR</span>
  <span class='id identifier rubyid_yaml_file'>yaml_file</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/YamlState.html" title="Lich::Common::GUI::YamlState (module)">YamlState</a></span></span><span class='period'>.</span><span class='id identifier rubyid_yaml_file_path'><span class='object_link'><a href="../GUI/YamlState.html#yaml_file_path-class_method" title="Lich::Common::GUI::YamlState.yaml_file_path (method)">yaml_file_path</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data_dir'>data_dir</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: entry.yaml not found</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_yaml_data'>yaml_data</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='id identifier rubyid_yaml_file'>yaml_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_encryption_mode'>encryption_mode</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>encryption_mode</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>plaintext</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

    <span class='comment'># Non-enhanced modes don&#39;t need master password
</span>    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_encryption_mode'>encryption_mode</span> <span class='op'>==</span> <span class='symbol'>:enhanced</span>

    <span class='comment'># Check if validation test exists (indicator of Enhanced mode setup)
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_yaml_data'>yaml_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master_password_validation_test</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: No validation test found in entry.yaml</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Master password recovery may be needed</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># Check if keychain is available and has the password
</span>    <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_keychain_available?'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#keychain_available%3F-class_method" title="Lich::Common::GUI::MasterPasswordManager.keychain_available? (method)">keychain_available?</a></span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Keychain not available on this system</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_master_password'>master_password</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Common.html" title="Lich::Common (module)">Common</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI.html" title="Lich::Common::GUI (module)">GUI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../GUI/MasterPasswordManager.html" title="Lich::Common::GUI::MasterPasswordManager (module)">MasterPasswordManager</a></span></span><span class='period'>.</span><span class='id identifier rubyid_retrieve_master_password'><span class='object_link'><a href="../GUI/MasterPasswordManager.html#retrieve_master_password-class_method" title="Lich::Common::GUI::MasterPasswordManager.retrieve_master_password (method)">retrieve_master_password</a></span></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_master_password'>master_password</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_master_password'>master_password</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Master password not found in keychain</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Use: lich --recover-master-password</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>     to restore the master password from your accounts</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info: Master password validation failed - keychain missing, user can recover</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='kw'>true</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span>
    <span class='const'><span class='object_link'><a href="../../../Lich.html" title="Lich (module)">Lich</a></span></span><span class='period'>.</span><span class='id identifier rubyid_log'><span class='object_link'><a href="../../../Lich.html#log-class_method" title="Lich.log (method)">log</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: Master password validation failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'><span class='object_link'><a href="../../../top-level-namespace.html#e-instance_method" title="#e (method)">e</a></span></span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan 13 04:43:34 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.2.9).
</div>

    </div>
  <script type="text/javascript">
// Navigation helper for YARD docs
// Adds persistent navigation links, fixes sidebar navigation, and theme toggle

(function() {
  'use strict';

  // Calculate root path for assets
  function getRootPath() {
    var path = window.location.pathname;
    var rootPath = '';

    if (path.includes('/Lich/')) {
      var parts = path.split('/').filter(function(p) { return p; });
      var docsIndex = parts.indexOf('lich-5-docs');
      if (docsIndex >= 0) {
        var subParts = parts.slice(docsIndex + 1);
        rootPath = '../'.repeat(subParts.length - 1);
      }
    }

    if (!rootPath && !path.endsWith('/index.html') && !path.endsWith('/')) {
      var pathParts = path.split('/').filter(function(p) { return p && p !== 'index.html'; });
      var docsIdx = pathParts.indexOf('lich-5-docs');
      if (docsIdx >= 0) {
        rootPath = '../'.repeat(pathParts.length - docsIdx - 2);
      }
    }

    return rootPath;
  }

  // Inject theme CSS
  function injectThemeCSS() {
    if (document.getElementById('theme-css')) return;

    var rootPath = getRootPath();

    // Try multiple paths to find the CSS
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css',
      '/css/theme.css'
    ];

    var link = document.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    // Add error handler to try alternative paths
    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    document.head.appendChild(link);

    // Also inject critical inline styles as fallback
    injectInlineStyles();
  }

  // Inject critical inline styles for immediate dark mode
  function injectInlineStyles() {
    if (document.getElementById('theme-inline-css')) return;

    var style = document.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      '[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects { background-color: #16213e !important; }',
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3 { color: #e8e8e8 !important; }'
    ].join('\n');
    document.head.appendChild(style);
  }

  // Get saved theme or detect system preference
  function getPreferredTheme() {
    var saved = localStorage.getItem('yard-theme');
    if (saved) return saved;

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  }

  // Apply theme to a document
  function applyThemeToDocument(doc, theme) {
    if (!doc || !doc.documentElement) return;
    doc.documentElement.setAttribute('data-theme', theme);

    // Also set on body for broader compatibility
    if (doc.body) {
      doc.body.setAttribute('data-theme', theme);
    }
  }

  // Inject inline styles into a document
  function injectInlineStylesToDocument(doc) {
    if (!doc || !doc.head) return;
    if (doc.getElementById('theme-inline-css')) return;

    var style = doc.createElement('style');
    style.id = 'theme-inline-css';
    style.textContent = [
      '[data-theme="dark"] { --bg-dark: #1a1a2e; --text-dark: #e8e8e8; }',
      '[data-theme="dark"] body { background-color: #1a1a2e !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] #menu, [data-theme="dark"] .menu, [data-theme="dark"] nav { background-color: #16213e !important; }',
      '[data-theme="dark"] a { color: #5dade2 !important; }',
      '[data-theme="dark"] #full_list, [data-theme="dark"] .objects { background-color: #16213e !important; }',
      '[data-theme="dark"] li { background-color: transparent !important; }',
      '[data-theme="dark"] table th, [data-theme="dark"] thead { background-color: #1e3a5f !important; color: #e8e8e8 !important; }',
      '[data-theme="dark"] table td, [data-theme="dark"] table tr { background-color: #1a1a2e !important; color: #b8b8b8 !important; }',
      '[data-theme="dark"] table tr:nth-child(even), [data-theme="dark"] table tr:nth-child(even) td { background-color: #16213e !important; }',
      '[data-theme="dark"] input { background-color: #1a1a2e !important; color: #e8e8e8 !important; border-color: #333 !important; }',
      '[data-theme="dark"] small { color: #888 !important; }',
      '[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3 { color: #e8e8e8 !important; }',
      '[data-theme="dark"] #content { background-color: #1a1a2e !important; }',
      '[data-theme="dark"] pre, [data-theme="dark"] code { background-color: #0d1117 !important; color: #c9d1d9 !important; }'
    ].join('\n');
    doc.head.appendChild(style);
  }

  // Inject theme CSS into a document
  function injectThemeCSSIntoDocument(doc, rootPath) {
    if (!doc || !doc.head) return;

    // Always inject inline styles first as fallback
    injectInlineStylesToDocument(doc);

    if (doc.getElementById('theme-css')) return;

    // Try multiple paths
    var paths = [
      rootPath + 'css/theme.css',
      'css/theme.css',
      '../css/theme.css',
      '../../css/theme.css'
    ];

    var link = doc.createElement('link');
    link.id = 'theme-css';
    link.rel = 'stylesheet';
    link.href = paths[0];

    var pathIndex = 0;
    link.onerror = function() {
      pathIndex++;
      if (pathIndex < paths.length) {
        link.href = paths[pathIndex];
      }
    };

    doc.head.appendChild(link);
  }

  // Apply theme to all frames
  function applyThemeToAllFrames(theme) {
    var rootPath = getRootPath();

    // Apply to main document
    applyThemeToDocument(document, theme);
    injectThemeCSSIntoDocument(document, rootPath);

    // Apply to all frames and iframes
    try {
      var frames = document.querySelectorAll('frame, iframe');
      frames.forEach(function(frame) {
        try {
          var frameDoc = frame.contentDocument || frame.contentWindow.document;
          if (frameDoc) {
            applyThemeToDocument(frameDoc, theme);
            // Calculate root path relative to frame
            var frameRootPath = rootPath || '';
            injectThemeCSSIntoDocument(frameDoc, frameRootPath);
          }
        } catch (e) {
          // Cross-origin frame, skip
        }
      });

      // Also check parent frames (if we're in a frame)
      if (window.parent && window.parent !== window) {
        try {
          applyThemeToDocument(window.parent.document, theme);
          injectThemeCSSIntoDocument(window.parent.document, rootPath);
        } catch (e) {
          // Cross-origin, skip
        }
      }

      // Check top-level window
      if (window.top && window.top !== window) {
        try {
          applyThemeToDocument(window.top.document, theme);
          injectThemeCSSIntoDocument(window.top.document, rootPath);

          // Apply to all frames from top
          var topFrames = window.top.document.querySelectorAll('frame, iframe');
          topFrames.forEach(function(frame) {
            try {
              var frameDoc = frame.contentDocument || frame.contentWindow.document;
              if (frameDoc) {
                applyThemeToDocument(frameDoc, theme);
                injectThemeCSSIntoDocument(frameDoc, '');
              }
            } catch (e) {}
          });
        } catch (e) {
          // Cross-origin, skip
        }
      }
    } catch (e) {
      // Frames not accessible
    }
  }

  // Apply theme
  function applyTheme(theme) {
    localStorage.setItem('yard-theme', theme);

    // Apply to all documents
    applyThemeToAllFrames(theme);

    var btn = document.getElementById('theme-toggle');
    if (btn) {
      btn.textContent = theme === 'dark' ? ' Light' : ' Dark';
      btn.title = 'Switch to ' + (theme === 'dark' ? 'light' : 'dark') + ' mode';
    }
  }

  // Toggle theme
  function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme') || 'light';
    var newTheme = current === 'dark' ? 'light' : 'dark';
    applyTheme(newTheme);
  }

  // Check if we're in a sidebar/list frame (should not add nav)
  function isListFrame() {
    var path = window.location.pathname.toLowerCase();
    // Skip list frames
    if (path.includes('class_list') ||
        path.includes('file_list') ||
        path.includes('method_list') ||
        path.includes('_list.html') ||
        path.includes('frames.html')) {
      return true;
    }
    // Skip if this is a frame with full_list (sidebar)
    if (document.getElementById('full_list') && !document.getElementById('content')) {
      return true;
    }
    // Skip if we're clearly in a sub-frame
    if (window.frameElement) {
      return true;
    }
    return false;
  }

  function addNavLinks() {
    // Don't add nav to list/sidebar frames
    if (isListFrame()) return;

    var content = document.getElementById('content');
    if (!content) return;

    if (document.getElementById('quick-nav')) return;

    var rootPath = getRootPath();

    var nav = document.createElement('div');
    nav.id = 'quick-nav';
    nav.style.cssText = 'padding: 8px 15px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ddd; font-size: 14px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;';

    var links = document.createElement('div');
    links.innerHTML = '<a href="' + rootPath + 'index.html" style="margin-right: 15px; text-decoration: none;">Home</a> | ' +
                      '<a href="' + rootPath + '_index.html" style="margin-left: 15px; margin-right: 15px; text-decoration: none;">All Classes</a> | ' +
                      '<a href="' + rootPath + 'file.psm-reference.html" style="margin-left: 15px; text-decoration: none;">PSM Guide</a>';

    var themeBtn = document.createElement('button');
    themeBtn.id = 'theme-toggle';
    themeBtn.type = 'button';
    themeBtn.onclick = toggleTheme;

    nav.appendChild(links);
    nav.appendChild(themeBtn);

    content.insertBefore(nav, content.firstChild);

    var currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    themeBtn.textContent = currentTheme === 'dark' ? ' Light' : ' Dark';
    themeBtn.title = 'Switch to ' + (currentTheme === 'dark' ? 'light' : 'dark') + ' mode';
  }

  // Fix sidebar links - only run in actual sidebar/list frames
  function fixAllSidebarLinks() {
    // Only fix links if we're in a list frame
    if (!isListFrame()) return;

    // Get all possible sidebar/menu containers
    var selectors = [
      '#full_list',
      '#menu',
      '.menu',
      '#full_list_content',
      '.class_list',
      '.objects',
      '.sidebar',
      '#list',
      '.y_list'
    ];

    selectors.forEach(function(selector) {
      var containers = document.querySelectorAll(selector);
      containers.forEach(function(container) {
        // Add click handler to container that forces navigation
        if (!container.dataset.navFixed) {
          container.dataset.navFixed = 'true';

          container.addEventListener('click', function(e) {
            // Find the clicked link
            var target = e.target;
            while (target && target !== container) {
              if (target.tagName === 'A') {
                var href = target.getAttribute('href');
                if (href && href !== '#' && !href.startsWith('javascript:')) {
                  e.preventDefault();
                  e.stopPropagation();
                  e.stopImmediatePropagation();

                  // Navigate the parent/top frame, not this frame
                  if (window.parent && window.parent !== window) {
                    window.parent.location.href = target.href;
                  } else if (window.top && window.top !== window) {
                    window.top.location.href = target.href;
                  } else {
                    window.location.href = target.href;
                  }
                  return false;
                }
              }
              target = target.parentNode;
            }
          }, true); // Capture phase
        }

        // Also fix individual links
        var links = container.querySelectorAll('a');
        links.forEach(function(link) {
          if (!link.dataset.navFixed) {
            link.dataset.navFixed = 'true';
            var href = link.getAttribute('href');
            if (href && href !== '#' && !href.startsWith('javascript:')) {
              // Store the original href
              var fullHref = link.href;

              // Override onclick - navigate parent frame
              link.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (window.parent && window.parent !== window) {
                  window.parent.location.href = fullHref;
                } else if (window.top && window.top !== window) {
                  window.top.location.href = fullHref;
                } else {
                  window.location.href = fullHref;
                }
                return false;
              };
            }
          }
        });
      });
    });
  }

  // Watch for dynamically loaded content - only in list frames
  function observeForNewLinks() {
    // Only observe in list frames
    if (!isListFrame()) return;

    var observer = new MutationObserver(function(mutations) {
      var hasNewNodes = mutations.some(function(m) {
        return m.addedNodes.length > 0;
      });
      if (hasNewNodes) {
        // Delay slightly to let YARD's JS run first
        setTimeout(fixAllSidebarLinks, 10);
      }
    });

    if (document.body) {
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
  }

  // Initialize
  function init() {
    injectThemeCSS();
    applyTheme(getPreferredTheme());
    addNavLinks();
    fixAllSidebarLinks();
    observeForNewLinks();
  }

  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // Run periodically to catch all dynamic content and frames
  var intervals = [50, 100, 250, 500, 1000, 2000, 3000];
  intervals.forEach(function(ms) {
    setTimeout(function() {
      fixAllSidebarLinks();
      // Reapply theme to catch any newly loaded frames
      var theme = localStorage.getItem('yard-theme') || getPreferredTheme();
      applyThemeToAllFrames(theme);
    }, ms);
  });

  // Also run on any click anywhere (last resort) - only in list frames
  document.addEventListener('click', function(e) {
    // Only handle in list frames
    if (!isListFrame()) return;

    if (e.target.tagName === 'A') {
      var href = e.target.getAttribute('href');
      if (href && href !== '#' && !href.startsWith('javascript:')) {
        // Check if it's a sidebar link
        var inSidebar = e.target.closest('#full_list, #menu, .menu, .sidebar');
        if (inSidebar) {
          e.preventDefault();
          e.stopPropagation();
          // Navigate parent frame
          if (window.parent && window.parent !== window) {
            window.parent.location.href = e.target.href;
          } else {
            window.location.href = e.target.href;
          }
        }
      }
    }
  }, true);

  // Listen for system theme changes
  if (window.matchMedia) {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('yard-theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  }
})();

</script>
</body>
</html>